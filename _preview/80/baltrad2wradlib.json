{"kind":"Notebook","sha256":"ff476b6f893e5f8b1c73a5d8ffaceb9e2254705eae3d95de3c357959b948ec60","slug":"baltrad2wradlib","location":"/notebooks/baltrad/baltrad2wradlib/baltrad2wradlib.ipynb","dependencies":[],"frontmatter":{"title":"Attenuation correction comparison with wradlib","content_includes_title":false,"authors":[{"nameParsed":{"literal":"Alfonso Ladino","given":"Alfonso","family":"Ladino"},"name":"Alfonso Ladino","orcid":"0000-0001-8081-7827","github":"aladinor","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Anna del Moral Méndez","given":"Anna","non_dropping_particle":"del","family":"Moral Méndez"},"name":"Anna del Moral Méndez","orcid":"0000-0002-5015-840X","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Brenda Javornik","given":"Brenda","family":"Javornik"},"name":"Brenda Javornik","orcid":"0009-0004-9266-9293","github":"leavesntwigs","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Daniel Michelson","given":"Daniel","family":"Michelson"},"name":"Daniel Michelson","orcid":"0000-0003-3222-9881","github":"DanielMichelson","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Daniel Wolfensberger","given":"Daniel","family":"Wolfensberger"},"name":"Daniel Wolfensberger","orcid":"0009-0006-1419-0556","github":"wolfidan","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Gionata Ghiggi","given":"Gionata","family":"Ghiggi"},"name":"Gionata Ghiggi","orcid":"0000-0002-0818-0865","github":"ghiggi","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Jen DeHart","given":"Jen","family":"DeHart"},"name":"Jen DeHart","orcid":"0000-0001-8536-4927","github":"jcdehart","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Jordi Figueras i Ventura","given":"Jordi Figueras","non_dropping_particle":"i","family":"Ventura"},"name":"Jordi Figueras i Ventura","orcid":"0000-0002-4949-422X","github":"jfigui","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Julian Giles","given":"Julian","family":"Giles"},"name":"Julian Giles","orcid":"0000-0001-8134-008X","github":"JulianGiles","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Kai Mühlbauer","given":"Kai","family":"Mühlbauer"},"name":"Kai Mühlbauer","orcid":"0000-0001-6599-1034","github":"kmuehlbauer","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Maxwell Grover","given":"Maxwell","family":"Grover"},"name":"Maxwell Grover","orcid":"0000-0002-0370-8974","github":"mgrover1","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Mike Dixon","given":"Mike","family":"Dixon"},"name":"Mike Dixon","orcid":"0000-0002-9597-9113","github":"mike-dixon","id":"contributors-myst-generated-uid-11"},{"nameParsed":{"literal":"Robert Jackson","given":"Robert","family":"Jackson"},"name":"Robert Jackson","orcid":"0000-0003-2518-1234","github":"rcjackson","id":"contributors-myst-generated-uid-12"},{"nameParsed":{"literal":"Scott Collis","given":"Scott","family":"Collis"},"name":"Scott Collis","orcid":"0000-0002-2303-687X","github":"scollis","id":"contributors-myst-generated-uid-13"},{"nameParsed":{"literal":"Ting-Yu Cha","given":"Ting-Yu","family":"Cha"},"name":"Ting-Yu Cha","orcid":"0000-0002-6292-8483","github":"tingyucha","id":"contributors-myst-generated-uid-14"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","name":"Apache License 2.0","osi":true,"free":true,"url":"https://opensource.org/licenses/Apache-2.0"},"code":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"}},"github":"https://github.com/openradar/erad2024","copyright":"2024","abbreviations":{"ARM":"Atmospheric Radiation Measurement","NCAR":"National Center for Atmospheric Research"},"exports":[{"format":"ipynb","filename":"baltrad2wradlib.ipynb","url":"/erad2024/_preview/80/build/baltrad2wradlib-e04d4bf863490d66e7fe0898015738b9.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Comparison between BALTRAD and wradlib attenuation correction","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U2qrTP9dDt"}],"key":"ixF0r9PCEQ"}],"key":"nOJWDCWyaD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve data from s3 bucket","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KMc0ujJJAH"}],"identifier":"retrieve-data-from-s3-bucket","label":"Retrieve data from s3 bucket","html_id":"retrieve-data-from-s3-bucket","implicit":true,"key":"PtHD86eGA4"}],"key":"rrabnkjwGk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:37.658534Z","iopub.status.busy":"2024-08-20T05:52:37.658376Z","iopub.status.idle":"2024-08-20T05:52:40.019332Z","shell.execute_reply":"2024-08-20T05:52:40.018820Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport urllib.request\nfrom pathlib import Path\n\n# Set the URL for the cloud\nURL = \"https://js2.jetstream-cloud.org:8001/\"\npath = \"pythia/radar/erad2024/baltrad/baltrad2wradlib/\"\n!mkdir -p data\n!mkdir -p shp\nfiles = [\n    \"data/201405190715_SUR.h5\",\n    \"shp/europe_countries.dbf\",\n    \"shp/europe_countries.prj\",\n    \"shp/europe_countries.sbn\",\n    \"shp/europe_countries.sbx\",\n    \"shp/europe_countries.shp\",\n    \"shp/europe_countries.shx\",\n]\nfor file in files:\n    file0 = os.path.join(path, Path(file).name)\n    if not os.path.exists(file):\n        print(f\"downloading, {file}\")\n        x = urllib.request.urlretrieve(f\"{URL}{file0}\", file)","key":"z5Il5W6FTF"},{"type":"output","id":"2NT4Eh5jsJyIqOHwJAyqm","data":[{"name":"stdout","output_type":"stream","text":"downloading, data/201405190715_SUR.h5\n"},{"name":"stdout","output_type":"stream","text":"downloading, shp/europe_countries.dbf\n"},{"name":"stdout","output_type":"stream","text":"downloading, shp/europe_countries.prj\ndownloading, shp/europe_countries.sbn\n"},{"name":"stdout","output_type":"stream","text":"downloading, shp/europe_countries.sbx\ndownloading, shp/europe_countries.shp\n"},{"name":"stdout","output_type":"stream","text":"downloading, shp/europe_countries.shx\n"}],"key":"A2HuEbA3XE"}],"key":"Ibgs2mJFfd"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prepare your environment","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WRHlHri3H4"}],"identifier":"prepare-your-environment","label":"Prepare your environment","html_id":"prepare-your-environment","implicit":true,"key":"CNfO9DZRwk"}],"key":"mUVFxANZhd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:40.021306Z","iopub.status.busy":"2024-08-20T05:52:40.021112Z","iopub.status.idle":"2024-08-20T05:52:40.339473Z","shell.execute_reply":"2024-08-20T05:52:40.338977Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib inline","key":"HWvQFWsrc0"},{"type":"output","id":"VISr-GJwyBFFQtVVkanEH","data":[],"key":"XXvJJGiGEf"}],"key":"J7XAG2eKX0"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:40.341613Z","iopub.status.busy":"2024-08-20T05:52:40.341399Z","iopub.status.idle":"2024-08-20T05:52:41.246482Z","shell.execute_reply":"2024-08-20T05:52:41.245976Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import gc\n\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as mticker\nimport numpy as np\nimport shapefile\nimport wradlib\nimport xradar as xd\nfrom matplotlib.collections import PatchCollection\nfrom matplotlib.patches import Polygon","key":"bMkUEtzMfF"},{"type":"output","id":"LJxc_nqIEpvZ70sWHNZps","data":[],"key":"CQCXkTgMsy"}],"key":"LfYola3hGe"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run BALTRAD’s odc_toolbox","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yi7uTah8xv"}],"identifier":"run-baltrads-odc-toolbox","label":"Run BALTRAD’s odc_toolbox","html_id":"run-baltrads-odc-toolbox","implicit":true,"key":"hrGrYO6bJf"}],"key":"VpV2Ckx9aM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First, you will process a scan from Suergavere (Estland) by using BALTRAD’s odc_toolbox.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vXgjpNvsot"}],"key":"BAzFJe9kfl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"From your VM’s vagrant directory, navigate to the folder ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r2GzQ9hyvo"},{"type":"inlineCode","value":"/baltrad2wradlib","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K0M3Y7NrqV"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nbhyt1wQwT"}],"key":"RvlD6LHzve"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Execute the following command:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qhR139uxHH"}],"key":"XVMe41jxRI"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"$ odc_toolbox -i data -o out -q ropo,radvol-att","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AjISg4n3VK"}],"key":"YogJJHkwr5"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Check whether a file was created in the folder ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AAknkHoBNV"},{"type":"inlineCode","value":"/out","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"nd4VeSDfSK"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"z57ab7XY1r"}],"key":"imqB97r546"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"BALTRAD will not create output files if these already exist.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"nft8SucAKl"}],"key":"Lq2nFFuZft"},{"type":"text","value":" You can check that via ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"XlMpGBo37s"},{"type":"inlineCode","value":"!ls out","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qlN0pLekjn"},{"type":"text","value":".","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZCjWU8Rmdr"}],"key":"ajZamGkVeb"}],"key":"pAkkzpZ1Ey"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:41.248845Z","iopub.status.busy":"2024-08-20T05:52:41.248534Z","iopub.status.idle":"2024-08-20T05:52:41.882592Z","shell.execute_reply":"2024-08-20T05:52:41.881982Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"!odc_toolbox --help","key":"sLQ3domqVQ"},{"type":"output","id":"saJLECuw0t2N9YbWjkzOc","data":[{"name":"stdout","output_type":"stream","text":"Usage: odc_toolbox -i <inpath> -o <outpath> -q <algorithm-list> [-p <processes>] [h]\r\n\r\nCommand-line tool for QC-processing polar data for Odyssey\r\n\r\nOptions:\r\n  -h, --help            show this help message and exit\r\n  -i IPATH, --ipath=IPATH\r\n                        Input path containing polar data.\r\n  -o OPATH, --opath=OPATH\r\n                        Output path for writing data.\r\n  -q QC, --qc=QC        Comma-separated list of which QC algorithms to run,\r\n                        e.g. 'ropo,beamb'. No white spaces between these\r\n                        names. For compositing, this executable hard-wires a\r\n                        quality-based composite algorithm where the last QC\r\n                        algorithm in the chain should be qi-total.\r\n  -d, --delete          Deletes input files following their processing.\r\n  -c, --check           Checks for the presence of output files. If an output\r\n                        file already exists, do nothing and move on to the\r\n                        next.\r\n  -p PROCS, --procs=PROCS\r\n                        Number of concurrent worker processes to run. Defaults\r\n                        to the maximum number of logical CPUs supported on\r\n                        your hardware, but can be constrained or raised as you\r\n                        wish. Use off-line for benchmarking.\r\n  -D, --write-pvols     Write quality-controlled PVOLs to output path.\r\n  -a AREAID, --composite-area=AREAID\r\n                        The area identifier (string) of the output composite\r\n                        area to generate.\r\n  -O OFILE, --composite-file=OFILE\r\n                        The file name of the output composite that will be\r\n                        written to --opath. Default=composite.h5\r\n  -v, --verbose         If the different steps should be displayed. I.e.\r\n                        verbose information.\r\n"}],"key":"Pr7hCBA82q"}],"key":"lvHUczhSAZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:41.884940Z","iopub.status.busy":"2024-08-20T05:52:41.884571Z","iopub.status.idle":"2024-08-20T05:52:43.793806Z","shell.execute_reply":"2024-08-20T05:52:43.793208Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"!odc_toolbox -i data -o out -q ropo,radvol-att","key":"Q0DHev2UWm"},{"type":"output","id":"44CHlV04zt0AiVIOIX0pQ","data":[{"name":"stdout","output_type":"stream","text":"Exception ignored in: <function _after_at_fork_child_reinit_locks at 0x7fc971cb5800>\r\nTraceback (most recent call last):\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 265, in _after_at_fork_child_reinit_locks\r\n    handler._at_fork_reinit()\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 920, in _at_fork_reinit\r\n    self.lock._at_fork_reinit()\r\n    ^^^^^^^^^^^^^^^^^^^^^^^^^\r\nAttributeError: 'RLock' object has no attribute '_at_fork_reinit'\r\nException ignored in: <function _after_at_fork_child_reinit_locks at 0x7fc971cb5800>\r\nTraceback (most recent call last):\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 265, in _after_at_fork_child_reinit_locks\r\n    handler._at_fork_reinit()\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 920, in _at_fork_reinit\r\n    self.lock._at_fork_reinit()\r\n    ^^^^^^^^^^^^^^^^^^^^^^^^^\r\nAttributeError: 'RLock' object has no attribute '_at_fork_reinit'\r\nException ignored in: <function _after_at_fork_child_reinit_locks at 0x7fc971cb5800>\r\nTraceback (most recent call last):\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 265, in _after_at_fork_child_reinit_locks\r\n    handler._at_fork_reinit()\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 920, in _at_fork_reinit\r\n    self.lock._at_fork_reinit()\r\n    ^^^^^^^^^^^^^^^^^^^^^^^^^\r\nAttributeError: 'RLock' object has no attribute '_at_fork_reinit'\r\nException ignored in: <function _after_at_fork_child_reinit_locks at 0x7fc971cb5800>\r\nTraceback (most recent call last):\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 265, in _after_at_fork_child_reinit_locks\r\n    handler._at_fork_reinit()\r\n  File \"/srv/conda/envs/notebook/lib/python3.11/logging/__init__.py\", line 920, in _at_fork_reinit\r\n    self.lock._at_fork_reinit()\r\n    ^^^^^^^^^^^^^^^^^^^^^^^^^\r\nAttributeError: 'RLock' object has no attribute '_at_fork_reinit'\r\n"}],"key":"ZWL38UDemk"}],"key":"f3GllOv77H"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:43.796384Z","iopub.status.busy":"2024-08-20T05:52:43.795996Z","iopub.status.idle":"2024-08-20T05:52:44.197217Z","shell.execute_reply":"2024-08-20T05:52:44.196529Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"!ls out","key":"SdFzMsQH02"},{"type":"output","id":"0FJir7aoVK0rHurDLIGY0","data":[{"name":"stdout","output_type":"stream","text":"201405190715_SUR.h5\r\n"}],"key":"O3GJ6PqhWe"}],"key":"kxxnvkcEER"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read and inspect data from Suergavere (Estonia) before and after QC with odc_toolbox","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TTjWJv4mpt"}],"identifier":"read-and-inspect-data-from-suergavere-estonia-before-and-after-qc-with-odc-toolbox","label":"Read and inspect data from Suergavere (Estonia) before and after QC with odc_toolbox","html_id":"read-and-inspect-data-from-suergavere-estonia-before-and-after-qc-with-odc-toolbox","implicit":true,"key":"n9pd9aXzgh"}],"key":"uyeRDNSMNT"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:44.199612Z","iopub.status.busy":"2024-08-20T05:52:44.199318Z","iopub.status.idle":"2024-08-20T05:52:45.141684Z","shell.execute_reply":"2024-08-20T05:52:45.141055Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Before QC\ninp = xd.io.open_odim_datatree(\"data/201405190715_SUR.h5\")\n# After QC\nout = xd.io.open_odim_datatree(\"out/201405190715_SUR.h5\")","key":"QyOLXeM1Dc"},{"type":"output","id":"6AFviO9utL_mb-GIFs1Jk","data":[],"key":"S5daROZTwZ"}],"key":"X5bT45TuDf"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Georeference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XOkqSFH2Y7"}],"identifier":"georeference","label":"Georeference","html_id":"georeference","implicit":true,"key":"Ob3lPgcdwM"}],"key":"mQ00tB5rtW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:45.144159Z","iopub.status.busy":"2024-08-20T05:52:45.143668Z","iopub.status.idle":"2024-08-20T05:52:45.337623Z","shell.execute_reply":"2024-08-20T05:52:45.337021Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inp = inp.xradar.georeference()\nout = out.xradar.georeference()","key":"zCiCo31TYc"},{"type":"output","id":"6OyTo5rK8ofaVw3t9dWh5","data":[],"key":"nAm6abnMLS"}],"key":"j6lokUxn0B"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:45.339799Z","iopub.status.busy":"2024-08-20T05:52:45.339623Z","iopub.status.idle":"2024-08-20T05:52:45.373520Z","shell.execute_reply":"2024-08-20T05:52:45.372972Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"swp_inp = inp[\"sweep_0\"].ds.set_coords(\"sweep_mode\")\nswp_out = out[\"sweep_0\"].ds.set_coords(\"sweep_mode\")\ndisplay(swp_inp)\ndisplay(swp_out)","key":"nJey0eGabI"},{"type":"output","id":"pVtRUQypjs1mgYQzYsHXZ","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"68e77186d668ec8eccde61e3e3fe9a53","path":"/erad2024/_preview/80/build/68e77186d668ec8eccde61e3e3fe9a53.html"},"text/plain":{"content":"<xarray.Dataset> Size: 26MB\nDimensions:            (azimuth: 360, range: 831)\nCoordinates:\n    elevation          (azimuth) float32 1kB 0.5 0.5 0.5 0.5 ... 0.5 0.5 0.5 0.5\n    time               (azimuth) datetime64[ns] 3kB 2014-05-19T07:15:22.33890...\n  * range              (range) float32 3kB 1.05e+03 1.35e+03 ... 2.5e+05\n    sweep_mode         <U20 80B ...\n    longitude          float64 8B 25.52\n    latitude           float64 8B 58.48\n    altitude           float64 8B 157.0\n  * azimuth            (azimuth) float32 1kB 0.5 1.5 2.5 ... 357.5 358.5 359.5\n    crs_wkt            int64 8B 0\n    x                  (azimuth, range) float32 1MB 9.162 11.78 ... -2.181e+03\n    y                  (azimuth, range) float32 1MB 1.05e+03 ... 2.499e+05\n    z                  (azimuth, range) float32 1MB 167.0 169.0 ... 6.022e+03\nData variables: (12/14)\n    DBZH               (azimuth, range) float64 2MB ...\n    VRAD               (azimuth, range) float64 2MB ...\n    RHOHV              (azimuth, range) float64 2MB ...\n    HCLASS             (azimuth, range) float32 1MB ...\n    PHIDP              (azimuth, range) float64 2MB ...\n    ZDR                (azimuth, range) float64 2MB ...\n    ...                 ...\n    TH                 (azimuth, range) float64 2MB ...\n    WRAD               (azimuth, range) float64 2MB ...\n    sweep_number       int64 8B ...\n    prt_mode           <U7 28B ...\n    follow_mode        <U7 28B ...\n    sweep_fixed_angle  float64 8B ...","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"56b31eed464f19fdf99b7294343c482f","path":"/erad2024/_preview/80/build/56b31eed464f19fdf99b7294343c482f.html"},"text/plain":{"content":"<xarray.Dataset> Size: 31MB\nDimensions:            (azimuth: 360, range: 831)\nCoordinates:\n    elevation          (azimuth) float32 1kB 0.5 0.5 0.5 0.5 ... 0.5 0.5 0.5 0.5\n    time               (azimuth) datetime64[ns] 3kB 2014-05-19T07:15:22.33890...\n  * range              (range) float32 3kB 1.05e+03 1.35e+03 ... 2.5e+05\n    sweep_mode         <U20 80B ...\n    longitude          float64 8B 25.52\n    latitude           float64 8B 58.48\n    altitude           float64 8B 157.0\n  * azimuth            (azimuth) float32 1kB 0.5 1.5 2.5 ... 357.5 358.5 359.5\n    crs_wkt            int64 8B 0\n    x                  (azimuth, range) float32 1MB 9.162 11.78 ... -2.181e+03\n    y                  (azimuth, range) float32 1MB 1.05e+03 ... 2.499e+05\n    z                  (azimuth, range) float32 1MB 167.0 169.0 ... 6.022e+03\nData variables: (12/16)\n    DBZH               (azimuth, range) float64 2MB ...\n    TH                 (azimuth, range) float64 2MB ...\n    RHOHV              (azimuth, range) float64 2MB ...\n    HCLASS             (azimuth, range) float32 1MB ...\n    WRADH              (azimuth, range) float64 2MB ...\n    PHIDP              (azimuth, range) float64 2MB ...\n    ...                 ...\n    quality1           (azimuth, range) float64 2MB ...\n    QIND               (azimuth, range) float64 2MB ...\n    sweep_number       int64 8B ...\n    prt_mode           <U7 28B ...\n    follow_mode        <U7 28B ...\n    sweep_fixed_angle  float64 8B ...","content_type":"text/plain"}}}],"key":"ighTP7SPWz"}],"key":"Wx47vb5ixz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a plot we will use for all PPIs in this exercise","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XfSnkqtTaW"}],"identifier":"design-a-plot-we-will-use-for-all-ppis-in-this-exercise","label":"Design a plot we will use for all PPIs in this exercise","html_id":"design-a-plot-we-will-use-for-all-ppis-in-this-exercise","implicit":true,"key":"hlcUaxXdIv"}],"key":"UF7yAIJ8W6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:45.375312Z","iopub.status.busy":"2024-08-20T05:52:45.375149Z","iopub.status.idle":"2024-08-20T05:52:45.552447Z","shell.execute_reply":"2024-08-20T05:52:45.551998Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport wradlib as wrl\nfrom cartopy.io.shapereader import Reader\n\nmap_proj = ccrs.AzimuthalEquidistant(\n    central_latitude=swp_inp.latitude.values, central_longitude=swp_inp.longitude.values\n)\nosr_proj = wrl.georef.create_osr(\n    \"aeqd\", lat_0=swp_inp.latitude.values, lon_0=swp_inp.longitude.values\n)\n\ngeometries = list(Reader(\"shp/europe_countries.shp\").geometries())\n\n\ndef plot_ppi_to_ax(ppi, ax, title=\"\", geometries=None, **kwargs):\n    pm = ppi.wrl.vis.plot(crs=map_proj, ax=ax, **kwargs)\n    ax.set_title(title)\n    if geometries is not None:\n        ax.add_geometries(\n            geometries,\n            ccrs.PlateCarree(),\n            facecolor=\"lightgrey\",\n            edgecolor=\"k\",\n            linewidths=1,\n            zorder=-1,\n        )\n    wrl.vis.plot_ppi_crosshair(\n        site=(ppi.longitude.values, ppi.latitude.values, ppi.altitude.values),\n        ranges=[50000, 100000, 150000, 200000, ppi.range.max().values],\n        angles=[0, 90, 180, 270],\n        line=dict(color=\"white\"),\n        circle={\"edgecolor\": \"white\"},\n        ax=ax,\n        crs=osr_proj,\n    )\n    return pm","key":"jAwJHO82qa"},{"type":"output","id":"Dd04cvOqD5hpXcBMBNjeR","data":[],"key":"HrBGuOvtCt"}],"key":"AGlc1drumx"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the selected fields into one figure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FttWmAwpbM"}],"identifier":"plot-the-selected-fields-into-one-figure","label":"Plot the selected fields into one figure","html_id":"plot-the-selected-fields-into-one-figure","implicit":true,"key":"Np38bQ1JWj"}],"key":"dEw8QPBHin"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:45.554649Z","iopub.status.busy":"2024-08-20T05:52:45.554480Z","iopub.status.idle":"2024-08-20T05:52:51.031901Z","shell.execute_reply":"2024-08-20T05:52:51.031347Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(12, 10))\n\nax = plt.subplot(221, projection=map_proj)\npm = plot_ppi_to_ax(\n    swp_inp.DBZH.where(swp_inp.DBZH >= -10),\n    ax=ax,\n    geometries=geometries,\n    title=\"Before QC\",\n    add_colorbar=False,\n    vmin=-10,\n    vmax=65,\n)\n\nax = plt.subplot(222, projection=map_proj)\npm = plot_ppi_to_ax(\n    swp_out.DBZH.where(swp_out.DBZH >= -10),\n    ax=ax,\n    geometries=geometries,\n    title=\"After QC\",\n    add_colorbar=False,\n    vmin=-10,\n    vmax=65,\n)\n\nax = plt.subplot(223, projection=map_proj)\nqm = plot_ppi_to_ax(\n    swp_out.quality1,\n    ax=ax,\n    geometries=geometries,\n    add_colorbar=False,\n    title=\"Quality 1\",\n)\n\nax = plt.subplot(224, projection=map_proj)\nqm = plot_ppi_to_ax(\n    swp_out.QIND, ax=ax, geometries=geometries, add_colorbar=False, title=\"Quality 2\"\n)\n\nplt.tight_layout()\n\n# Add colorbars\nfig.subplots_adjust(right=0.9)\ncax = fig.add_axes((0.9, 0.6, 0.03, 0.3))\ncbar = plt.colorbar(pm, cax=cax)\ncbar.set_label(\"Horizontal reflectivity (dBZ)\", fontsize=\"large\")\n\ncax = fig.add_axes((0.9, 0.1, 0.03, 0.3))\ncbar = plt.colorbar(qm, cax=cax)\ncbar.set_label(\"Quality index\", fontsize=\"large\")","key":"EMK5NtRGAs"},{"type":"output","id":"q83GOExCP9TAq79uY03wi","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6763265bf503ecfb0d5a976004f8d3a9","path":"/erad2024/_preview/80/build/6763265bf503ecfb0d5a976004f8d3a9.png"},"text/plain":{"content":"<Figure size 1200x1000 with 6 Axes>","content_type":"text/plain"}}}],"key":"PspVo57vDQ"}],"key":"UUMejvDxo1"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Collect and plot the polarimetric moments from the original ODIM_H5 dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lx4KsuTfwo"}],"identifier":"collect-and-plot-the-polarimetric-moments-from-the-original-odim-h5-dataset","label":"Collect and plot the polarimetric moments from the original ODIM_H5 dataset","html_id":"collect-and-plot-the-polarimetric-moments-from-the-original-odim-h5-dataset","implicit":true,"key":"Wkk5Ch6T5C"}],"key":"iBrHHp2133"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:51.035245Z","iopub.status.busy":"2024-08-20T05:52:51.034925Z","iopub.status.idle":"2024-08-20T05:52:52.958735Z","shell.execute_reply":"2024-08-20T05:52:52.958197Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(12, 12))\n\nax = plt.subplot(221, projection=map_proj)\npm = plot_ppi_to_ax(swp_inp.RHOHV, ax=ax, title=\"RhoHV\", geometries=geometries)\n\nax = plt.subplot(222, projection=map_proj)\npm = plot_ppi_to_ax(swp_inp.PHIDP, ax=ax, title=\"PhiDP\", geometries=geometries)\n\nax = plt.subplot(223, projection=map_proj)\npm = plot_ppi_to_ax(\n    swp_inp.ZDR, ax=ax, title=\"Differential reflectivity\", geometries=geometries\n)\n\nax = plt.subplot(224, projection=map_proj)\npm = plot_ppi_to_ax(\n    swp_inp.VRAD, ax=ax, title=\"Doppler velocity\", geometries=geometries\n)\n\nplt.tight_layout()","key":"mpkYi4x3kZ"},{"type":"output","id":"vswtRvukb_JE-mBwYKjIj","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a9512f61d4bd196c061fe93e15abfbb","path":"/erad2024/_preview/80/build/7a9512f61d4bd196c061fe93e15abfbb.png"},"text/plain":{"content":"<Figure size 1200x1200 with 8 Axes>","content_type":"text/plain"}}}],"key":"B4euSaVimj"}],"key":"iDoG6O8iiK"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Try some filtering and attenuation correction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"el2bJH4gB1"}],"identifier":"try-some-filtering-and-attenuation-correction","label":"Try some filtering and attenuation correction","html_id":"try-some-filtering-and-attenuation-correction","implicit":true,"key":"hDf0DintpN"}],"key":"aHj004xKiv"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:52.962465Z","iopub.status.busy":"2024-08-20T05:52:52.962149Z","iopub.status.idle":"2024-08-20T05:52:53.375398Z","shell.execute_reply":"2024-08-20T05:52:53.374893Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set ZH to a very low value where we do not expect valid data\nzh = swp_inp.DBZH.fillna(-32.0)\n# Retrieve PIA by using some constraints (see https://docs.wradlib.org/en/latest/notebooks/attenuation/attenuation.html for help)\npia = zh.wrl.atten.correct_attenuation_constrained(\n    constraints=[wradlib.atten.constraint_dbz, wradlib.atten.constraint_pia],\n    constraint_args=[[64.0], [20.0]],\n)\n\n# Correct reflectivity by PIA\nzh_corrected = swp_inp.DBZH + pia","key":"JRzpj4zfQf"},{"type":"output","id":"7jJZ5d0ogGYs8S8hkBBoJ","data":[{"name":"stderr","output_type":"stream","text":"/srv/conda/envs/notebook/lib/python3.11/site-packages/wradlib/trafo.py:339: RuntimeWarning: overflow encountered in power\n  return 10.0 ** (x / 10.0)\n"}],"key":"Z8Tjy8DDKU"}],"key":"zpahz43m0V"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compare results against QC from odc_toolbox","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ij28D0E8j9"}],"identifier":"compare-results-against-qc-from-odc-toolbox","label":"Compare results against QC from odc_toolbox","html_id":"compare-results-against-qc-from-odc-toolbox","implicit":true,"key":"Tpr48Ylrnv"}],"key":"ax6LLrzMAe"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-08-20T05:52:53.377703Z","iopub.status.busy":"2024-08-20T05:52:53.377327Z","iopub.status.idle":"2024-08-20T05:52:54.734076Z","shell.execute_reply":"2024-08-20T05:52:54.733559Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(18, 10))\n\nax = plt.subplot(131, projection=map_proj)\npm = plot_ppi_to_ax(\n    swp_inp.DBZH.where(swp_out.DBZH >= -10),\n    ax=ax,\n    geometries=geometries,\n    title=\"Before QC\",\n)\n\nax = plt.subplot(132, projection=map_proj)\npm = plot_ppi_to_ax(\n    swp_out.DBZH.where(swp_out.DBZH >= -10),\n    ax=ax,\n    geometries=geometries,\n    title=\"After QC using BALTRAD Toolbox\",\n)\n\nax = plt.subplot(133, projection=map_proj)\npm = plot_ppi_to_ax(\n    zh_corrected.where(zh_corrected >= -10),\n    ax=ax,\n    geometries=geometries,\n    title=\"After QC using wradlib\",\n)","key":"qvzMMdGoht"},{"type":"output","id":"i-fYbfAbfefI3VBtuGIc-","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"35774332679544b6e9acd312bec89eef","path":"/erad2024/_preview/80/build/35774332679544b6e9acd312bec89eef.png"},"text/plain":{"content":"<Figure size 1800x1000 with 6 Axes>","content_type":"text/plain"}}}],"key":"Tj6rjvbgjb"}],"key":"Njuj670oLt"}],"key":"CpWUag9YwU"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Doppler Velocity Dealiasing with Py-ART","url":"/pyart-baltrad-dealias-example","group":"BALTRAD"},"next":{"title":"LROSE Echo and Wind Retrieval Tutorial","url":"/lrose-introduction","group":"LROSE"}}},"domain":"http://localhost:3000"}