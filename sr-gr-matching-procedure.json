{"kind":"Notebook","sha256":"83523a542af276ac4b0615cef454bdd26bfb4a3ae8c775f82fed1d8150fd7c7d","slug":"sr-gr-matching-procedure","location":"/notebooks/gpm-api/SR_GR_Matching_Procedure.ipynb","dependencies":[],"frontmatter":{"title":"Spaceborne-Ground Radar Matching (Methodology)","content_includes_title":false,"kernelspec":{"name":"gpm-api-dev","display_name":"gpm-api-dev","language":"python"},"authors":[{"nameParsed":{"literal":"Alfonso Ladino","given":"Alfonso","family":"Ladino"},"name":"Alfonso Ladino","orcid":"0000-0001-8081-7827","github":"aladinor","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Anna del Moral Méndez","given":"Anna","non_dropping_particle":"del","family":"Moral Méndez"},"name":"Anna del Moral Méndez","orcid":"0000-0002-5015-840X","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Brenda Javornik","given":"Brenda","family":"Javornik"},"name":"Brenda Javornik","orcid":"0009-0004-9266-9293","github":"leavesntwigs","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Daniel Michelson","given":"Daniel","family":"Michelson"},"name":"Daniel Michelson","orcid":"0000-0003-3222-9881","github":"DanielMichelson","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Daniel Wolfensberger","given":"Daniel","family":"Wolfensberger"},"name":"Daniel Wolfensberger","orcid":"0009-0006-1419-0556","github":"wolfidan","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Gionata Ghiggi","given":"Gionata","family":"Ghiggi"},"name":"Gionata Ghiggi","orcid":"0000-0002-0818-0865","github":"ghiggi","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Jen DeHart","given":"Jen","family":"DeHart"},"name":"Jen DeHart","orcid":"0000-0001-8536-4927","github":"jcdehart","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Jordi Figueras i Ventura","given":"Jordi Figueras","non_dropping_particle":"i","family":"Ventura"},"name":"Jordi Figueras i Ventura","orcid":"0000-0002-4949-422X","github":"jfigui","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Julian Giles","given":"Julian","family":"Giles"},"name":"Julian Giles","orcid":"0000-0001-8134-008X","github":"JulianGiles","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Kai Mühlbauer","given":"Kai","family":"Mühlbauer"},"name":"Kai Mühlbauer","orcid":"0000-0001-6599-1034","github":"kmuehlbauer","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Maxwell Grover","given":"Maxwell","family":"Grover"},"name":"Maxwell Grover","orcid":"0000-0002-0370-8974","github":"mgrover1","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Mike Dixon","given":"Mike","family":"Dixon"},"name":"Mike Dixon","orcid":"0000-0002-9597-9113","github":"mike-dixon","id":"contributors-myst-generated-uid-11"},{"nameParsed":{"literal":"Robert Jackson","given":"Robert","family":"Jackson"},"name":"Robert Jackson","orcid":"0000-0003-2518-1234","github":"rcjackson","id":"contributors-myst-generated-uid-12"},{"nameParsed":{"literal":"Scott Collis","given":"Scott","family":"Collis"},"name":"Scott Collis","orcid":"0000-0002-2303-687X","github":"scollis","id":"contributors-myst-generated-uid-13"},{"nameParsed":{"literal":"Ting-Yu Cha","given":"Ting-Yu","family":"Cha"},"name":"Ting-Yu Cha","orcid":"0000-0002-6292-8483","github":"tingyucha","id":"contributors-myst-generated-uid-14"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","name":"Apache License 2.0","osi":true,"free":true,"url":"https://opensource.org/licenses/Apache-2.0"},"code":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"}},"github":"https://github.com/openradar/erad2024","copyright":"2024","abbreviations":{"ARM":"Atmospheric Radiation Measurement","NCAR":"National Center for Atmospheric Research"},"settings":{"output_matplotlib_strings":"remove"},"thumbnail":"/erad2024/build/cc72069fb56e0a54f1123fbe9c2fcb76.png","exports":[{"format":"ipynb","filename":"SR_GR_Matching_Procedure.ipynb","url":"/erad2024/build/SR_GR_Matching_Proce-b6203428c38e5e184cb8c76128d04277.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this tutorial, we demonstrate how to exploit GPM-API along with other radar software such\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TWl3liTbCA"},{"type":"link","url":"https://docs.openradarscience.org/projects/xradar/en/stable/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"xradar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pnZthEE7Pz"}],"urlSource":"https://docs.openradarscience.org/projects/xradar/en/stable/","key":"zJtmLiXJCL"},{"type":"text","value":" and\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ztwbrMcMFP"},{"type":"link","url":"https://docs.wradlib.org/en/latest/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"wradlib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ncvSzfsRvV"}],"urlSource":"https://docs.wradlib.org/en/latest/","key":"W6ZmyO4MbX"},{"type":"text","value":" to match reflectivities measurements of spaceborne (SR) and ground (GR) radars.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Dv65gUu2tt"}],"key":"Tge4RixU5p"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We guide you step-by-step through the process of obtaining spatially and temporally coincident radar samples.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bYDQh0xIqI"}],"key":"OfhuMwYsjv"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The procedure, based on ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JL7hmsbxi5"},{"type":"cite","url":"https://doi.org/10.1175/2010JTECHA1403.1","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Schwaller and Morris (2011)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"RaFUON0IyE"}],"kind":"narrative","label":"Schwaller_2011","identifier":"https://doi.org/10.1175/2010JTECHA1403.1","enumerator":"1","key":"gyC9dBcjho"},{"type":"text","value":" and adapted by ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"RtnUurIvN3"},{"type":"cite","url":"https://doi.org/10.1175/JTECH-D-17-0128.1","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Warren, et. al. (2018)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"K7KvfqVCp9"}],"kind":"narrative","label":"Warren_2018","identifier":"https://doi.org/10.1175/JTECH-D-17-0128.1","enumerator":"2","key":"bxcndImxDY"},{"type":"text","value":", involves:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WFa2u40Ywn"}],"key":"HJh9akyDtn"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"averaging SR reflectivities vertically along the SR beam between the half-power points of the GR sweep.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"X06nOLg6l6"}],"key":"hC5Rjv49Xm"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"averaging GR reflectivities horizontally within the SR beam’s footprint.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"z5JxhKeIw9"}],"key":"NCiIQicGdh"}],"key":"IAZzKfokou"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The basic principle is illustrated in Fig. 2 of the original paper of Schwaller and Morris (2011).","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"SUe5jS39qE"}],"key":"EPSCtxHKks"},{"type":"image","url":"/erad2024/build/cc72069fb56e0a54f1123fbe9c2fcb76.png","alt":"figure 2","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"VLKohuLDef","urlSource":"https://raw.githubusercontent.com/ghiggi/gpm_api/main/docs/source/static/fig2_schwaller_morris_2011.png"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Warren et al. (2018) describe the method as follows:\n","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"opesa31918"},{"type":"emphasis","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"“[...] intersections between individual SR beams and GR elevation sweeps are identified and the reflectivity values from both  instruments are averaged within a spatial neighborhood around the intersection.\nSpecifically, SR data are averaged in range over the width of the GR beam at the GR range of the intersection, while GR data are averaged in the range–azimuth plane within the footprint of the SR beam.\nThe result is a pair of reflectivity measurements corresponding to approximately the same volume of atmosphere. [...]”.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"XkCtfryxzZ"}],"key":"ul5Q9mEa94"}],"key":"Zl2ZVqbcw6"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"The procedure should become clearer in Fig. 3:","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"kdwS1r2eTY"}],"key":"yNwVlzLGJe"},{"type":"image","url":"/erad2024/build/93c53af642c2e2adf0ec8670f4a9a2f4.png","alt":"figure 3","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"rCsVBZNH8z","urlSource":"https://raw.githubusercontent.com/ghiggi/gpm_api/main/docs/source/static/fig3_schwaller_morris_2011.png"}],"key":"IFlOqTBX8p"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Relevant software","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lz7qh85ko7"}],"identifier":"relevant-software","label":"Relevant software","html_id":"relevant-software","implicit":true,"key":"eJQlIOv4iJ"}],"key":"XhwYvOZlYq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"To run this tutorial, it is necessary to install additional libraries which are not automatically required by GPM-API.\nThe libraries are\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gByU6Fif0y"},{"type":"link","url":"https://docs.openradarscience.org/projects/xradar/en/stable/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"xradar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V2t7eUe1bT"}],"urlSource":"https://docs.openradarscience.org/projects/xradar/en/stable/","key":"w3bp78epWE"},{"type":"text","value":",\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ugeA8xFGzS"},{"type":"link","url":"https://docs.wradlib.org/en/latest/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"wradlib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GiMisav7Jr"}],"urlSource":"https://docs.wradlib.org/en/latest/","key":"goriM1aeOj"},{"type":"text","value":",\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RMgH8wNwYk"},{"type":"link","url":"https://geopandas.org/en/stable/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"geopandas","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jGm2tW87DR"}],"urlSource":"https://geopandas.org/en/stable/","key":"F5zI5Fedsq"},{"type":"text","value":",\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"paKXLeA633"},{"type":"link","url":"https://filesystem-spec.readthedocs.io/en/latest/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"fsspec","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MBC9yaMe6M"}],"urlSource":"https://filesystem-spec.readthedocs.io/en/latest/","key":"HiF6AqL8wS"},{"type":"text","value":",\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VqaHrhahdT"},{"type":"link","url":"https://s3fs.readthedocs.io/en/latest/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"s3fs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zuTwisDgt0"}],"urlSource":"https://s3fs.readthedocs.io/en/latest/","key":"NjqmAfQlUD"},{"type":"text","value":" and\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ij9bBexoEK"},{"type":"link","url":"https://python-visualization.github.io/folium/latest/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"folium","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XmqUW22VQ8"}],"urlSource":"https://python-visualization.github.io/folium/latest/","key":"xis2wvjenD"},{"type":"text","value":".\nYou can install them with terminal command ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bG3XfZaxbt"},{"type":"inlineCode","value":"conda install -c conda-forge xradar wradlib geopandas fsspec s3fs folium","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OPpF2UrgkA"}],"key":"cVfquyZBhG"}],"key":"gr79IbqGEk"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you have such libraries installed, you can start importing the required packages:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hp46Tf8CHP"}],"key":"VESSNMXpQh"}],"key":"B20pRFWFCz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:13.691264Z","iopub.status.busy":"2024-09-08T07:00:13.691099Z","iopub.status.idle":"2024-09-08T07:00:15.569488Z","shell.execute_reply":"2024-09-08T07:00:15.568911Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import warnings\n\nwarnings.filterwarnings(\"ignore\")\nimport datetime\nfrom functools import reduce\n\nimport cartopy.crs as ccrs\nimport fsspec\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport wradlib as wrl\nimport xarray as xr\nimport xradar as xd\nfrom IPython.display import display\nfrom shapely import Point\nfrom xarray.backends.api import open_datatree\nimport gpm\nfrom gpm.gv.routines import (\n    convert_s_to_ku_band,\n    retrieve_gates_projection_coordinates,\n    xyz_to_antenna_coordinates,\n)\nfrom gpm.utils.remapping import reproject_coords\nfrom gpm.utils.zonal_stats import PolyAggregator\n\nnp.set_printoptions(suppress=True)","key":"hFu2c4ycYc"},{"type":"output","id":"6txzrbwhGuDcG7CbitXE5","data":[],"key":"so9gHTDCmC"}],"key":"HvKdoa3i1q"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load SR and GR data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V2fwIHr4ho"}],"identifier":"load-sr-and-gr-data","label":"Load SR and GR data","html_id":"load-sr-and-gr-data","implicit":true,"key":"hk3iycK8xS"}],"key":"JbRa5zerXY"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this tutorial, we exploit a coincident GPM DPR and NEXRAD overpass over San Diego, USA, during the landfall of Tropical Storm Hilary in 2023, to illustrate step-by-step the SR/GR volume matching procedure.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UpjWgpECyH"}],"key":"g7JCGDWjGS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To facilitate your hands-on experience, we’ve preprocessed the native NEXRAD radar data using the xradar package and the coincident GPM DPR overpass using GPM-API. The resulting data has been uploaded in Zarr format to the Pythia Cloud Bucket, allowing you to start the tutorial directly in the Binder environment.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZeD7iSbyvL"}],"key":"hJ2RxHyFcb"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"If you wish to adapt this tutorial to your own case study, you can use the xradar package to read your GR radar data into the expected xarray format. Similarly, you can retrieve the relevant GPM data using GPM-API. The GPM-API ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"axCWz7hqg4"},{"type":"link","url":"https://gpm-api.readthedocs.io/en/latest/tutorials/tutorial_03_SR_GR_Matching.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Spaceborne-Ground Radar Matching Tutorial","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Q9BePLft66"}],"urlSource":"https://gpm-api.readthedocs.io/en/latest/tutorials/tutorial_03_SR_GR_Matching.html","key":"ZEvB3k5Emm"},{"type":"text","value":" shows how to read NEXRAD GR data directly from the AWS S3 bucket and how to download the GPM data of interest using GPM-API.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LQjetvB4cl"}],"key":"Agjb1oqFKI"}],"key":"IbDVgdeDQZ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To start this tutorial let’s open the NEXRAD ground radar data and the GPM granule with the coincident overpass.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JbqvhaP3Fu"}],"key":"Tu6Puf1845"}],"key":"q1s4J2srrs"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:15.572112Z","iopub.status.busy":"2024-09-08T07:00:15.571609Z","iopub.status.idle":"2024-09-08T07:00:15.708799Z","shell.execute_reply":"2024-09-08T07:00:15.708315Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open fsspec connection to the bucket\nbucket_url = \"https://js2.jetstream-cloud.org:8001\"\nfs = fsspec.filesystem(\"s3\", anon=True, client_kwargs=dict(endpoint_url=bucket_url))","key":"oPXQUf5IQF"},{"type":"output","id":"EE29EO6ZcTdThTMtYryJ1","data":[],"key":"tEBOJ2mSgV"}],"key":"ITsfhKCjPh"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:15.711341Z","iopub.status.busy":"2024-09-08T07:00:15.710823Z","iopub.status.idle":"2024-09-08T07:00:20.239440Z","shell.execute_reply":"2024-09-08T07:00:20.238925Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open the GR datatree\nfile = fs.get_mapper(f\"pythia/radar/erad2024/gpm_api/KNKX20230820_221341_V06.zarr\")\ndt_gr = open_datatree(file, engine=\"zarr\", consolidated=True, chunks={})\ndisplay(dt_gr)","key":"TPsXM4pNqh"},{"type":"output","id":"3BmbFTGVmnEC4q66__G5a","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"8eb829fd97e92a19d86378b30f003042","path":"/erad2024/build/8eb829fd97e92a19d86378b30f003042.html"},"text/plain":{"content_type":"text/plain","hash":"a4ed0eb4ad3ad105da250c49d6296045","path":"/erad2024/build/a4ed0eb4ad3ad105da250c49d6296045.txt"}}}],"key":"GI5OJFpYIn"}],"key":"rfIt3iMG9Q"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:20.248886Z","iopub.status.busy":"2024-09-08T07:00:20.248356Z","iopub.status.idle":"2024-09-08T07:00:20.536333Z","shell.execute_reply":"2024-09-08T07:00:20.535865Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open the SR dataset\nfile = fs.get_mapper(\n    f\"pythia/radar/erad2024/gpm_api/2A.GPM.DPR.V9-20211125.20230820-S213941-E231213.053847.V07B.zarr\"\n)\nds_sr = xr.open_zarr(file, consolidated=True, chunks={})","key":"TlUVUhRP44"},{"type":"output","id":"GTxirMv-5zDn8Bawyjj7l","data":[],"key":"vYhM6iCBgU"}],"key":"YKnnBQ0jCu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"During this tutorial we will use only the GPM DPR Ku band reflectivities, therefore we subset the dataset here to facilitate the analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n2N2r1mEAr"}],"key":"oKNdWv7Tls"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Please note that the GPM DPR reflectivites measurements are provided by the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zlQ4Lq0vV3"},{"type":"inlineCode","value":"ZFactorFinal","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nuIUhbjIxX"},{"type":"text","value":"and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eeN6r06nXb"},{"type":"inlineCode","value":"ZFactorMeasured","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Lc8Q7PIJea"},{"type":"text","value":" variables:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PI9KYwmAhO"}],"key":"OYG7UGD1kb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HNXvmXPiTO"},{"type":"inlineCode","value":"ZFactorMeasured","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MdLz1bFo88"},{"type":"text","value":" variable contains the reflectivity measurements with sidelobe clutter removed. However, it still includes ground clutter, background noise, and is not corrected for atmospheric and hydrometeors attenuation.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ILrOKTMT58"}],"key":"Wamouc7dZa"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TaXTrXsM6w"},{"type":"inlineCode","value":"ZFactorFinal","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"W4UABH1inV"},{"type":"text","value":" represents the reflectivity measurements with background noise, ground clutter, and sidelobe clutter removed. The reflectivites have been corrected atmospheric and hydrometeors attenuation.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lirnVElc6L"}],"key":"tJkrsxmZC9"}],"key":"wf3eZhGlyE"}],"key":"yzlUGSUflr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:20.538582Z","iopub.status.busy":"2024-09-08T07:00:20.538236Z","iopub.status.idle":"2024-09-08T07:00:20.550202Z","shell.execute_reply":"2024-09-08T07:00:20.549761Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"ds_sr = ds_sr.sel({\"radar_frequency\": \"Ku\"})","key":"M6JpoIAH0k"},{"type":"output","id":"g9eR1sc6jOkTIgdTKNgTK","data":[],"key":"ussIfDdOIz"}],"key":"iKWzSr8BL2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:20.551844Z","iopub.status.busy":"2024-09-08T07:00:20.551686Z","iopub.status.idle":"2024-09-08T07:00:20.874619Z","shell.execute_reply":"2024-09-08T07:00:20.874064Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"display(ds_sr)","key":"ECDhecvu2B"},{"type":"output","id":"vDwrdUX3g8hEJQPJ082ur","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"cd93b4efbac8cd4232efd1a54e3c801e","path":"/erad2024/build/cd93b4efbac8cd4232efd1a54e3c801e.html"},"text/plain":{"content":"<xarray.Dataset> Size: 5GB\nDimensions:                        (cross_track: 49, along_track: 7932,\n                                    range: 176, DSD_params: 2, four: 4,\n                                    method: 6, three: 3, nfreqHI: 3, nNode: 5,\n                                    nNUBF: 3, nNP: 4, foreBack: 2, nearFar: 2,\n                                    XYZ: 3, nbinSZP: 7, nsdew: 3)\nCoordinates: (12/16)\n  * DSD_params                     (DSD_params) <U2 16B 'Nw' 'Dm'\n    SCorientation                  (along_track) float32 32kB dask.array<chunksize=(7932,), meta=np.ndarray>\n    crsWGS84                       int64 8B ...\n    dataQuality                    (along_track) float32 32kB dask.array<chunksize=(7932,), meta=np.ndarray>\n    gpm_along_track_id             (along_track) int64 63kB dask.array<chunksize=(7932,), meta=np.ndarray>\n    gpm_cross_track_id             (cross_track) int64 392B dask.array<chunksize=(49,), meta=np.ndarray>\n    ...                             ...\n    lat                            (cross_track, along_track) float32 2MB dask.array<chunksize=(49, 7932), meta=np.ndarray>\n    lon                            (cross_track, along_track) float32 2MB dask.array<chunksize=(49, 7932), meta=np.ndarray>\n    radar_frequency                <U2 8B 'Ku'\n  * range                          (range) int64 1kB 1 2 3 4 ... 173 174 175 176\n    sunLocalTime                   (cross_track, along_track) float32 2MB dask.array<chunksize=(25, 3966), meta=np.ndarray>\n    time                           (along_track) datetime64[ns] 63kB dask.array<chunksize=(7932,), meta=np.ndarray>\nDimensions without coordinates: cross_track, along_track, four, method, three,\n                                nfreqHI, nNode, nNUBF, nNP, foreBack, nearFar,\n                                XYZ, nbinSZP, nsdew\nData variables: (12/142)\n    DFRforward1                    (cross_track, along_track, range) float32 274MB dask.array<chunksize=(49, 500, 176), meta=np.ndarray>\n    Dm                             (cross_track, along_track, range) float32 274MB dask.array<chunksize=(49, 500, 176), meta=np.ndarray>\n    FractionalGranuleNumber        (along_track) float64 63kB dask.array<chunksize=(500,), meta=np.ndarray>\n    MSindex                        (cross_track, along_track) float64 3MB dask.array<chunksize=(49, 500), meta=np.ndarray>\n    MSindexKa                      (cross_track, along_track) float64 3MB dask.array<chunksize=(49, 500), meta=np.ndarray>\n    MSindexKu                      (cross_track, along_track) float64 3MB dask.array<chunksize=(49, 500), meta=np.ndarray>\n    ...                             ...\n    widthBB                        (cross_track, along_track) float32 2MB dask.array<chunksize=(25, 3966), meta=np.ndarray>\n    zFactorFinal                   (cross_track, along_track, range) float32 274MB dask.array<chunksize=(49, 500, 176), meta=np.ndarray>\n    zFactorFinalESurface           (cross_track, along_track) float32 2MB dask.array<chunksize=(49, 500), meta=np.ndarray>\n    zFactorFinalNearSurface        (cross_track, along_track) float32 2MB dask.array<chunksize=(49, 500), meta=np.ndarray>\n    zFactorMeasured                (cross_track, along_track, range) float32 274MB dask.array<chunksize=(49, 500, 176), meta=np.ndarray>\n    zeta                           (cross_track, along_track) float32 2MB dask.array<chunksize=(49, 500), meta=np.ndarray>\nAttributes: (12/23)\n    AlgorithmID:           2ADPR\n    AlgorithmVersion:      9.20211125\n    AttitudeFileName:      \n    DOI:                   10.5067/GPM/DPR/GPM/2A/07\n    DOIauthority:          http://dx.doi.org/\n    DataFormatVersion:     7h\n    ...                    ...\n    ProductVersion:        V07B\n    SatelliteName:         GPM\n    ScanMode:              FS\n    TotalQualityCode:      Good\n    gpm_api_product:       2A-DPR\n    history:               Created by ghiggi/gpm_api software on 2024-08-22 1...","content_type":"text/plain"}}}],"key":"ikEPTRRHfE"}],"key":"kiK5eSFRCP"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define settings for SR/GR matching","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KTA7E0oQOX"}],"identifier":"define-settings-for-sr-gr-matching","label":"Define settings for SR/GR matching","html_id":"define-settings-for-sr-gr-matching","implicit":true,"key":"wD9nCpuVlb"}],"key":"tmr5YjxGr9"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here, we define key parameters and settings necessary for the SR/GR comparison. Minimum reflectivity thresholds are applied to exclude certain radar gates from the analysis, primarily to distinguish precipitating regions.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gYd0jjPdSz"}],"key":"i0JjKirPuM"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We strongly recommend specifying an “optimistic” minimum reflectivity sensitivity threshold, as reflectivities may be biased, and this approach allows for the assessment of non-uniform beam filling (NUBF) during the SR/GR matching process.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kcVGDUFe7I"}],"key":"RrePGP6tN5"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"More restrictive filtering can be applied after the SR/GR gate matching is completed.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HfQhHbIbFX"}],"key":"onJS43jOSM"}],"key":"MFHYIYtD8d"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:20.885802Z","iopub.status.busy":"2024-09-08T07:00:20.885626Z","iopub.status.idle":"2024-09-08T07:00:20.889731Z","shell.execute_reply":"2024-09-08T07:00:20.889237Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define half power beam width angle (in degrees)\nazimuth_beamwidth_gr = 1.0\nelevation_beamwidth_gr = 1.0\n\n# Define Z min threshold\nz_min_threshold_gr = 0  # to remove dry case\nz_min_threshold_sr = 10\n\n# GR matching ROI\nmin_gr_range_lb = 0\nmax_gr_range_ub = 150_000\n\n# Define SR CRS\ncrs_sr = ds_sr.gpm.pyproj_crs","key":"f5oboUlKM8"},{"type":"output","id":"cBfA-_xYZX50glXwQ1MYk","data":[],"key":"dHcegzslPU"}],"key":"hWFQfL1wDX"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Preprocess GR data with xradar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qDJWUzQur3"}],"identifier":"preprocess-gr-data-with-xradar","label":"Preprocess GR data with xradar","html_id":"preprocess-gr-data-with-xradar","implicit":true,"key":"dLwCO5uNwY"}],"key":"WxFy7XAjyr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we select the GR sweep, we georeference the dataset, we set the GR CRS and we extract GR radar gates coordinates.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k2wIh8i6Tz"}],"key":"AcB0ivP9aW"}],"key":"IkFD84HVi5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:20.892142Z","iopub.status.busy":"2024-09-08T07:00:20.891760Z","iopub.status.idle":"2024-09-08T07:00:20.894449Z","shell.execute_reply":"2024-09-08T07:00:20.893953Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sweep_idx = 0\nsweep_group = f\"sweep_{sweep_idx}\"  # GR sweep (elevation to be used)","key":"j0MOAKe7DJ"},{"type":"output","id":"R5LjopcCKoOlrt-m-fXe6","data":[],"key":"CSaFiOYnJO"}],"key":"vqFV9EO46X"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:20.896468Z","iopub.status.busy":"2024-09-08T07:00:20.896089Z","iopub.status.idle":"2024-09-08T07:00:21.917737Z","shell.execute_reply":"2024-09-08T07:00:21.917213Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select sweep dataset\nds_gr = dt_gr[sweep_group].to_dataset().compute()\n\nprint(\"Sweep Mode:\", ds_gr[\"sweep_mode\"].to_numpy())\nprint(\"Sweep Elevation Angle:\", ds_gr[\"sweep_fixed_angle\"].to_numpy())\n\n# Set auxiliary info as coordinates\n# - To avoid broadcasting i.e. when masking\npossible_coords = [\"sweep_mode\", \"sweep_number\", \"prt_mode\", \"follow_mode\", \"sweep_fixed_angle\"]\nextra_coords = [coord for coord in possible_coords if coord in ds_gr]\nds_gr = ds_gr.set_coords(extra_coords)","key":"azUVVwPSp5"},{"type":"output","id":"u1OIyfjcqy8eSjFZSAjg6","data":[{"name":"stdout","output_type":"stream","text":"Sweep Mode: azimuth_surveillance\nSweep Elevation Angle: 0.4833984375\n"}],"key":"NcbNVVoSQg"}],"key":"LffxRXfpaF"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:21.920097Z","iopub.status.busy":"2024-09-08T07:00:21.919649Z","iopub.status.idle":"2024-09-08T07:00:21.973448Z","shell.execute_reply":"2024-09-08T07:00:21.972918Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Georeference the data on a azimuthal_equidistant projection centered on the radar\nds_gr = ds_gr.xradar.georeference()\nds_gr[\"crs_wkt\"].attrs","key":"BQ9efRy6oF"},{"type":"output","id":"ziv9o3YiaoguejfCi9uKR","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"{'crs_wkt': 'PROJCRS[\"unknown\",BASEGEOGCRS[\"unknown\",DATUM[\"World Geodetic System 1984\",ELLIPSOID[\"WGS 84\",6378137,298.257223563,LENGTHUNIT[\"metre\",1]],ID[\"EPSG\",6326]],PRIMEM[\"Greenwich\",0,ANGLEUNIT[\"degree\",0.0174532925199433],ID[\"EPSG\",8901]]],CONVERSION[\"unknown\",METHOD[\"Azimuthal Equidistant\",ID[\"EPSG\",1125]],PARAMETER[\"Latitude of natural origin\",32.919017791748,ANGLEUNIT[\"degree\",0.0174532925199433],ID[\"EPSG\",8801]],PARAMETER[\"Longitude of natural origin\",-117.041801452637,ANGLEUNIT[\"degree\",0.0174532925199433],ID[\"EPSG\",8802]],PARAMETER[\"False easting\",0,LENGTHUNIT[\"metre\",1],ID[\"EPSG\",8806]],PARAMETER[\"False northing\",0,LENGTHUNIT[\"metre\",1],ID[\"EPSG\",8807]]],CS[Cartesian,2],AXIS[\"(E)\",east,ORDER[1],LENGTHUNIT[\"metre\",1,ID[\"EPSG\",9001]]],AXIS[\"(N)\",north,ORDER[2],LENGTHUNIT[\"metre\",1,ID[\"EPSG\",9001]]]]',\n 'semi_major_axis': 6378137.0,\n 'semi_minor_axis': 6356752.314245179,\n 'inverse_flattening': 298.257223563,\n 'reference_ellipsoid_name': 'WGS 84',\n 'longitude_of_prime_meridian': 0.0,\n 'prime_meridian_name': 'Greenwich',\n 'geographic_crs_name': 'unknown',\n 'horizontal_datum_name': 'World Geodetic System 1984',\n 'projected_crs_name': 'unknown',\n 'grid_mapping_name': 'azimuthal_equidistant',\n 'latitude_of_projection_origin': 32.91901779174805,\n 'longitude_of_projection_origin': -117.04180145263672,\n 'false_easting': 0.0,\n 'false_northing': 0.0}","content_type":"text/plain"}}}],"key":"utbeXHVfkL"}],"key":"e47nVXLNMB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:21.975761Z","iopub.status.busy":"2024-09-08T07:00:21.975583Z","iopub.status.idle":"2024-09-08T07:00:21.991948Z","shell.execute_reply":"2024-09-08T07:00:21.991463Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get the GR CRS\ncrs_gr = ds_gr.xradar_dev.pyproj_crs","key":"k3l0JPMM7V"},{"type":"output","id":"7To2rje4jC1ygX7GXx340","data":[],"key":"Sc1VMVBEAQ"}],"key":"KSwSBzKRDZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:21.993791Z","iopub.status.busy":"2024-09-08T07:00:21.993621Z","iopub.status.idle":"2024-09-08T07:00:22.681156Z","shell.execute_reply":"2024-09-08T07:00:22.680570Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add lon/lat coordinates to GR\n# - Useful for plotting ;)\nlon_gr, lat_gr, height_gr = reproject_coords(x=ds_gr[\"x\"], y=ds_gr[\"y\"], z=ds_gr[\"z\"], src_crs=crs_gr, dst_crs=crs_sr)\nds_gr[\"lon\"] = lon_gr\nds_gr[\"lat\"] = lat_gr\nds_gr = ds_gr.set_coords([\"lon\", \"lat\"])","key":"DYjdQK2uGo"},{"type":"output","id":"CtKQyrngS18JrReFesssX","data":[],"key":"fmKzcBtYeM"}],"key":"V7ZRdflyW6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:22.683575Z","iopub.status.busy":"2024-09-08T07:00:22.683408Z","iopub.status.idle":"2024-09-08T07:00:22.703515Z","shell.execute_reply":"2024-09-08T07:00:22.702959Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set GR gates with Z < 0 to NaN\n# - Following Morris and Schwaller 2011 recommendation\nds_gr = ds_gr.where(ds_gr[\"DBZH\"] >= 0)","key":"eopmKDWJc9"},{"type":"output","id":"1LSkdxokRYN9m9TXsRryz","data":[],"key":"iz8FykleHk"}],"key":"kGkDj1NmqZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:22.705931Z","iopub.status.busy":"2024-09-08T07:00:22.705735Z","iopub.status.idle":"2024-09-08T07:00:31.622478Z","shell.execute_reply":"2024-09-08T07:00:31.621971Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show some GR fields\nds_gr[\"DBZH\"].xradar_dev.plot_map()\nds_gr[\"RHOHV\"].xradar_dev.plot_map()","key":"EvBw1eGY5P"},{"type":"output","id":"uHlaTt6SNcBlJbnCovbwz","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5ce96c90>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f6a366e8db38782e0b8ab41855aec2f9","path":"/erad2024/build/f6a366e8db38782e0b8ab41855aec2f9.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8e9cab792ad1638eb3623f948e2ba5d7","path":"/erad2024/build/8e9cab792ad1638eb3623f948e2ba5d7.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"HtvAIs2VAa"}],"key":"vgfeOCIcnG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:31.624595Z","iopub.status.busy":"2024-09-08T07:00:31.624230Z","iopub.status.idle":"2024-09-08T07:00:31.631999Z","shell.execute_reply":"2024-09-08T07:00:31.631588Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Retrieve GR extent\nextent_gr = ds_gr.xradar_dev.extent(max_distance=None, crs=None)\nextent_gr","key":"nSe5RQjEFC"},{"type":"output","id":"3GBmgU0HFq80vuoTZBepZ","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"[-121.95467110437517,\n -112.12893180089884,\n 28.771031109975677,\n 37.06425438465268]","content_type":"text/plain"}}}],"key":"WVeOSA4cqZ"}],"key":"EB56KML92W"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Preprocess SR data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u5JbfmMh7J"}],"identifier":"preprocess-sr-data","label":"Preprocess SR data","html_id":"preprocess-sr-data","implicit":true,"key":"z4YQZ3PEG3"}],"key":"O6CHztlelW"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s start by cropping the SR granule on the GR extent and put data into memory:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CB2YcUuUHK"}],"key":"seAipTb9Fz"}],"key":"WSdvCfppME"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:31.633955Z","iopub.status.busy":"2024-09-08T07:00:31.633624Z","iopub.status.idle":"2024-09-08T07:00:34.338876Z","shell.execute_reply":"2024-09-08T07:00:34.338293Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"ds_sr = ds_sr.gpm.crop(extent_gr).compute()","key":"mZylHQ8gI9"},{"type":"output","id":"lZsoUUE2_Bit8NUcT_GAZ","data":[],"key":"UDbLsT2bTY"}],"key":"CAuJRvYxIQ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can further subset the GPM overpass selecting the scans occured between the following timesteps:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yhmHPV50ef"}],"key":"pQnvy5H3TS"}],"key":"MMMqPKPMuF"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:34.341460Z","iopub.status.busy":"2024-09-08T07:00:34.340986Z","iopub.status.idle":"2024-09-08T07:00:34.374459Z","shell.execute_reply":"2024-09-08T07:00:34.373803Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"start_time = datetime.datetime.strptime(\"2023-08-20 22:12:00\", \"%Y-%m-%d %H:%M:%S\")\nend_time = datetime.datetime.strptime(\"2023-08-20 22:13:45\", \"%Y-%m-%d %H:%M:%S\")\nds_sr = ds_sr.gpm.sel(time=slice(start_time, end_time))","key":"lFJIbnGoAj"},{"type":"output","id":"2coVcInnWHoz2kUEB0pEt","data":[],"key":"smA2tSimej"}],"key":"fhPp1V3cjv"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now let’s display some variables illustrating the GPM overpass","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NCbtMhVqYG"}],"key":"MPfa4ORr7V"}],"key":"lcejV8izye"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:34.377018Z","iopub.status.busy":"2024-09-08T07:00:34.376835Z","iopub.status.idle":"2024-09-08T07:00:36.084682Z","shell.execute_reply":"2024-09-08T07:00:36.084128Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"ds_sr[\"precipRateNearSurface\"].gpm.plot_map()\nds_sr[\"zFactorMeasured\"].gpm.slice_range_at_bin(ds_sr[\"binClutterFreeBottom\"]).gpm.plot_map(\n    vmax=40,\n)  # zFactorMeasuredNearSurface\nds_sr[\"zFactorFinalNearSurface\"].gpm.plot_map(vmax=40)\nds_sr[\"flagPrecip\"].gpm.plot_map()","key":"VMlVhifimZ"},{"type":"output","id":"ogxlmHW69JugIqCVOZY4g","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5ccf6490>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7ed85a8083cdb44e053a26d9b8ae27fa","path":"/erad2024/build/7ed85a8083cdb44e053a26d9b8ae27fa.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ee7c417f3e6316dc4a6b87bbc558a326","path":"/erad2024/build/ee7c417f3e6316dc4a6b87bbc558a326.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6413220e5698f8357fd077c32fd12285","path":"/erad2024/build/6413220e5698f8357fd077c32fd12285.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d3e34621f0f5b74bb1eabc917866490a","path":"/erad2024/build/d3e34621f0f5b74bb1eabc917866490a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"UwlxmGhSzi"}],"key":"oCxI67ZcxU"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the following map and cross-sections, we can see that the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mEpbuE8cZ7"},{"type":"inlineCode","value":"zFactorMeasured","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ejo0QOpsDo"},{"type":"text","value":" variable is contaminated by ground clutter:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xmGSm7R5T0"}],"key":"GUyLhjRLm1"}],"key":"zVfTEPGifc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:36.086958Z","iopub.status.busy":"2024-09-08T07:00:36.086598Z","iopub.status.idle":"2024-09-08T07:00:36.888489Z","shell.execute_reply":"2024-09-08T07:00:36.887924Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display the maximum observed reflectivity\nds_sr[\"zFactorMeasured\"].max(dim=\"range\").gpm.plot_map()\nds_sr[\"zFactorFinal\"].max(dim=\"range\").gpm.plot_map(vmax=40)","key":"JZKLnv66ii"},{"type":"output","id":"VRu61cmjQBcOFDeOnopvW","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f50c36610>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b9d4e0f81cf20abda9c06ad51a0dc867","path":"/erad2024/build/b9d4e0f81cf20abda9c06ad51a0dc867.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"911bb6696dcef801a60647d01e9033bd","path":"/erad2024/build/911bb6696dcef801a60647d01e9033bd.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"KP4wHfznmT"}],"key":"YIphkZ5zN4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:36.890790Z","iopub.status.busy":"2024-09-08T07:00:36.890399Z","iopub.status.idle":"2024-09-08T07:00:36.898241Z","shell.execute_reply":"2024-09-08T07:00:36.897720Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute SR attenuation correction\nds_sr[\"zFactorCorrection\"] = ds_sr[\"zFactorFinal\"] - ds_sr[\"zFactorMeasured\"]","key":"XK5TAqGyXI"},{"type":"output","id":"TUp7LIgarOvlzj1n2BUtK","data":[],"key":"BPNTiguTRY"}],"key":"WIig2lQ3et"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:36.900179Z","iopub.status.busy":"2024-09-08T07:00:36.899995Z","iopub.status.idle":"2024-09-08T07:00:37.494164Z","shell.execute_reply":"2024-09-08T07:00:37.493614Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display cross-section\nds_sr[\"zFactorMeasured\"].isel(cross_track=24).gpm.plot_cross_section(zoom=False)\nds_sr[\"zFactorFinal\"].isel(cross_track=24).gpm.plot_cross_section(zoom=False)\nds_sr[\"zFactorCorrection\"].isel(cross_track=24).gpm.plot_cross_section(vmin=0, vmax=3, cmap=\"Spectral_r\", zoom=False)","key":"l3X8WtGFkj"},{"type":"output","id":"gCT9o4gtQDf1YfOopVH_T","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a8c0b5c8438002949c47e4c866761dee","path":"/erad2024/build/a8c0b5c8438002949c47e4c866761dee.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"14b7bc7e01f058a6814c28982a10def2","path":"/erad2024/build/14b7bc7e01f058a6814c28982a10def2.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d9d35dcee96373af08b99126776f4eb6","path":"/erad2024/build/d9d35dcee96373af08b99126776f4eb6.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"HiJwoHLkQx"}],"key":"b5vmfFizvH"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So now we mask out gates impacted by ground clutter, adn we verify with maps and cross-sections that the ground clutter is effectively removed:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NchV4kGiLE"}],"key":"sKFygoExEK"}],"key":"ImcAL2cRic"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:37.496647Z","iopub.status.busy":"2024-09-08T07:00:37.496147Z","iopub.status.idle":"2024-09-08T07:00:37.537668Z","shell.execute_reply":"2024-09-08T07:00:37.537174Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Mask SR gates with ground clutter\nds_sr[\"zFactorMeasured\"] = ds_sr[\"zFactorMeasured\"].gpm.mask_below_bin(\n    bins=ds_sr[\"binClutterFreeBottom\"],\n    strict=False,\n)  # do not mask the specified bin\nds_sr[\"zFactorCorrection\"] = ds_sr[\"zFactorCorrection\"].gpm.mask_below_bin(\n    bins=ds_sr[\"binClutterFreeBottom\"],\n    strict=False,\n)  # do not mask the specified bin","key":"FYDiAyoK6o"},{"type":"output","id":"fS3VgBfwIhqQQU_lOhzlW","data":[],"key":"zpVuKpsM4e"}],"key":"m5Gja2RzAX"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:37.539835Z","iopub.status.busy":"2024-09-08T07:00:37.539664Z","iopub.status.idle":"2024-09-08T07:00:38.355209Z","shell.execute_reply":"2024-09-08T07:00:38.354544Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display the maximum observed reflectivity\nds_sr[\"zFactorMeasured\"].max(dim=\"range\").gpm.plot_map()\nds_sr[\"zFactorFinal\"].max(dim=\"range\").gpm.plot_map(vmax=40)","key":"VZHRcQvMXV"},{"type":"output","id":"tZz0_23fTp6XcNzfrDd_-","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5cbeac90>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9b397d664e673f5cc43fa05d3e71d2df","path":"/erad2024/build/9b397d664e673f5cc43fa05d3e71d2df.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"911bb6696dcef801a60647d01e9033bd","path":"/erad2024/build/911bb6696dcef801a60647d01e9033bd.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"jiN0gTYFzm"}],"key":"m9Es03Vy5L"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:38.357161Z","iopub.status.busy":"2024-09-08T07:00:38.356995Z","iopub.status.idle":"2024-09-08T07:00:39.139674Z","shell.execute_reply":"2024-09-08T07:00:39.139117Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display cross-section with ground clutter masked out\nds_sr[\"zFactorMeasured\"].isel(cross_track=24).gpm.plot_cross_section(zoom=False)\nds_sr[\"zFactorFinal\"].isel(cross_track=24).gpm.plot_cross_section(zoom=False)\nds_sr[\"zFactorCorrection\"].isel(cross_track=24).gpm.plot_cross_section(vmin=0, vmax=3, cmap=\"Spectral_r\", zoom=False)","key":"r5a86bcZ1B"},{"type":"output","id":"Y7jAjiPLuy_D56G3nOOyY","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5787f86ae210879886b966f1c37fb0a7","path":"/erad2024/build/5787f86ae210879886b966f1c37fb0a7.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"14b7bc7e01f058a6814c28982a10def2","path":"/erad2024/build/14b7bc7e01f058a6814c28982a10def2.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f6260996327fb352405b01be1fe80d16","path":"/erad2024/build/f6260996327fb352405b01be1fe80d16.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"hQOz4EydOE"}],"key":"nyjquJ38jR"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve GR gate resolution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bAUK8lvVWt"}],"identifier":"retrieve-gr-gate-resolution","label":"Retrieve GR gate resolution","html_id":"retrieve-gr-gate-resolution","implicit":true,"key":"P91Slwe7qm"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this subsection we derive the horizontal and vertical resolution of GR gates.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j3hUesdiQt"}],"key":"miXb1NPmzx"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The GR horizontal and vertical resolution change as a function of the range distance.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Xk2gkR7cOY"}],"key":"wBCERHhbLu"}],"key":"zmph4NneAG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:39.141655Z","iopub.status.busy":"2024-09-08T07:00:39.141482Z","iopub.status.idle":"2024-09-08T07:00:42.073037Z","shell.execute_reply":"2024-09-08T07:00:42.072367Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute horizontal and vertical GR gate resolution\nh_res_gr, v_res_gr = ds_gr.xradar_dev.resolution_at_range(\n    azimuth_beamwidth=azimuth_beamwidth_gr,\n    elevation_beamwidth=elevation_beamwidth_gr,\n)\nh_res_gr.xradar_dev.plot_map()\nv_res_gr.xradar_dev.plot_map()","key":"QiEkWtBrXU"},{"type":"output","id":"EzOcJ0OYOyUDgyN8zLSQo","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f43953110>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bb0fdf9ea9b251aef609087c2e8e57bc","path":"/erad2024/build/bb0fdf9ea9b251aef609087c2e8e57bc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bb0fdf9ea9b251aef609087c2e8e57bc","path":"/erad2024/build/bb0fdf9ea9b251aef609087c2e8e57bc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"ltFg3wh545"}],"key":"bJj6aw0sfg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define GR range distance interval","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FnnkxsRwDy"}],"identifier":"define-gr-range-distance-interval","label":"Define GR range distance interval","html_id":"define-gr-range-distance-interval","implicit":true,"key":"DPIUG9xJjs"}],"key":"m9V67hazWO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now let’s define the minimum range distance at which the GR gate vertical resolution is larger than 150/250 m (the range resolution of GPM) and at which GR distance the GR gate vertical resolution exceed 1500 m (which correspond to 12/6 SR gates included in a GR gate)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Rykxa71Tzp"}],"key":"aeMmRhkhHj"}],"key":"IZVm6Yu5O6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:42.075514Z","iopub.status.busy":"2024-09-08T07:00:42.075151Z","iopub.status.idle":"2024-09-08T07:00:45.027185Z","shell.execute_reply":"2024-09-08T07:00:45.026636Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"mask_gr_gate_depth_above_250 = v_res_gr > 250\nmask_gr_gate_depth_above_250.xradar_dev.plot_map()\nmin_gr_range = np.max(\n    mask_gr_gate_depth_above_250[\"range\"].data[mask_gr_gate_depth_above_250.sum(dim=\"azimuth\") == 0],\n)  # min_range_distance\n\nmask_gr_gate_depth_below_2000 = v_res_gr > 1500\nmask_gr_gate_depth_below_2000.xradar_dev.plot_map()\nmax_gr_range = np.max(\n    mask_gr_gate_depth_below_2000[\"range\"].data[mask_gr_gate_depth_below_2000.sum(dim=\"azimuth\") == 0],\n)  # min_range_distance\n\nprint(\"Minimum GR distance:\", min_gr_range, \"m\")\nprint(\"Maximum GR distance:\", max_gr_range, \"m\")","key":"ebMQbv9Qwo"},{"type":"output","id":"I1cult0xUNw3VjcyJCu8k","data":[{"name":"stdout","output_type":"stream","text":"Minimum GR distance: 14125.0 m\nMaximum GR distance: 85875.0 m\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d038a702d422e356bc0a0126e6d0d9e7","path":"/erad2024/build/d038a702d422e356bc0a0126e6d0d9e7.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2495d1f4d0cfaa5de1d47bfbcb5e4f57","path":"/erad2024/build/2495d1f4d0cfaa5de1d47bfbcb5e4f57.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"Y955Wr6bGm"}],"key":"lrN5y1rU0X"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now let’s specify the minimum and maximum GR range distance to consider when matching SR/GR gates.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sHXLYVP8J5"}],"key":"GJlKXgxtwF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"It’s good practice to avoid restricting too much at this stage. Matched SR/GR gates can be filtered afterwards.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BO4RVPHMCp"}],"key":"EEP6wlNdsN"}],"key":"UWVBKiEO32"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:45.029512Z","iopub.status.busy":"2024-09-08T07:00:45.029345Z","iopub.status.idle":"2024-09-08T07:00:45.032045Z","shell.execute_reply":"2024-09-08T07:00:45.031539Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Specify GR range distance interval over which to perform SR matching\nmin_gr_range = 7_000  # about 15_000 km\nmax_gr_range = 150_000","key":"uAnKzflvmi"},{"type":"output","id":"5RqiPkX-Fo3zwNtQOda2w","data":[],"key":"o1qQJd84Qk"}],"key":"B40uRU34AO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Display SR slice and GR sweep","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n6gSrhymhT"}],"identifier":"display-sr-slice-and-gr-sweep","label":"Display SR slice and GR sweep","html_id":"display-sr-slice-and-gr-sweep","implicit":true,"key":"fMqSnJbPOB"}],"key":"vvEhdTUV2H"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:45.033826Z","iopub.status.busy":"2024-09-08T07:00:45.033668Z","iopub.status.idle":"2024-09-08T07:00:45.050986Z","shell.execute_reply":"2024-09-08T07:00:45.050495Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Slice SR volume\nda_sr = ds_sr[\"zFactorFinal\"].isel(range=-5)\nda_sr = ds_sr[\"zFactorFinal\"].gpm.slice_range_at_bin(ds_sr[\"binClutterFreeBottom\"])\nda_sr = ds_sr[\"zFactorFinal\"].gpm.slice_range_at_height(value=2000)","key":"A3YfXPWEBd"},{"type":"output","id":"Zctn5g-zPBwqsJpbDBqJf","data":[],"key":"kriJhc1RYa"}],"key":"Q65N6iOM7h"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:45.053176Z","iopub.status.busy":"2024-09-08T07:00:45.052752Z","iopub.status.idle":"2024-09-08T07:00:47.729565Z","shell.execute_reply":"2024-09-08T07:00:47.728969Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define SR and GR mask\nmask_gr = ds_gr[\"DBZH\"] >= z_min_threshold_gr\n# mask_gr = np.logical_and(ds_gr[\"DBZH\"] >= z_min_threshold_gr, ds_gr[\"RHOHV\"] >= 0.80)\n\nmask_sr = True  # aka do not mask\n\n# Retrieve SR extent\nsr_extent = ds_sr.gpm.extent()\n\n# Define cmap\ncmap = \"Spectral_r\"\n\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(8, 4), dpi=120, subplot_kw={\"projection\": ccrs.PlateCarree()})\n# - Plot SR\np_sr = da_sr.where(mask_sr).gpm.plot_map(\n    ax=ax1,\n    cmap=cmap,\n    vmin=0,\n    vmax=40,\n    cbar_kwargs={\"label\": \"SR Reflectivity (dBz)\"},\n    add_colorbar=True,\n)\n# - Plot GR\nds_gr[\"DBZH\"].where(mask_gr).xradar_dev.plot_map(\n    ax=ax2,\n    cmap=cmap,\n    vmin=0,\n    vmax=40,\n    cbar_kwargs={\"label\": \"GR Reflectivity (dBz)\", \"extend\": \"both\"},\n    add_colorbar=True,\n)\n# - Add the SR swath boundary\nda_sr.gpm.plot_swath_lines(ax=ax2)\n# - Restrict the extent to the SR overpass\nax2.set_extent(sr_extent)\n# - Display GR range distances\nfor ax in [ax1, ax2]:\n    ds_gr.xradar_dev.plot_range_distance(\n        distance=min_gr_range,\n        ax=ax,\n        add_background=True,\n        linestyle=\"dashed\",\n        edgecolor=\"black\",\n    )\n    ds_gr.xradar_dev.plot_range_distance(\n        distance=max_gr_range,\n        ax=ax,\n        add_background=True,\n        linestyle=\"dashed\",\n        edgecolor=\"black\",\n    )\n    ds_gr.xradar_dev.plot_range_distance(\n        distance=250_000,\n        ax=ax,\n        add_background=True,\n        linestyle=\"dashed\",\n        edgecolor=\"black\",\n    )\n# - Add GR location\nax1.scatter(ds_gr[\"longitude\"], ds_gr[\"latitude\"], c=\"black\", marker=\"X\", s=4)\nax2.scatter(ds_gr[\"longitude\"], ds_gr[\"latitude\"], c=\"black\", marker=\"X\", s=4)\n# - Set title\nax1.set_title(\"GPM\", fontsize=12, loc=\"left\")\nax2.set_title(\"Ground Radar\", fontsize=12, loc=\"left\")\n# - Improve layout and display\nplt.tight_layout()\nplt.show()","key":"HSAwMw1wrZ"},{"type":"output","id":"QAjWHPAps0hfGKGeDa21X","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"188ee71808681d3e31b23f9e72fc9f06","path":"/erad2024/build/188ee71808681d3e31b23f9e72fc9f06.png"},"text/plain":{"content":"<Figure size 960x480 with 4 Axes>","content_type":"text/plain"}}}],"key":"Pf3YazaEmE"}],"key":"qJaGYluULi"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve GR (lon, lat) coordinates","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fjPB6B7Nbi"}],"identifier":"retrieve-gr-lon-lat-coordinates","label":"Retrieve GR (lon, lat) coordinates","html_id":"retrieve-gr-lon-lat-coordinates","implicit":true,"key":"hlgVa02bb5"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we retrieve the 2D non-dimensional longitude and latitude coordinates in the CRS of the SR.\nThese 2D coordinates will have dimensions (azimuth, range)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YC2X3lryyY"}],"key":"pSb4gPrMaI"}],"key":"hSGaCyr7A3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:47.731872Z","iopub.status.busy":"2024-09-08T07:00:47.731701Z","iopub.status.idle":"2024-09-08T07:00:48.374789Z","shell.execute_reply":"2024-09-08T07:00:48.374277Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"lon_gr, lat_gr, height_gr = reproject_coords(x=ds_gr[\"x\"], y=ds_gr[\"y\"], z=ds_gr[\"z\"], src_crs=crs_gr, dst_crs=crs_sr)\n\n# If crs_gr and crs_sr share same datum/ellispoid, z does not vary\nprint(crs_gr.datum)\nprint(crs_sr.datum)","key":"TjfXpXtSDO"},{"type":"output","id":"eAbgwTbnYIqE8AMhFmGSg","data":[{"name":"stdout","output_type":"stream","text":"World Geodetic System 1984\nUnknown based on WGS 84 ellipsoid\n"}],"key":"MSZlmcOFXD"}],"key":"yJ1tLAOvl8"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve SR (x,y,z) coordinates","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o0SOzMofaZ"}],"identifier":"retrieve-sr-x-y-z-coordinates","label":"Retrieve SR (x,y,z) coordinates","html_id":"retrieve-sr-x-y-z-coordinates","implicit":true,"key":"wI8fN0LW04"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we retrieve the 3D (x,y,z) coordinates of SR gates in the GR CRS projection.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zqvYIcy6uR"}],"key":"XBFcfJx7uv"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The GR CRS is a azimuthal equidistant (AZEQ) projection centered on the ground radar.\nIn the GR CRS, the (x,y) coordinates (0,0) corresponds to the location of the ground radar.\nTherefore, the retrieved SR (x,y) coordinates are relative to the ground radar site, while the z coordinates is relative to the ellipsoid.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f4rRJxKJdE"}],"key":"FUPLNWHJtz"}],"key":"oS6pPhCp6T"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:48.377405Z","iopub.status.busy":"2024-09-08T07:00:48.376941Z","iopub.status.idle":"2024-09-08T07:00:48.576150Z","shell.execute_reply":"2024-09-08T07:00:48.575581Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"x_sr, y_sr, z_sr = retrieve_gates_projection_coordinates(ds_sr, dst_crs=crs_gr)","key":"oKB0tjBMzy"},{"type":"output","id":"ySiKsrGXEASSi0LL4iAe9","data":[],"key":"tYB39L1nZQ"}],"key":"hDUiVp8DN0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve SR (range, azimuth, elevation) coordinates","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LD0P2qFAdm"}],"identifier":"retrieve-sr-range-azimuth-elevation-coordinates","label":"Retrieve SR (range, azimuth, elevation) coordinates","html_id":"retrieve-sr-range-azimuth-elevation-coordinates","implicit":true,"key":"xVIIlulAle"}],"key":"Y7aW5wsTmC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now we inverse the SR (x,y,z) 3D GR CRS coordinates to derive the SR (range, azimuth, elevation) coordinates with respect to GR sweep.\nThese coordinates allow to identify the SR gates intersecting the GR sweep.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fO8i8gUk5a"}],"key":"om4iTF9mMA"}],"key":"kFH7CP1iDD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:48.578738Z","iopub.status.busy":"2024-09-08T07:00:48.578328Z","iopub.status.idle":"2024-09-08T07:00:48.690868Z","shell.execute_reply":"2024-09-08T07:00:48.690253Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"range_sr, azimuth_sr, elevation_sr = xyz_to_antenna_coordinates(\n    x=x_sr,\n    y=y_sr,\n    z=z_sr,\n    site_altitude=ds_gr[\"altitude\"],\n    crs=crs_gr,\n    effective_radius_fraction=None,\n)\nprint(range_sr.isel(cross_track=0).min().item(), \"m\")  # far from the radar\nprint(range_sr.isel(cross_track=-1).min().item(), \"m\")  # closer to radar","key":"GuxUwQ3JvO"},{"type":"output","id":"q_RyWD36l2Wvq9OMCc1os","data":[{"name":"stdout","output_type":"stream","text":"252837.9704755049 m\n9164.066906023296 m\n"}],"key":"bOBhyz7ZrB"}],"key":"tYNA2yCvL7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:48.693072Z","iopub.status.busy":"2024-09-08T07:00:48.692615Z","iopub.status.idle":"2024-09-08T07:00:49.030719Z","shell.execute_reply":"2024-09-08T07:00:49.030168Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show elevation angle at different SR scan angle\nelevation_sr.isel(cross_track=0).gpm.plot_cross_section(vmin=0)  # far from the radar\nelevation_sr.isel(cross_track=-1).gpm.plot_cross_section(vmin=0)  # closer to radar","key":"uOCN6mUSC7"},{"type":"output","id":"b0bPVluJzAy12sc0-qC7J","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3df66bf3f8f6d2f6f10a8143a68e8d8b","path":"/erad2024/build/3df66bf3f8f6d2f6f10a8143a68e8d8b.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4ce35b466fe00f95aabdfc96289aa63a","path":"/erad2024/build/4ce35b466fe00f95aabdfc96289aa63a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"fc5DbnGjTx"}],"key":"Ll4cCQttLk"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve SR range distance","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HUfcaqT79Y"}],"identifier":"retrieve-sr-range-distance","label":"Retrieve SR range distance","html_id":"retrieve-sr-range-distance","implicit":true,"key":"jYmT2Cc75g"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The range distance from the satellite for each SR radar gate has been precomputed using information in the GPM L1B product and already included in the preprocessed GPM Zarr Store.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XVZJsWAgKM"}],"key":"VLqaZwWcZN"}],"key":"PgAWXBz8sW"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jp2vsz59DF"},{"type":"inlineCode","value":"range_distance_from_satellite","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r0R6FVhGW5"},{"type":"text","value":" can also be derived from the GPM L2 product if we assume a cross-track scan angle.\nHowever, uncertainties in cross-tracks scan angle can erroneously impacts the estimates.\nAs we show here below, an uncertainty of 0.1° translates to a range distance difference of up to 400 m which corresponds to 3/4 radar gates !","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YJLoNwV9uI"}],"key":"oxqlpZmimm"}],"key":"bVxk7Ls60h"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:49.033162Z","iopub.status.busy":"2024-09-08T07:00:49.032991Z","iopub.status.idle":"2024-09-08T07:00:49.240577Z","shell.execute_reply":"2024-09-08T07:00:49.240024Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show impact of scan angle on range distance\n# - Variation of 0.01 impacts range distance up to 30 m\n# - Variation of 0.05 impacts range distance up to 100 m\n# - Variation of 0.1 impacts range distance up to 400 m\nscan_angle_template = np.abs(np.linspace(-17.04, 17.04, 49))  # assuming Ku swath of size 49\nscan_angle = xr.DataArray(scan_angle_template[ds_sr[\"gpm_cross_track_id\"].data], dims=\"cross_track\")\nscan_angle = scan_angle + 0.1\nl2_distance = ds_sr.gpm.retrieve(\"range_distance_from_satellite\", scan_angle=scan_angle)\n\ndiff = l2_distance - ds_sr[\"range_distance_from_satellite\"]\ndiff.isel(along_track=0).gpm.plot_cross_section()  # difference > 500 m","key":"cqdaPXjql9"},{"type":"output","id":"lzq-c1HopYu4TXVyJcJd1","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"50bfa253a6cbc798c065f63d6f6f5508","path":"/erad2024/build/50bfa253a6cbc798c065f63d6f6f5508.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"jWk9HtlJEr"}],"key":"lRpOviRzLp"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve radar gates volumes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bDd3y6VCIq"}],"identifier":"retrieve-radar-gates-volumes","label":"Retrieve radar gates volumes","html_id":"retrieve-radar-gates-volumes","implicit":true,"key":"BzoPiDoD3m"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we compute SR and GR gate volumes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Kn9hfK7Wwl"}],"key":"zfbSHGb94h"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"An accurate beam width is necessary to derive accurate gate volume estimates. This is demonstrated here below !","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V4LJO74Pc7"}],"key":"p2lvnOzHet"}],"key":"avsIDTOxiY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:49.242775Z","iopub.status.busy":"2024-09-08T07:00:49.242402Z","iopub.status.idle":"2024-09-08T07:00:49.252694Z","shell.execute_reply":"2024-09-08T07:00:49.252257Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute GR gates volumes\nvol_gr = wrl.qual.pulse_volume(\n    ds_gr[\"range\"],  # range distance\n    h=ds_gr[\"range\"].diff(\"range\").median(),  # range resolution\n    theta=elevation_beamwidth_gr,\n)  # beam width\nvol_gr = vol_gr.broadcast_like(ds_gr[\"DBZH\"])\nvol_gr = vol_gr.assign_coords({\"lon\": ds_gr[\"lon\"], \"lat\": ds_gr[\"lat\"]})","key":"FfenBGjJlp"},{"type":"output","id":"AZwviz4K8a07S6CWdN457","data":[],"key":"VqcGtQvnpU"}],"key":"fNoSUsRusO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:49.254837Z","iopub.status.busy":"2024-09-08T07:00:49.254442Z","iopub.status.idle":"2024-09-08T07:00:49.866925Z","shell.execute_reply":"2024-09-08T07:00:49.866383Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute SR gates volumes\nrange_distance = ds_sr[\"range_distance_from_satellite\"]\nvol_sr = ds_sr.gpm.retrieve(\"gate_volume\", beam_width=ds_sr[\"crossTrackBeamWidth\"], range_distance=range_distance)\nvol_sr.isel(along_track=0).gpm.plot_cross_section()\nvol_sr.isel(range=-1).gpm.plot_map()","key":"HTal6lQbhU"},{"type":"output","id":"ljYRVCl9YiBAL4Eqafm04","data":[{"output_type":"execute_result","execution_count":36,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5c8f5ad0>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"aa76b6e08b6e20fbbab1fc3eba5b70e5","path":"/erad2024/build/aa76b6e08b6e20fbbab1fc3eba5b70e5.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"adda2487f074d09b8415aaba9f87a43d","path":"/erad2024/build/adda2487f074d09b8415aaba9f87a43d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"IBdA5GtkOm"}],"key":"OdlQe8WHJd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:49.868895Z","iopub.status.busy":"2024-09-08T07:00:49.868576Z","iopub.status.idle":"2024-09-08T07:00:50.671386Z","shell.execute_reply":"2024-09-08T07:00:50.670794Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Assuming fixed beamwidth with SR leads to volume difference up to 0.35 km3\nvol_sr1 = ds_sr.gpm.retrieve(\"gate_volume\", beam_width=0.71, range_distance=range_distance)\ndiff = vol_sr - vol_sr1\ndiff.isel(along_track=0).gpm.plot_cross_section()\ndiff.isel(range=-1).gpm.plot_map()","key":"lJkyLZJAIz"},{"type":"output","id":"5eKsSQYrnbODWI4fZ9JlW","data":[{"output_type":"execute_result","execution_count":37,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5c6e7410>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"254c479626641018a801abe173e4d649","path":"/erad2024/build/254c479626641018a801abe173e4d649.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"40ecdda63d7ac4d63e0866bdd27ae770","path":"/erad2024/build/40ecdda63d7ac4d63e0866bdd27ae770.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"MlNwbaml2K"}],"key":"LiL0rYphO3"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve SR gate resolution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"osgYOf5OQG"}],"identifier":"retrieve-sr-gate-resolution","label":"Retrieve SR gate resolution","html_id":"retrieve-sr-gate-resolution","implicit":true,"key":"aBkaQyeAhY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this subsection we derive the horizontal and vertical SR gate resolution.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Rc6NvbYGnU"}],"key":"CR7UWkLQ5Y"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The SR horizontal resolution change for each radar gate, while the vertical resolution varies only across SR footprints.\nNote that the vertical resolution here derived is equivalent to the GPM L2 product variable ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tC5l2C0Yih"},{"type":"inlineCode","value":"height","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VKGrKMC8Vx"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VXVba95JIw"}],"key":"j2vHnZibqV"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Assuming a fixed beamwidth of 0.71 can leads to variations in horizontal resolution estimates up to 400 m on the outer-track.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wbkt5gSAaG"}],"key":"ES0ghlAWKe"}],"key":"Vq8AxTJfJw"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:50.673759Z","iopub.status.busy":"2024-09-08T07:00:50.673371Z","iopub.status.idle":"2024-09-08T07:00:50.713811Z","shell.execute_reply":"2024-09-08T07:00:50.712973Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute horizontal and vertical SR gate resolution\nrange_distance = ds_sr[\"range_distance_from_satellite\"]\nh_res_sr, v_res_sr = ds_sr.gpm.retrieve(\"gate_resolution\", beam_width=ds_sr[\"crossTrackBeamWidth\"], range_distance=range_distance)\nh_radius = h_res_sr / 2","key":"oSRcBHlpkk"},{"type":"output","id":"SMSvRNAYZZWHcx3hRg7My","data":[],"key":"p3xVwfqUJw"}],"key":"zOXPfe1ecc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:50.716281Z","iopub.status.busy":"2024-09-08T07:00:50.716100Z","iopub.status.idle":"2024-09-08T07:00:50.834006Z","shell.execute_reply":"2024-09-08T07:00:50.833462Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Validate v_res_sr [OK !]\ndiff = -ds_sr[\"height\"].diff(dim=\"range\") - v_res_sr\ndiff.isel(along_track=0).gpm.plot_cross_section(y=\"range\")\nplt.show()","key":"lSgNbLIeO5"},{"type":"output","id":"3TR2Dma7ldUrqGHnPnE8d","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cab32ecb811a96f0b79165ce2e44a1dd","path":"/erad2024/build/cab32ecb811a96f0b79165ce2e44a1dd.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"vfNiKn3qaN"}],"key":"erFqAtBub6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:50.835863Z","iopub.status.busy":"2024-09-08T07:00:50.835697Z","iopub.status.idle":"2024-09-08T07:00:51.461329Z","shell.execute_reply":"2024-09-08T07:00:51.460767Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Validate h_res [PROBLEMATIC WITH FIXED BEAM WIDTH]\nh_res1_sr, _ = ds_sr.gpm.retrieve(\"gate_resolution\", beam_width=None, range_distance=range_distance)  # Use 0.71\ndiff = h_res_sr - h_res1_sr\ndiff.isel(along_track=0).gpm.plot_cross_section(y=\"range\")\ndiff.isel(range=-1).gpm.plot_map()","key":"moFoYJhrMV"},{"type":"output","id":"jtaqyUqD-WZP6-czA5l40","data":[{"output_type":"execute_result","execution_count":40,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5cc45a10>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d48dde345555207c83edc6515bf52c1b","path":"/erad2024/build/d48dde345555207c83edc6515bf52c1b.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b1ccb053f2a8444cee730c6e46e4fec4","path":"/erad2024/build/b1ccb053f2a8444cee730c6e46e4fec4.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"NGGHGXzSIR"}],"key":"S3RQqHzJRc"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve Bright Band (BB) Ratio","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QmxOuXWwn5"}],"identifier":"retrieve-bright-band-bb-ratio","label":"Retrieve Bright Band (BB) Ratio","html_id":"retrieve-bright-band-bb-ratio","implicit":true,"key":"U3KkShhgqX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we derive the bright band ratio, which is defined as follow:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k8f7FNnPP3"}],"key":"GJ36BFDzAc"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"A BB ratio of < 0 indicates that a bin is located below the melting layer (ML).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cgOTEGtZWZ"}],"key":"o3l2KEEvAs"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"A BB ratio of > 0 indicates that a bin is located above the ML.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OJFxxC05XL"}],"key":"jkyaBJvGwp"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"A BB ratio with values in between 0 and 1 indicates tha the radar is inside the ML.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GuWQ7QIXRx"}],"key":"PbsSHlUZgS"}],"key":"NO2QbIbRDQ"}],"key":"sK1WYj28jA"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:51.463486Z","iopub.status.busy":"2024-09-08T07:00:51.463112Z","iopub.status.idle":"2024-09-08T07:00:52.484079Z","shell.execute_reply":"2024-09-08T07:00:52.483579Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"da_bb_ratio, da_bb_mask = ds_sr.gpm.retrieve(\"bright_band_ratio\", return_bb_mask=True)\nda_bb_ratio.isel(cross_track=24).gpm.plot_cross_section(vmin=0, vmax=1)\nda_bb_ratio.isel(range=0).gpm.plot_map()  # top\nda_bb_ratio.isel(range=-1).gpm.plot_map()  # bottom","key":"U7kJjjEohf"},{"type":"output","id":"EHyf0LEUh2h0M8Mo2LKq_","data":[{"output_type":"execute_result","execution_count":41,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f40a7e3d0>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"00a77674411e179d68d55d5fcf8a1fb4","path":"/erad2024/build/00a77674411e179d68d55d5fcf8a1fb4.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b7f5201ed33394ee13fc42167da96ffe","path":"/erad2024/build/b7f5201ed33394ee13fc42167da96ffe.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9a42084c618d61e6ea45ba71d9b8124e","path":"/erad2024/build/9a42084c618d61e6ea45ba71d9b8124e.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"ebMXshylkv"}],"key":"DQahtbfCC9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:52.486225Z","iopub.status.busy":"2024-09-08T07:00:52.485891Z","iopub.status.idle":"2024-09-08T07:00:53.240626Z","shell.execute_reply":"2024-09-08T07:00:53.240028Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show difference between L2 qualityBB and custom derived BB mask\nds_sr[\"qualityBB\"].gpm.plot_map()\nda_bb_mask.gpm.plot_map()\nds_sr[\"qualityBB\"].attrs","key":"jsGRcalZUw"},{"type":"output","id":"TwrO4n1SDRjnbDwkF3blm","data":[{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/plain":{"content":"{'description': 'Quality of Bright-Band Detection',\n 'flag_meanings': ['BB not detected', 'BB detected'],\n 'flag_values': [0, 1],\n 'gpm_api_decoded': 'yes',\n 'gpm_api_product': '2A-DPR',\n 'grid_mapping': 'crsWGS84'}","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c521eda0d3f37fc04859a14d39abd2bc","path":"/erad2024/build/c521eda0d3f37fc04859a14d39abd2bc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c699496c02a906a7527a67a4e93c34d6","path":"/erad2024/build/c699496c02a906a7527a67a4e93c34d6.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"CKz8XqXdO7"}],"key":"MU5O9icnti"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve Precipitation and Hydrometeors Types","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pViyOguKXt"}],"identifier":"retrieve-precipitation-and-hydrometeors-types","label":"Retrieve Precipitation and Hydrometeors Types","html_id":"retrieve-precipitation-and-hydrometeors-types","implicit":true,"key":"gfcSz2xTao"}],"key":"tPESVu2o2p"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:53.242719Z","iopub.status.busy":"2024-09-08T07:00:53.242546Z","iopub.status.idle":"2024-09-08T07:00:53.635320Z","shell.execute_reply":"2024-09-08T07:00:53.634721Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Retrieve precipitation type classification\nds_sr[\"flagPrecipitationType\"] = ds_sr.gpm.retrieve(\"flagPrecipitationType\", method=\"major_rain_type\")\nds_sr[\"flagPrecipitationType\"].gpm.plot_map()\nds_sr[\"flagPrecipitationType\"].attrs","key":"Vc56kVqhdG"},{"type":"output","id":"Vhs3ztlGlDgook6n1ZIQ6","data":[{"output_type":"execute_result","execution_count":43,"metadata":{},"data":{"text/plain":{"content":"{'flag_values': [0, 1, 2, 3],\n 'flag_meanings': ['no rain', 'stratiform', 'convective', 'other'],\n 'description': 'Precipitation type'}","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a4549d4fb32d6d2c1829cacd09d25ce","path":"/erad2024/build/7a4549d4fb32d6d2c1829cacd09d25ce.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"VCbhQ3qmdo"}],"key":"beS93eojrP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:53.637718Z","iopub.status.busy":"2024-09-08T07:00:53.637244Z","iopub.status.idle":"2024-09-08T07:00:53.927201Z","shell.execute_reply":"2024-09-08T07:00:53.926571Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Retrieve hydrometeors classification\nds_sr[\"flagHydroClass\"] = ds_sr.gpm.retrieve(\"flagHydroClass\")\nds_sr[\"flagHydroClass\"].isel(cross_track=24).gpm.plot_cross_section()\nds_sr[\"flagHydroClass\"].attrs","key":"B5MZDXtbzW"},{"type":"output","id":"HKbje1F7J-U1bZkcF8Cxb","data":[{"output_type":"execute_result","execution_count":44,"metadata":{},"data":{"text/plain":{"content":"{'flag_values': [0, 1, 2, 3, 4, 5],\n 'flag_meanings': ['no precipitation',\n  'rain',\n  'snow',\n  'hail',\n  'melting layer',\n  'clutter']}","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5fe8eb64f1ca97ed4fc547f83b21bf8e","path":"/erad2024/build/5fe8eb64f1ca97ed4fc547f83b21bf8e.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"MKqJSGkMKO"}],"key":"LvwEsE6Ww6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:53.929191Z","iopub.status.busy":"2024-09-08T07:00:53.929025Z","iopub.status.idle":"2024-09-08T07:00:54.293547Z","shell.execute_reply":"2024-09-08T07:00:54.292899Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Visualize cross-section\nprecip_type3d = xr.ones_like(ds_sr[\"flagHydroClass\"]) * ds_sr[\"flagPrecipitationType\"]\nprecip_type3d = precip_type3d.where(ds_sr[\"zFactorFinal\"] > 10)\nprecip_type3d.name = ds_sr[\"flagPrecipitationType\"].name\n\nprecip_type3d.isel(cross_track=24).gpm.plot_cross_section()\nds_sr[\"flagHydroClass\"].where(ds_sr[\"flagHydroClass\"] > 0).isel(cross_track=24).gpm.plot_cross_section()","key":"AcuU1z83Ml"},{"type":"output","id":"8gA1tSRFAr4IuAATo7ReV","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2a96d0bb168d3abb750eec9da515daf1","path":"/erad2024/build/2a96d0bb168d3abb750eec9da515daf1.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cc991e79952eb5133ce51eb720935e9a","path":"/erad2024/build/cc991e79952eb5133ce51eb720935e9a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"E0iadNDzDm"}],"key":"FHeDYKbmgT"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert SR Ku-band to S-band","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tSNaFn0fat"}],"identifier":"convert-sr-ku-band-to-s-band","label":"Convert SR Ku-band to S-band","html_id":"convert-sr-ku-band-to-s-band","implicit":true,"key":"CCFsDc6704"}],"key":"Nwk8fwBWfI"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we convert reflectivities from Ku-band to S-band based on ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A0nQRNeF4H"},{"type":"cite","url":"https://agupubs.onlinelibrary.wiley.com/doi/10.1002/jgrd.50138","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cao et al., (2013)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Nxz4m1v3HZ"}],"kind":"narrative","label":"Cao_2013","identifier":"https://agupubs.onlinelibrary.wiley.com/doi/10.1002/jgrd.50138","enumerator":"3","key":"j4WBHOJB0w"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ylFk3A41Vk"}],"key":"jtAd78OfJn"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When filtering the SR/GR matched samples, plase consider to select:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E3rVV8qqzG"}],"key":"qOdHu68sMv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"only reflectivities below 35 dBZ for S-band GR radars to avoid non-rayleigh scattering","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"x20McoydsX"}],"key":"F6cxhDYKOZ"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"only reflectivities below 25 dBZ for C/X-band GR radars","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"t4xTYwD4Pn"}],"key":"Fz96m3KqMa"}],"key":"V1SNrrb7kq"}],"key":"Q1bS75ULOB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:54.295628Z","iopub.status.busy":"2024-09-08T07:00:54.295451Z","iopub.status.idle":"2024-09-08T07:00:55.146819Z","shell.execute_reply":"2024-09-08T07:00:55.146224Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# With attenuation corrected reflectivity\nda_z_s_final = ds_sr.gpm.retrieve(\"s_band_cao2013\", reflectivity=\"zFactorFinal\", bb_ratio=None, precip_type=None)\nda_z_ku_final = ds_sr[\"zFactorFinal\"]\ndfr_s_ku_final = da_z_s_final - da_z_ku_final\ndfr_s_ku_final.name = \"DRF_S_Ku\"\n\ndfr_s_ku_final.isel(cross_track=24).gpm.plot_cross_section()\nda_z_ku_final.isel(cross_track=24).gpm.plot_cross_section()\nda_z_s_final.isel(cross_track=24).gpm.plot_cross_section()","key":"rmGc6fXYSQ"},{"type":"output","id":"rMQx8EnoJ0BExixfCmcZX","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"93673c05c68b8def1c6be7cc9a352943","path":"/erad2024/build/93673c05c68b8def1c6be7cc9a352943.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e92b81a0e1d7aed383a3a21b7ba845ce","path":"/erad2024/build/e92b81a0e1d7aed383a3a21b7ba845ce.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"84e3d34f61c50a013d0e047adf45caa5","path":"/erad2024/build/84e3d34f61c50a013d0e047adf45caa5.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"ShGf8DeJnS"}],"key":"P3QdTHOqXq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:55.149426Z","iopub.status.busy":"2024-09-08T07:00:55.149003Z","iopub.status.idle":"2024-09-08T07:00:56.170375Z","shell.execute_reply":"2024-09-08T07:00:56.169737Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# With measured reflectivity\nda_z_s_measured = ds_sr.gpm.retrieve(\"s_band_cao2013\", reflectivity=\"zFactorMeasured\", bb_ratio=None, precip_type=None)\nda_z_ku_measured = ds_sr[\"zFactorMeasured\"]\ndfr_s_ku_measured = da_z_s_measured - da_z_ku_measured\ndfr_s_ku_measured.name = \"DRF_S_Ku\"\n\ndfr_s_ku_measured.isel(cross_track=24).gpm.plot_cross_section()\nda_z_ku_measured.isel(cross_track=24).gpm.plot_cross_section()\nda_z_s_measured.isel(cross_track=24).gpm.plot_cross_section()","key":"iduaNegKUA"},{"type":"output","id":"SAKEy4JM8ninbnRYnkeTo","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ffbeb88b7769bf1542c404ffcd8ac9e0","path":"/erad2024/build/ffbeb88b7769bf1542c404ffcd8ac9e0.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4e44d3acb4892fd83f315d1892b0ab7d","path":"/erad2024/build/4e44d3acb4892fd83f315d1892b0ab7d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e249e8fbd11a3d3d4be60ffed309a1e4","path":"/erad2024/build/e249e8fbd11a3d3d4be60ffed309a1e4.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"Lq2XgtULZp"}],"key":"yOgrpZecz8"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:56.172541Z","iopub.status.busy":"2024-09-08T07:00:56.172191Z","iopub.status.idle":"2024-09-08T07:00:56.564126Z","shell.execute_reply":"2024-09-08T07:00:56.563457Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute attenuation correction in S-band\nda_z_s_correction = da_z_s_final - da_z_s_measured\nda_z_s_correction.isel(cross_track=24).gpm.plot_cross_section()","key":"s4E1ofAQ7H"},{"type":"output","id":"VPe1JlgGGUtKAIJ1Riduf","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"35a7c08f5276023ccae52f6807be74e7","path":"/erad2024/build/35a7c08f5276023ccae52f6807be74e7.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"PQNMrOBiQI"}],"key":"UIfTZDbBeJ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert SR Ku-band to X and C-band","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rSPU7ako8K"}],"identifier":"convert-sr-ku-band-to-x-and-c-band","label":"Convert SR Ku-band to X and C-band","html_id":"convert-sr-ku-band-to-x-and-c-band","implicit":true,"key":"yZ9LgndJvu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we convert reflectivities from Ku-band to X and C-band.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eL6Jtkj088"}],"key":"Af061T703w"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We welcome contributions to improve this portion of code !","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eZWzPgaXkv"}],"key":"XLeYbXyFOB"}],"key":"Shs8YttW6w"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:56.566278Z","iopub.status.busy":"2024-09-08T07:00:56.565937Z","iopub.status.idle":"2024-09-08T07:00:57.580163Z","shell.execute_reply":"2024-09-08T07:00:57.579571Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"da_z_c = ds_sr.gpm.retrieve(\"c_band_tan\", bb_ratio=None, precip_type=None)\nda_z_x = ds_sr.gpm.retrieve(\"x_band_tan\", bb_ratio=None, precip_type=None)\n\nda_z_c.isel(cross_track=24).gpm.plot_cross_section()\nda_z_x.isel(cross_track=24).gpm.plot_cross_section()","key":"B8sAzIIHgy"},{"type":"output","id":"mYsldNZffEe2wRdpuME80","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"199dbdd0223cc5193876ffe287158ac8","path":"/erad2024/build/199dbdd0223cc5193876ffe287158ac8.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c9010b480be4da13fa5113cef49e412d","path":"/erad2024/build/c9010b480be4da13fa5113cef49e412d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"JDw1eYY8Oa"}],"key":"jegWMGRuaW"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Convert GR S-band to Ku-band","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ClybUdDLDq"}],"identifier":"convert-gr-s-band-to-ku-band","label":"Convert GR S-band to Ku-band","html_id":"convert-gr-s-band-to-ku-band","implicit":true,"key":"kQZ04UlBqq"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we provide some code to convert GR S-band reflectivities to Ku-band.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NeMUyAZYkj"}],"key":"izbZSkLKgp"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"However, the resulting reflectivities are not used in the rest of the tutorial.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pbevZlQilp"}],"key":"xozSC2QdAD"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The methodology we adopt currently use only an average bright band height to discern between liquid and solid phase precipitation, and it does not account for mixed-phase precipitation and the phase transition.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"R92UEhkZC9"}],"key":"Zg1bizxv2N"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"We welcome contributions to improve this portion of code ;)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"hZVNFFyd1w"}],"key":"WnEE9sSdWa"}],"key":"OW9QDhI7Lz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:00:57.582484Z","iopub.status.busy":"2024-09-08T07:00:57.582200Z","iopub.status.idle":"2024-09-08T07:01:00.522048Z","shell.execute_reply":"2024-09-08T07:01:00.521382Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Estimate bright band height\nbright_band_height = np.nanmean(ds_sr[\"heightBB\"])\n# Retrieve Ku-band reflectivities from GR S-band reflectivities\nda_gr_ku = convert_s_to_ku_band(ds_gr=ds_gr, bright_band_height=bright_band_height)\n\nda_gr_s = ds_gr[\"DBZH\"]\nda_gr_s.xradar_dev.plot_map(vmin=0, vmax=50)\nplt.show()\n\nda_gr_ku.xradar_dev.plot_map(vmin=0, vmax=50)\nplt.show()\n\ndiff = da_gr_ku - da_gr_s\ndiff.rename(\"diff\").xradar_dev.plot_map()\nplt.show()","key":"w638x4Q7Qw"},{"type":"output","id":"ijpI57YiH-qswsMakd5SZ","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c3b1c5721a2b676a4f812973869cb079","path":"/erad2024/build/c3b1c5721a2b676a4f812973869cb079.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2b4af4942d76b8bf5b905435aef5cdcc","path":"/erad2024/build/2b4af4942d76b8bf5b905435aef5cdcc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0f574e30080bec40355e027e893267ea","path":"/erad2024/build/0f574e30080bec40355e027e893267ea.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"PddUdHsuvh"}],"key":"BV8FwXEUtC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Identify SR gates intersecting GR sweep","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SqPI3sqw9y"}],"identifier":"identify-sr-gates-intersecting-gr-sweep","label":"Identify SR gates intersecting GR sweep","html_id":"identify-sr-gates-intersecting-gr-sweep","implicit":true,"key":"eNmgwSpFm0"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here we define the mask used to select SR footprints intersecting the GR sweep gates.\nUsing other terms, we can describe this task as finding SR gates that, once aggregated, “match” with the GR sweep plane-position-indicator (PPI) display.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KOfe3LgnLt"}],"key":"IJxWXwSfA2"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To this end, we need to filter SR gates by GR ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"P2KQ63zgBj"},{"type":"inlineCode","value":"range","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"eoiSTVcfAV"},{"type":"text","value":" distance and ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Lk7ONRxEvM"},{"type":"inlineCode","value":"elevation","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Rxf0GIaLJa"},{"type":"text","value":" angle.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ufunfOT6Dy"}],"key":"E0Ls9GHP95"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Since the GR CRS is centered on the GR radar location, we can define the SR range mask using the “GR” ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"SiOq1nRpay"},{"type":"inlineCode","value":"range","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"uma9EGP26v"},{"type":"text","value":" coordinate.\nSo here below, we define the SR range mask with GR ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"E4rCOIURId"},{"type":"inlineCode","value":"range","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"HNdrI4Gtby"},{"type":"text","value":" between ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"iMFYkeB8Zi"},{"type":"inlineCode","value":"min_gr_range_lb","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"tzYxbFcxc4"},{"type":"text","value":" and ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"IbPZrTwrcX"},{"type":"inlineCode","value":"max_gr_range_ub","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"e2O3kyz4Ws"},{"type":"text","value":".\nWe suggest to specify ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LZ3Xwfeux5"},{"type":"inlineCode","value":"min_gr_range_lb","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fiWODdH1I2"},{"type":"text","value":" and ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"sIgElyogEZ"},{"type":"inlineCode","value":"max_gr_range_ub","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JkSgWwE08y"},{"type":"text","value":" not to restrictively, and rather perform more aggressive filtering once the SR/GR matched database is obtained.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"bkijjKbBto"}],"key":"irMjNNmnOM"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The SR elevation mask is obtained by selecting SR gates with ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ljNaE3Vn0E"},{"type":"inlineCode","value":"elevation","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"mppbfoXFNX"},{"type":"text","value":" angle between the GR sweep elevation angle minus/plus its half beamwidth.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"GvhNf7Nv8o"}],"key":"CFOwITS6FL"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Important note:","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"hUqG2uGKQ2"}],"key":"oAh4tnDVvr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Here we currently use the GR ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"uEJGETA7io"},{"type":"inlineCode","value":"range","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"PM7prVcqyt"},{"type":"text","value":" computed at the SR gate centroids (instead of at the SR gate lower and upper bound)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"tjN5dS2XMU"}],"key":"JIoWNJaZK6"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Here we currently use the GR ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"V9hhgp5rX6"},{"type":"inlineCode","value":"elevation","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ImsMru3pnG"},{"type":"text","value":" computed at the SR gate centroids (instead of at the SR gate lower and upper bound)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"VHiHiOPTHF"}],"key":"vSR5VQngzm"}],"key":"MOuo8o1af3"}],"key":"UdHcfbZ3or"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:00.524401Z","iopub.status.busy":"2024-09-08T07:01:00.523991Z","iopub.status.idle":"2024-09-08T07:01:00.934511Z","shell.execute_reply":"2024-09-08T07:01:00.933849Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define mask of SR footprints within GR range\nr = np.sqrt(x_sr**2 + y_sr**2)\nmask_sr_within_gr_range = r < ds_gr[\"range\"].max().item()\nmask_sr_within_gr_range.isel(range=-1).gpm.plot_map()\n\nmask_sr_within_gr_range_interval = (r >= min_gr_range_lb) & (r <= max_gr_range_ub)","key":"HRE8x88o3G"},{"type":"output","id":"R-479DDGYMZWy2X8FT2oT","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3efec8ad8f7da20084696d11d9468da4","path":"/erad2024/build/3efec8ad8f7da20084696d11d9468da4.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"nfsAGAG6JF"}],"key":"K4qShFBKhl"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:00.936546Z","iopub.status.busy":"2024-09-08T07:01:00.936376Z","iopub.status.idle":"2024-09-08T07:01:01.381406Z","shell.execute_reply":"2024-09-08T07:01:01.380748Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show how elevation angle (of GR) varies along SR scan angles\nelevation_sr.isel(cross_track=0).gpm.plot_cross_section(vmin=0, y=\"range\")\nelevation_sr.isel(cross_track=24).gpm.plot_cross_section(vmin=0, y=\"range\")\nelevation_sr.isel(cross_track=-1).gpm.plot_cross_section(vmin=0, y=\"range\")","key":"wqLT7TF0LV"},{"type":"output","id":"QMfM1ZUV0uvvrm0asZmCt","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3f2e567ebf6e011e93a52f9aa5b85224","path":"/erad2024/build/3f2e567ebf6e011e93a52f9aa5b85224.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"50031cdea01706313adeb289aa76f07f","path":"/erad2024/build/50031cdea01706313adeb289aa76f07f.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eba81135d3fceaaea3676a12f4f29c42","path":"/erad2024/build/eba81135d3fceaaea3676a12f4f29c42.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"CfMU6t3WxP"}],"key":"oeJBHr0JDD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:01.383452Z","iopub.status.busy":"2024-09-08T07:01:01.383270Z","iopub.status.idle":"2024-09-08T07:01:01.876565Z","shell.execute_reply":"2024-09-08T07:01:01.875981Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show SR/GR matched elevation\nmask_sr_matched_elevation = (elevation_sr >= (ds_gr[\"sweep_fixed_angle\"] - elevation_beamwidth_gr / 2.0)) & (\n    elevation_sr <= (ds_gr[\"sweep_fixed_angle\"] + elevation_beamwidth_gr / 2.0)\n)\nmask_sr_matched_elevation.isel(cross_track=0).gpm.plot_cross_section()\nmask_sr_matched_elevation.isel(cross_track=24).gpm.plot_cross_section()\nmask_sr_matched_elevation.isel(cross_track=-1).gpm.plot_cross_section()","key":"jTXzyS3zEL"},{"type":"output","id":"gzxWAtcIW94wP0d_5QSVX","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9e5fbf993168652d27be6b4c42a097c1","path":"/erad2024/build/9e5fbf993168652d27be6b4c42a097c1.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1c03ac0311ffb011f25803c3908a2b7d","path":"/erad2024/build/1c03ac0311ffb011f25803c3908a2b7d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"98ac89f72d54f4e525eb87284baf4ccd","path":"/erad2024/build/98ac89f72d54f4e525eb87284baf4ccd.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"O3LN1uzNNa"}],"key":"nfGxFGZghR"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:01.878511Z","iopub.status.busy":"2024-09-08T07:01:01.878336Z","iopub.status.idle":"2024-09-08T07:01:01.882352Z","shell.execute_reply":"2024-09-08T07:01:01.881818Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define mask of SR footprints matching GR gates\nmask_ppi = mask_sr_matched_elevation & mask_sr_within_gr_range_interval","key":"I8sMjjPagL"},{"type":"output","id":"hJ5BIVJnVHde7ZYLdjfPD","data":[],"key":"CWPf37SgrW"}],"key":"dK5J1JFVm3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:01.884162Z","iopub.status.busy":"2024-09-08T07:01:01.883995Z","iopub.status.idle":"2024-09-08T07:01:03.017222Z","shell.execute_reply":"2024-09-08T07:01:03.016707Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show mask (as SR map)\nmask_ppi.any(dim=\"range\").gpm.plot_map(vmin=0)\nmask_ppi.isel(range=-10).gpm.plot_map(vmin=0)\nmask_ppi.isel(range=-30).gpm.plot_map(vmin=0)","key":"dk2DQWeFgU"},{"type":"output","id":"jZ6pFo0slGFlk7HPGyed9","data":[{"output_type":"execute_result","execution_count":55,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5c518850>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c69b5a7311232f45fdfae7450436dbfa","path":"/erad2024/build/c69b5a7311232f45fdfae7450436dbfa.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a587ed30b2905b1d7d9ab8dd30e17be5","path":"/erad2024/build/a587ed30b2905b1d7d9ab8dd30e17be5.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"99d5295ddad191837d6225785ec85f62","path":"/erad2024/build/99d5295ddad191837d6225785ec85f62.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"I7nObBkWgf"}],"key":"VfWGCUnMwg"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:03.019228Z","iopub.status.busy":"2024-09-08T07:01:03.018932Z","iopub.status.idle":"2024-09-08T07:01:03.475168Z","shell.execute_reply":"2024-09-08T07:01:03.474330Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show mask (as SR cross-section)\nmask_ppi.isel(cross_track=24).gpm.plot_cross_section()\nmask_ppi.isel(cross_track=-1).gpm.plot_cross_section()\nmask_ppi.isel(cross_track=-1, along_track=slice(10, 60), range=slice(-40, None)).gpm.plot_cross_section()","key":"A9m9oballt"},{"type":"output","id":"Sv8MvZjnbxOZSrp_dZmDN","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f10dcb7302dc35e411c8d02e4395efe4","path":"/erad2024/build/f10dcb7302dc35e411c8d02e4395efe4.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4d6ef5f24ce8f52ef2f94416b45d09bd","path":"/erad2024/build/4d6ef5f24ce8f52ef2f94416b45d09bd.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f29000cd6dff037a1bfa22ebb2695b29","path":"/erad2024/build/f29000cd6dff037a1bfa22ebb2695b29.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"EU6lVQH4dY"}],"key":"c8kKaAjxHC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define SR Masks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J8WDlYlXUY"}],"identifier":"define-sr-masks","label":"Define SR Masks","html_id":"define-sr-masks","implicit":true,"key":"IZTKJmutqw"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we start by defining and analysing various SR masks that can be used to subset SR footprints to be matched with the GR sweep.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CMquDZqtns"}],"key":"hdxdqSTRuj"}],"key":"YOOprnCOuP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:03.477834Z","iopub.status.busy":"2024-09-08T07:01:03.477430Z","iopub.status.idle":"2024-09-08T07:01:03.480335Z","shell.execute_reply":"2024-09-08T07:01:03.479928Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select scan with \"normal\" dataQuality (for entire cross-track scan)\nmask_sr_quality = ds_sr[\"dataQuality\"] == 0","key":"cJqwTT7rZZ"},{"type":"output","id":"xKPbv6-ICWi8kdlVwKrM0","data":[],"key":"TRiZ0GWp4W"}],"key":"P1hkq5lYog"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:03.481949Z","iopub.status.busy":"2024-09-08T07:01:03.481769Z","iopub.status.idle":"2024-09-08T07:01:04.259664Z","shell.execute_reply":"2024-09-08T07:01:04.259097Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select beams with detected precipitation\nds_sr[\"flagPrecip\"].gpm.plot_map()\nmask_sr_precip = ds_sr[\"flagPrecip\"] > 0\nmask_sr_precip.name = \"mask_precip\"\nmask_sr_precip.gpm.plot_map()\nds_sr[\"flagPrecip\"].attrs","key":"tS8BpX6SKl"},{"type":"output","id":"u1snPoi5hlKFuoK7zpvxu","data":[{"output_type":"execute_result","execution_count":58,"metadata":{},"data":{"text/plain":{"content":"{'description': 'Flag for precipitation detection',\n 'flag_meanings': ['not detected by both Ku and Ka',\n  'detected by Ka only',\n  'detected by Ka only',\n  'detected by Ku only',\n  'detected by both Ku and Ka',\n  'detected by both Ku and Ka',\n  'detected by both Ku and Ka',\n  'detected by both Ku and Ka',\n  'detected by both Ku and Ka'],\n 'flag_values': [0, 1, 2, 10, 11, 12, 20, 21, 22],\n 'gpm_api_decoded': 'yes',\n 'gpm_api_product': '2A-DPR',\n 'grid_mapping': 'crsWGS84'}","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d3e34621f0f5b74bb1eabc917866490a","path":"/erad2024/build/d3e34621f0f5b74bb1eabc917866490a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7b67558771ebad7894472e4697a95310","path":"/erad2024/build/7b67558771ebad7894472e4697a95310.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"DvowluEpwd"}],"key":"QzyQDxMFNl"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:04.261666Z","iopub.status.busy":"2024-09-08T07:01:04.261348Z","iopub.status.idle":"2024-09-08T07:01:04.645015Z","shell.execute_reply":"2024-09-08T07:01:04.644509Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select above minimum SR reflectivity\nmask_sr_minimum_z = ds_sr[\"zFactorFinal\"] > z_min_threshold_sr\nmask_sr_minimum_z.name = \"Minimum_Reflectitvity\"\nmask_sr_minimum_z.any(dim=\"range\").gpm.plot_map()","key":"wCIw8Ib4Hp"},{"type":"output","id":"C22N6RQ4PVhdDt9CBy1NE","data":[{"output_type":"execute_result","execution_count":59,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f50302e90>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ca934a427dd00737796ae460a7f5b3dc","path":"/erad2024/build/ca934a427dd00737796ae460a7f5b3dc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"sHacidB95f"}],"key":"rGFC7cooGZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:04.647065Z","iopub.status.busy":"2024-09-08T07:01:04.646737Z","iopub.status.idle":"2024-09-08T07:01:04.648911Z","shell.execute_reply":"2024-09-08T07:01:04.648526Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only 'normal' data\n# mask_sr_quality_data = ds_sr[\"qualityData\"] == 0\n# mask_sr_quality_data.gpm.plot_map()","key":"yUUnK5vZZq"},{"type":"output","id":"RVHQ3hyaIj5xKKh3nmLH3","data":[],"key":"Dtw6Rv9Co5"}],"key":"Kg5aYfHK8g"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:04.650736Z","iopub.status.busy":"2024-09-08T07:01:04.650432Z","iopub.status.idle":"2024-09-08T07:01:04.652884Z","shell.execute_reply":"2024-09-08T07:01:04.652510Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only 'high quality' data\n# - qualityFlag derived from qualityData.\n# - qualityFlag == 1 indicates low quality retrievals\n# - qualityFlag == 2 indicates bad/missing retrievals\nmask_sr_quality_data = ds_sr[\"qualityFlag\"] == 0","key":"tQI9zbXZBV"},{"type":"output","id":"MmtuepNky3Ahr2PLXgaPx","data":[],"key":"vDro1IpWN0"}],"key":"fgQwx9LVWJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:04.654499Z","iopub.status.busy":"2024-09-08T07:01:04.654357Z","iopub.status.idle":"2024-09-08T07:01:05.694826Z","shell.execute_reply":"2024-09-08T07:01:05.694271Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only beams with detected bright band\nds_sr[\"qualityBB\"].gpm.plot_map()\nmask_sr_quality_bb = ds_sr[\"qualityBB\"] == 1\nmask_sr_quality_bb.name = \"mask_bb\"\nmask_sr_quality_bb.gpm.plot_map()","key":"B8Y2gCQ0YA"},{"type":"output","id":"cmGTQ8PVi-npHauRapZTq","data":[{"output_type":"execute_result","execution_count":62,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f505dfcd0>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c521eda0d3f37fc04859a14d39abd2bc","path":"/erad2024/build/c521eda0d3f37fc04859a14d39abd2bc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5c6c35f82d40a4afb2df6eb3907c3f89","path":"/erad2024/build/5c6c35f82d40a4afb2df6eb3907c3f89.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"ETPfK5nJNV"}],"key":"FjFVQQdwym"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:05.696666Z","iopub.status.busy":"2024-09-08T07:01:05.696495Z","iopub.status.idle":"2024-09-08T07:01:06.458492Z","shell.execute_reply":"2024-09-08T07:01:06.457813Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only beams with confident precipitation type\nds_sr[\"qualityTypePrecip\"].gpm.plot_map()\nmask_sr_quality_precip = ds_sr[\"qualityTypePrecip\"] == 1\nmask_sr_quality_precip.name = \"mask_precip_type\"\nmask_sr_quality_precip.gpm.plot_map()","key":"ksRcSeUFy3"},{"type":"output","id":"tgNPVa1aNXxNYcQ0SCtRy","data":[{"output_type":"execute_result","execution_count":63,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5071e990>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2630329c3b7b34505b353b8e876770e6","path":"/erad2024/build/2630329c3b7b34505b353b8e876770e6.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9e53ea554b1444bf96e8e4d6fdf3b8e2","path":"/erad2024/build/9e53ea554b1444bf96e8e4d6fdf3b8e2.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"JuVDPYdTqY"}],"key":"mzyafLNOr4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:06.460837Z","iopub.status.busy":"2024-09-08T07:01:06.460428Z","iopub.status.idle":"2024-09-08T07:01:07.231340Z","shell.execute_reply":"2024-09-08T07:01:07.230547Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only stratiform precipitation\nds_sr[\"flagPrecipitationType\"].gpm.plot_map()\nmask_sr_stratiform = ds_sr[\"flagPrecipitationType\"] == 1\nmask_sr_stratiform.name = \"mask_stratiform\"\nmask_sr_stratiform.gpm.plot_map()","key":"gB3I8o40vs"},{"type":"output","id":"V-Z7nvAR5Q2AD1U97ZOlX","data":[{"output_type":"execute_result","execution_count":64,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5cc16950>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a4549d4fb32d6d2c1829cacd09d25ce","path":"/erad2024/build/7a4549d4fb32d6d2c1829cacd09d25ce.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"73989bb5181d63cfbe539c223b28db7d","path":"/erad2024/build/73989bb5181d63cfbe539c223b28db7d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"cDl6KizC5j"}],"key":"MSKEZdLmvw"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:07.234054Z","iopub.status.busy":"2024-09-08T07:01:07.233668Z","iopub.status.idle":"2024-09-08T07:01:08.446299Z","shell.execute_reply":"2024-09-08T07:01:08.445741Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only beams with reduced path attenuation\n# ...\nds_sr[\"piaFinal\"].gpm.plot_map()  # PIA from DSD module\nds_sr[\"pathAtten\"].gpm.plot_map()  # PIAeff\nds_sr[\"reliabFlag\"].gpm.plot_map()  # reliability of PIAeff","key":"HcHb1V9W7c"},{"type":"output","id":"13fcK6vMcV7gfT744-pRW","data":[{"output_type":"execute_result","execution_count":65,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5caead10>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9cbb4b74d2a5c8d0d25d85ed1b61529a","path":"/erad2024/build/9cbb4b74d2a5c8d0d25d85ed1b61529a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"47e6d2e7852df9b0ffd8f8be80f1e508","path":"/erad2024/build/47e6d2e7852df9b0ffd8f8be80f1e508.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b044e51bafd601e3033b9369da278876","path":"/erad2024/build/b044e51bafd601e3033b9369da278876.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"J7zMBRJ4pl"}],"key":"hDXhcziLmW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:08.448296Z","iopub.status.busy":"2024-09-08T07:01:08.447981Z","iopub.status.idle":"2024-09-08T07:01:09.028473Z","shell.execute_reply":"2024-09-08T07:01:09.027800Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select only beams with limited attenuation correction\n# ...\nds_sr[\"zFactorCorrection\"].isel(cross_track=24).gpm.plot_cross_section(vmin=0, vmax=3, zoom=False)\nds_sr[\"zFactorCorrection\"].isel(range=-20).gpm.plot_map(vmin=0, vmax=6)","key":"MKcKrOFq6v"},{"type":"output","id":"6-pcyRUu4eQYskc67ukFr","data":[{"output_type":"execute_result","execution_count":66,"metadata":{},"data":{"text/plain":{"content":"<cartopy.mpl.geocollection.GeoQuadMesh at 0x7f5f5c460890>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f6260996327fb352405b01be1fe80d16","path":"/erad2024/build/f6260996327fb352405b01be1fe80d16.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4fbb7207ed8259c7b862bbe1ea9ef8ee","path":"/erad2024/build/4fbb7207ed8259c7b862bbe1ea9ef8ee.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"SKYKedzgPq"}],"key":"DsLzttIDHS"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here we define the actual SR mask used to select the SR footprints on which the SR/GR matching will be performed.\nOnce again, we suggest to avoid, at this stage, being too restrictive in the selection of SR footprints.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sXfUkeu8hU"}],"key":"foQJR6PpPH"}],"key":"uzbHqHSt6U"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:09.030872Z","iopub.status.busy":"2024-09-08T07:01:09.030460Z","iopub.status.idle":"2024-09-08T07:01:09.820308Z","shell.execute_reply":"2024-09-08T07:01:09.819694Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define 3D mask of SR gates matching GR PPI gates\n# - TIP: do not mask eccessively here ... but rather at final stage\nmask_matched_ppi_3d = mask_ppi & mask_sr_precip & mask_sr_quality\n\n# Define 2D mask of SR beams matching the GR PPI\nmask_matched_ppi_2d = mask_matched_ppi_3d.any(dim=\"range\")\nmask_matched_ppi_2d.gpm.plot_map()\n\n# Number of matching SR gates per beam\nn_matching_sr_gates = mask_matched_ppi_3d.sum(dim=\"range\")\nn_matching_sr_gates.where(n_matching_sr_gates > 0).gpm.plot_map()\n\n# Beam indices with at least one matching bin\ncross_track_indices, along_track_indices = np.where(mask_matched_ppi_3d.sum(dim=\"range\"))\n\n# Number of beams with at least one valid bin\nlen(along_track_indices)","key":"UNCQZASREQ"},{"type":"output","id":"hT7DpBY2NmyEQoK7K9hMq","data":[{"output_type":"execute_result","execution_count":67,"metadata":{},"data":{"text/plain":{"content":"1305","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eb314d3fc766b437610d55056b854e4a","path":"/erad2024/build/eb314d3fc766b437610d55056b854e4a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cf566fa026860a35f5c4616e7c72777b","path":"/erad2024/build/cf566fa026860a35f5c4616e7c72777b.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"nwJmDrpHq5"}],"key":"U32t19j2Ks"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aggregate SR radar gates","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jdah6SoNgA"}],"identifier":"aggregate-sr-radar-gates","label":"Aggregate SR radar gates","html_id":"aggregate-sr-radar-gates","implicit":true,"key":"BqdnGR7a2z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this subsection, we aggregate SR radar gates intersecting the GR sweep.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RnePEDkPCu"}],"key":"YE3bePnXUE"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"SR reflectivities are averaged along the SR beam (approximately vertically) between the half-power points of the GR sweep.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WDNvQKSUc9"}],"key":"kBtLRvjZaq"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To select SR radar gates for aggregation, the following criteria must be met:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jXMSFtyW4O"}],"key":"dPtwbxyE3D"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The SR footprints must contain precipitation.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"l491tKMtt7"}],"key":"xz6CTqdJ0H"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"The SR radar gates must overlap with GR gates.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"GeNfncNUhr"}],"key":"uCR9mHKOXU"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The SR radar gates must fall within a specified GR range distance, defined by ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"y7BtsKC2Ne"},{"type":"inlineCode","value":"min_gr_range","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"MZi3Ph7Msf"},{"type":"text","value":" and ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"xGywkvAAQv"},{"type":"inlineCode","value":"max_gr_range","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qv6bqqJkw3"},{"type":"text","value":".","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"yz9Kd7YyeD"}],"key":"gPEmbqrv8U"}],"key":"nX2qiA5oQP"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"sONUcqDNAQ"},{"type":"inlineCode","value":"min_gr_range","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"teJabs9yZN"},{"type":"text","value":" ensures that the GR beamwidth is not smaller than the SR gate spacing.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"a2le8EH0Pc"}],"key":"zP3VYOguly"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Important Notes:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fItbC5fcJn"}],"key":"B7kijtB0by"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Reflectivity must not be aggregated in dBZ, but rather in mm6 m−3","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"f39V3FIRFz"}],"key":"x1bHqZgfxx"}],"key":"xDeTyNQ1vn"}],"key":"pbRwfJG9Y9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:09.822623Z","iopub.status.busy":"2024-09-08T07:01:09.822269Z","iopub.status.idle":"2024-09-08T07:01:10.526558Z","shell.execute_reply":"2024-09-08T07:01:10.526054Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add variables to SR dataset\nds_sr[\"zFactorMeasured_Ku\"] = ds_sr[\"zFactorMeasured\"]\nds_sr[\"zFactorFinal_Ku\"] = ds_sr[\"zFactorFinal\"]\nds_sr[\"zFactorFinal_S\"] = da_z_s_final\nds_sr[\"zFactorMeasured_S\"] = da_z_s_measured\nds_sr[\"zFactorCorrection_Ku\"] = ds_sr[\"zFactorCorrection\"]\nds_sr[\"zFactorCorrection_S\"] = da_z_s_correction\nds_sr[\"hres\"] = h_res_sr\nds_sr[\"vres\"] = v_res_sr\nds_sr[\"gate_volume\"] = vol_sr\nds_sr[\"x\"] = x_sr\nds_sr[\"y\"] = y_sr\nds_sr[\"z\"] = z_sr\n\n# Compute path-integrated reflectivities\nds_sr[\"zFactorFinal_Ku_cumsum\"] = ds_sr[\"zFactorFinal\"].gpm.idecibel.cumsum(\"range\").gpm.decibel\nds_sr[\"zFactorFinal_Ku_cumsum\"] = ds_sr[\"zFactorFinal_Ku_cumsum\"].where(np.isfinite(ds_sr[\"zFactorFinal_Ku_cumsum\"]))\nds_sr[\"zFactorMeasured_Ku_cumsum\"] = ds_sr[\"zFactorMeasured\"].gpm.idecibel.cumsum(\"range\").gpm.decibel\nds_sr[\"zFactorMeasured_Ku_cumsum\"] = ds_sr[\"zFactorMeasured_Ku_cumsum\"].where(\n    np.isfinite(ds_sr[\"zFactorMeasured_Ku_cumsum\"]),\n)\nds_sr[\"zFactorFinal_S_cumsum\"] = ds_sr[\"zFactorFinal_S\"].gpm.idecibel.cumsum(\"range\").gpm.decibel\nds_sr[\"zFactorFinal_S_cumsum\"] = ds_sr[\"zFactorFinal_S_cumsum\"].where(np.isfinite(ds_sr[\"zFactorFinal_S_cumsum\"]))\nds_sr[\"zFactorMeasured_S_cumsum\"] = ds_sr[\"zFactorMeasured_S\"].gpm.idecibel.cumsum(\"range\").gpm.decibel\nds_sr[\"zFactorMeasured_S_cumsum\"] = ds_sr[\"zFactorMeasured_S_cumsum\"].where(\n    np.isfinite(ds_sr[\"zFactorMeasured_S_cumsum\"]),\n)\n\n# Add variables to the spaceborne dataset\nz_variables = [\"zFactorFinal_Ku\", \"zFactorFinal_S\", \"zFactorMeasured_Ku\", \"zFactorMeasured_S\"]\nsr_variables = [\n    *z_variables,\n    \"zFactorCorrection_Ku\",\n    \"zFactorCorrection_S\",\n    \"precipRate\",\n    \"airTemperature\",\n    \"zFactorFinal_Ku_cumsum\",\n    \"zFactorMeasured_Ku_cumsum\",\n    \"zFactorFinal_S_cumsum\",\n    \"zFactorMeasured_S_cumsum\",\n    \"hres\",\n    \"vres\",\n    \"gate_volume\",\n    \"x\",\n    \"y\",\n    \"z\",\n]\n\n# Initialize Dataset where to add aggregated SR gates\nds_sr_match_ppi = xr.Dataset()\n\n# Mask SR gates not matching the GR PPI\nds_sr_ppi = ds_sr[sr_variables].where(mask_matched_ppi_3d)\n\n# Compute aggregation statistics\nds_sr_ppi_min = ds_sr_ppi.min(\"range\")\nds_sr_ppi_max = ds_sr_ppi.max(\"range\")\nds_sr_ppi_sum = ds_sr_ppi.sum(dim=\"range\", skipna=True)\nds_sr_ppi_mean = ds_sr_ppi.mean(\"range\")\nds_sr_ppi_std = ds_sr_ppi.std(\"range\")\n\n# Aggregate reflectivities (in mm6/mm3)\nfor var in z_variables:\n    ds_sr_ppi_mean[var] = ds_sr_ppi[var].gpm.idecibel.mean(\"range\").gpm.decibel\n    ds_sr_ppi_std[var] = ds_sr_ppi[var].gpm.idecibel.std(\"range\").gpm.decibel\n    # If only 1 value, std=0, log transform become -inf --> Set to 0\n    is_inf = np.isinf(ds_sr_ppi_std[var])\n    ds_sr_ppi_std[var] = ds_sr_ppi_std[var].where(~is_inf, 0)\n\n# Compute counts and fractions above sensitivity thresholds\nsr_sensitivity_thresholds = [10, 12, 14, 16, 18]\nds_sr_match_ppi[\"SR_counts\"] = mask_matched_ppi_3d.sum(dim=\"range\")\nds_sr_match_ppi[\"SR_counts_valid\"] = (~np.isnan(ds_sr_ppi[\"zFactorFinal_Ku\"])).sum(dim=\"range\")\nfor var in z_variables:\n    for thr in sr_sensitivity_thresholds:\n        fraction = (ds_sr_ppi[var] >= thr).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\n        ds_sr_match_ppi[f\"SR_{var}_fraction_above_{thr}dBZ\"] = fraction\n\n# Compute fraction of hydrometeor types\nda_hydro_class = ds_sr[\"flagHydroClass\"].where(mask_matched_ppi_3d)\nds_sr_match_ppi[\"SR_fraction_no_precip\"] = (da_hydro_class == 0).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_rain\"] = (da_hydro_class == 1).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_snow\"] = (da_hydro_class == 2).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_hail\"] = (da_hydro_class == 3).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_melting_layer\"] = (da_hydro_class == 4).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_clutter\"] = (da_hydro_class == 5).sum(dim=\"range\") / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_below_isotherm\"] = (ds_sr_ppi[\"airTemperature\"] >= 273.15).sum(\n    dim=\"range\",\n) / ds_sr_match_ppi[\"SR_counts\"]\nds_sr_match_ppi[\"SR_fraction_above_isotherm\"] = (ds_sr_ppi[\"airTemperature\"] < 273.15).sum(\n    dim=\"range\",\n) / ds_sr_match_ppi[\"SR_counts\"]\n\n# Add aggregation statistics\nfor var in ds_sr_ppi_mean.data_vars:\n    ds_sr_match_ppi[f\"SR_{var}_mean\"] = ds_sr_ppi_mean[var]\nfor var in ds_sr_ppi_std.data_vars:\n    ds_sr_match_ppi[f\"SR_{var}_std\"] = ds_sr_ppi_std[var]\nfor var in ds_sr_ppi_sum.data_vars:\n    ds_sr_match_ppi[f\"SR_{var}_sum\"] = ds_sr_ppi_sum[var]\nfor var in ds_sr_ppi_max.data_vars:\n    ds_sr_match_ppi[f\"SR_{var}_max\"] = ds_sr_ppi_max[var]\nfor var in ds_sr_ppi_min.data_vars:\n    ds_sr_match_ppi[f\"SR_{var}_min\"] = ds_sr_ppi_min[var]\nfor var in ds_sr_ppi_min.data_vars:\n    ds_sr_match_ppi[f\"SR_{var}_range\"] = ds_sr_ppi_max[var] - ds_sr_ppi_min[var]\n\n# Compute coefficient of variation\nfor var in z_variables:\n    ds_sr_match_ppi[f\"SR_{var}_cov\"] = ds_sr_match_ppi[f\"SR_{var}_std\"] / ds_sr_match_ppi[f\"SR_{var}_mean\"]\n\n# Add SR L2 variables (useful for final filtering and analysis)\nvar_l2 = [\n    \"flagPrecip\",\n    \"flagPrecipitationType\",\n    \"dataQuality\",\n    \"sunLocalTime\",\n    \"SCorientation\",\n    \"qualityFlag\",\n    \"qualityTypePrecip\",\n    \"qualityBB\",\n    \"pathAtten\",\n    \"piaFinal\",\n    \"reliabFlag\",\n]\nfor var in var_l2:\n    ds_sr_match_ppi[f\"SR_{var}\"] = ds_sr[var]\n\n# Add SR time\nds_sr_match_ppi[\"SR_time\"] = ds_sr_match_ppi[\"time\"]\nds_sr_match_ppi = ds_sr_match_ppi.drop(\"time\")\n\n# Mask SR beams not matching the GR PPI\nds_sr_match_ppi = ds_sr_match_ppi.where(mask_matched_ppi_2d)\n\n# Remove unecessary coordinates\nunecessary_coords = [\n    \"radar_frequency\",\n    \"sweep_mode\",\n    \"prt_mode\",\n    \"follow_mode\",\n    \"latitude\",\n    \"longitude\",\n    \"altitude\",\n    \"crs_wkt\",\n    \"time\",\n    \"crsWGS84\",\n    \"dataQuality\",\n    \"sunLocalTime\",\n    \"SCorientation\",\n]\nfor coord in unecessary_coords:\n    if coord in ds_sr_match_ppi:\n        ds_sr_match_ppi = ds_sr_match_ppi.drop(coord)\n    if coord in mask_matched_ppi_2d.coords:\n        mask_matched_ppi_2d = mask_matched_ppi_2d.drop(coord)\n\n# Stack aggregated dataset to beam dimension index\nds_sr_stack = ds_sr_match_ppi.stack(sr_beam_index=(\"along_track\", \"cross_track\"))\nda_mask_matched_ppi_stack = mask_matched_ppi_2d.stack(sr_beam_index=(\"along_track\", \"cross_track\"))\n\n# Drop beams not matching the GR PPI\nds_sr_match = ds_sr_stack.isel(sr_beam_index=da_mask_matched_ppi_stack)","key":"cLivxsCa3J"},{"type":"output","id":"Cmb9pwESwlFFzWMYNeeLq","data":[],"key":"bQKCbDjtuh"}],"key":"FobfRv3Y9p"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Display aggregated SR variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OuUqzaUjwV"}],"identifier":"display-aggregated-sr-variables","label":"Display aggregated SR variables","html_id":"display-aggregated-sr-variables","implicit":true,"key":"FuNogWwbfS"}],"key":"SafnrvImVI"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:10.528675Z","iopub.status.busy":"2024-09-08T07:01:10.528511Z","iopub.status.idle":"2024-09-08T07:01:12.733721Z","shell.execute_reply":"2024-09-08T07:01:12.733194Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Original SR near surface reflectivity\np = ds_sr[\"zFactorFinalNearSurface\"].gpm.plot_map(vmin=10, vmax=40)\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\n\n# Original GR reflectivities\np = ds_gr[\"DBZH\"].where(mask_gr).xradar_dev.plot_map(vmin=10, vmax=40)\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\nds_sr.gpm.plot_swath_lines(ax=p.axes)","key":"AulNGofkKU"},{"type":"output","id":"91K8O93wgouJ9HKzNxTIe","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c2766a43f535d05101f3289f94db4a00","path":"/erad2024/build/c2766a43f535d05101f3289f94db4a00.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d076f7252591cf06141f6ef46093e014","path":"/erad2024/build/d076f7252591cf06141f6ef46093e014.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"u5npi7ouD6"}],"key":"FmZtxCSOLK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:12.736141Z","iopub.status.busy":"2024-09-08T07:01:12.735977Z","iopub.status.idle":"2024-09-08T07:01:13.880258Z","shell.execute_reply":"2024-09-08T07:01:13.879680Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# SR reflectivity statistics matching the GR PPI (using xr.Dataset)\np = ds_sr_ppi_max[\"zFactorFinal_Ku\"].gpm.plot_map(cmap=cmap, vmin=10, vmax=40)\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\n\np = ds_sr_ppi_mean[\"zFactorFinal_Ku\"].gpm.plot_map(cmap=cmap, vmin=10, vmax=40)\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\n\np = ds_sr_ppi_mean[\"zFactorMeasured_Ku\"].gpm.plot_map(cmap=cmap, vmin=10, vmax=40)\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))","key":"sN5D4YoeUv"},{"type":"output","id":"ifJO70I-Mc01fva6xIhGK","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e1c90b02c46d9af45042e987eca90e4e","path":"/erad2024/build/e1c90b02c46d9af45042e987eca90e4e.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"15aa2b9c8e13b3d92d7198bf73ab5a33","path":"/erad2024/build/15aa2b9c8e13b3d92d7198bf73ab5a33.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"90e0c027ae94265637d64e51e7b718a0","path":"/erad2024/build/90e0c027ae94265637d64e51e7b718a0.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"eUBPV7PjPj"}],"key":"buD4fAk94r"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:13.882409Z","iopub.status.busy":"2024-09-08T07:01:13.882236Z","iopub.status.idle":"2024-09-08T07:01:14.259906Z","shell.execute_reply":"2024-09-08T07:01:14.259365Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show difference between using Ku mean and max !\ndiff = ds_sr_ppi_max[\"zFactorFinal_Ku\"] - ds_sr_ppi_mean[\"zFactorFinal_Ku\"]\ndiff.name = \"Difference between Z max and Z mean\"\np = diff.gpm.plot_map(cmap=\"Spectral_r\")\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))","key":"QPCBvrdKKN"},{"type":"output","id":"hwCpU6UMEgAgzGI2qBP32","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1c8e87af25575734b5fa67a09289a015","path":"/erad2024/build/1c8e87af25575734b5fa67a09289a015.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"p9RjAA4ZiK"}],"key":"wzwpbfy8XL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:14.262189Z","iopub.status.busy":"2024-09-08T07:01:14.262019Z","iopub.status.idle":"2024-09-08T07:01:14.710323Z","shell.execute_reply":"2024-09-08T07:01:14.709767Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show SR mean precip rate\np = ds_sr_ppi_mean[\"precipRate\"].gpm.plot_map()\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))","key":"olBXoqGl2M"},{"type":"output","id":"NRn2BaTZU4M3pUWlz1Cem","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e871c51c3acaa31bbe54f81eecbe87ab","path":"/erad2024/build/e871c51c3acaa31bbe54f81eecbe87ab.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"JPNMVXw5X2"}],"key":"zccQwlKXWr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:14.712458Z","iopub.status.busy":"2024-09-08T07:01:14.712059Z","iopub.status.idle":"2024-09-08T07:01:14.843554Z","shell.execute_reply":"2024-09-08T07:01:14.843032Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display reflectivity in 3D\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection=\"3d\")\nax.scatter(\n    ds_sr_match[\"SR_x_mean\"].values,\n    ds_sr_match[\"SR_y_mean\"].values,\n    ds_sr_match[\"SR_z_mean\"].values,\n    c=ds_sr_match[\"SR_zFactorFinal_Ku_mean\"].values,\n    cmap=\"turbo\",\n    vmin=10,\n    vmax=40,\n    s=5,\n)","key":"l2IhUP6mVz"},{"type":"output","id":"xUVjh_yZyBGCtMasz9ULq","data":[{"output_type":"execute_result","execution_count":73,"metadata":{},"data":{"text/plain":{"content":"<mpl_toolkits.mplot3d.art3d.Path3DCollection at 0x7f5f43d3fbd0>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f2a4fcb2c49a4f0397f7fd8a9952e51a","path":"/erad2024/build/f2a4fcb2c49a4f0397f7fd8a9952e51a.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"key":"xLsR2Sj8Nm"}],"key":"NlpMUPc9jL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:14.845603Z","iopub.status.busy":"2024-09-08T07:01:14.845207Z","iopub.status.idle":"2024-09-08T07:01:15.117992Z","shell.execute_reply":"2024-09-08T07:01:15.117390Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Disply SR footprint horizontal resolution\np = ds_sr_ppi_max[\"hres\"].gpm.plot_map(cmap=\"turbo\")\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\nplt.show()","key":"kECKy11F2W"},{"type":"output","id":"0S9o-HwTbzOrDh8XzFWEe","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a7d44dc3ceffc4bed95932e7c3e0aeaf","path":"/erad2024/build/a7d44dc3ceffc4bed95932e7c3e0aeaf.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"HsNKgTpEXZ"}],"key":"c9j9S1ihyX"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:15.120156Z","iopub.status.busy":"2024-09-08T07:01:15.119988Z","iopub.status.idle":"2024-09-08T07:01:15.444996Z","shell.execute_reply":"2024-09-08T07:01:15.444443Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display SR depth over which data are integrated\np = ds_sr_ppi_sum[\"vres\"].gpm.plot_map(cmap=\"turbo\")\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\nplt.show()","key":"vzPkMkqFYv"},{"type":"output","id":"8bF3MJ88U4JsaIRuuB5o_","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d6c837a0b457b5dc48c8b0e48a4b5632","path":"/erad2024/build/d6c837a0b457b5dc48c8b0e48a4b5632.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"ffnTlyQkgP"}],"key":"WjuWtAzzuc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:15.447237Z","iopub.status.busy":"2024-09-08T07:01:15.447071Z","iopub.status.idle":"2024-09-08T07:01:16.011216Z","shell.execute_reply":"2024-09-08T07:01:16.010680Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display SR volume over which data are integrated\np = ds_sr_ppi_sum[\"gate_volume\"].gpm.plot_map(cmap=\"turbo\")\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\nplt.show()","key":"e0VRLpJ5Jg"},{"type":"output","id":"4fF9XLxdtpkUZyMRJCd18","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c5cccec469d9fe1be6e574d142440a3b","path":"/erad2024/build/c5cccec469d9fe1be6e574d142440a3b.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"uvNpqY8yBI"}],"key":"w78i5yjg5V"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:16.013474Z","iopub.status.busy":"2024-09-08T07:01:16.013307Z","iopub.status.idle":"2024-09-08T07:01:17.035377Z","shell.execute_reply":"2024-09-08T07:01:17.034848Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Display GR radar volume\np = vol_gr.xradar_dev.plot_map()\np.axes.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))\nplt.show()","key":"uElzCNhEDD"},{"type":"output","id":"dt7glwl27yl-d1Z01ihzN","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5f3883a8a2badc6fa8728e5c59483a89","path":"/erad2024/build/5f3883a8a2badc6fa8728e5c59483a89.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"lRVVYa2rMc"}],"key":"B3Qbe6SMSq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve the SR footprints polygons","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qrV4V0fJ7I"}],"identifier":"retrieve-the-sr-footprints-polygons","label":"Retrieve the SR footprints polygons","html_id":"retrieve-the-sr-footprints-polygons","implicit":true,"key":"U64m6Yk2ku"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we retrieve SR footprints polygons and then we construct a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z5iYnz84Zh"},{"type":"inlineCode","value":"geopandas.DataFrame","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aNbE6ZRDn1"},{"type":"text","value":" with the aggregated SR reflectivities.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mNRoNCLJSn"}],"key":"RXYJSN8wDH"}],"key":"D3vc20UMvR"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:17.037962Z","iopub.status.busy":"2024-09-08T07:01:17.037425Z","iopub.status.idle":"2024-09-08T07:01:17.096291Z","shell.execute_reply":"2024-09-08T07:01:17.095734Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Retrieve SR footprint polygons (using the footprint radius in AEQD x,y coordinates)\nxy_mean_sr = np.stack([ds_sr_match[\"SR_x_mean\"], ds_sr_match[\"SR_y_mean\"]], axis=-1)\nfootprint_radius = ds_sr_match[\"SR_hres_max\"].to_numpy() / 2\nsr_poly = [Point(x, y).buffer(footprint_radius[i]) for i, (x, y) in enumerate(xy_mean_sr)]","key":"RQoSwy6KhH"},{"type":"output","id":"ycpRuoTsGYv1E--zzz1RV","data":[],"key":"tleRXujCqP"}],"key":"vPOWvr5RtB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:17.098551Z","iopub.status.busy":"2024-09-08T07:01:17.098385Z","iopub.status.idle":"2024-09-08T07:01:17.111630Z","shell.execute_reply":"2024-09-08T07:01:17.111138Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create geopandas DataFrame\ndf_sr_match = ds_sr_match.to_dataframe()\ngdf_sr = gpd.GeoDataFrame(df_sr_match, crs=crs_gr, geometry=sr_poly)\ngdf_sr.columns","key":"lqxKWMQwah"},{"type":"output","id":"FPdHgrMIEZfFKIG-8Iysc","data":[{"output_type":"execute_result","execution_count":79,"metadata":{},"data":{"text/plain":{"content":"Index(['SR_counts', 'SR_counts_valid',\n       'SR_zFactorFinal_Ku_fraction_above_10dBZ',\n       'SR_zFactorFinal_Ku_fraction_above_12dBZ',\n       'SR_zFactorFinal_Ku_fraction_above_14dBZ',\n       'SR_zFactorFinal_Ku_fraction_above_16dBZ',\n       'SR_zFactorFinal_Ku_fraction_above_18dBZ',\n       'SR_zFactorFinal_S_fraction_above_10dBZ',\n       'SR_zFactorFinal_S_fraction_above_12dBZ',\n       'SR_zFactorFinal_S_fraction_above_14dBZ',\n       ...\n       'gpm_cross_track_id', 'gpm_granule_id', 'gpm_id', 'lat', 'lon',\n       'sweep_fixed_angle', 'sweep_number', 'along_track', 'cross_track',\n       'geometry'],\n      dtype='object', length=165)","content_type":"text/plain"}}}],"key":"cf1rQUaI0t"}],"key":"muH0T3K3ac"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:17.113925Z","iopub.status.busy":"2024-09-08T07:01:17.113466Z","iopub.status.idle":"2024-09-08T07:01:17.116751Z","shell.execute_reply":"2024-09-08T07:01:17.116202Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Extract radar gate polygon on the range-azimuth axis\nsr_poly = np.array(gdf_sr.geometry)","key":"bPWwxwBJBt"},{"type":"output","id":"m4laAQyO5fyFTVNR_TPOV","data":[],"key":"bE5aQDee5p"}],"key":"WjWgYFwrhq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve the GR gates polygons","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XyGGi5ZOt2"}],"identifier":"retrieve-the-gr-gates-polygons","label":"Retrieve the GR gates polygons","html_id":"retrieve-the-gr-gates-polygons","implicit":true,"key":"irYpHOVVLZ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we retrieve GR gates polygons and then we construct a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f1oHO8uFQS"},{"type":"inlineCode","value":"geopandas.DataFrame","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pe9TXHFBUp"},{"type":"text","value":" containing the GR measurements.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"D0IZDmPrq2"}],"key":"CQz9jiePuK"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Currently the GR gates polygons are derived inferring the quadmesh around the GR gate centroids (using the x and y GR CRS coordinates).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IVQKVNGRZK"}],"key":"M1k6jCGaC7"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"More accurate GR gates polygons could be derived using the GR beamwidth. We welcome contributions addressing this point !","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fQ9Nh4kZYZ"}],"key":"dgCN765kEs"}],"key":"cDo8NmZdOz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:17.119461Z","iopub.status.busy":"2024-09-08T07:01:17.118826Z","iopub.status.idle":"2024-09-08T07:01:18.881617Z","shell.execute_reply":"2024-09-08T07:01:18.881074Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add variables to GR dataset\nds_gr[\"gate_volume\"] = vol_gr\nds_gr[\"vres\"] = v_res_gr\nds_gr[\"hres\"] = h_res_gr\n\n# Add path_integrated_reflectivities\nds_gr[\"Z_cumsum\"] = ds_gr[\"DBZH\"].gpm.idecibel.cumsum(\"range\").gpm.decibel\nds_gr[\"Z_cumsum\"] = ds_gr[\"Z_cumsum\"].where(np.isfinite(ds_gr[\"Z_cumsum\"]))\n\n# Mask reflectivites above minimum GR Z threshold\nmask_gr = ds_gr[\"DBZH\"] > z_min_threshold_gr  # important !\n\n# Subset gates in range distance interval\nds_gr_subset = ds_gr.sel(range=slice(min_gr_range_lb, max_gr_range_ub)).where(mask_gr)\n\n# Retrieve geopandas dataframe\ngdf_gr = ds_gr_subset.xradar_dev.to_geopandas()  # here we currently infer the quadmesh using the x,y coordinates\ndisplay(gdf_gr)","key":"pHFNRKN7tE"},{"type":"output","id":"TVqbdwjusRfxlzswRV4kp","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>CCORH</th>\n      <th>DBZH</th>\n      <th>PHIDP</th>\n      <th>RHOHV</th>\n      <th>ZDR</th>\n      <th>gate_volume</th>\n      <th>vres</th>\n      <th>hres</th>\n      <th>Z_cumsum</th>\n      <th>follow_mode</th>\n      <th>...</th>\n      <th>time</th>\n      <th>crs_wkt</th>\n      <th>x</th>\n      <th>y</th>\n      <th>z</th>\n      <th>lon</th>\n      <th>lat</th>\n      <th>range</th>\n      <th>azimuth</th>\n      <th>geometry</th>\n    </tr>\n    <tr>\n      <th>azimuth</th>\n      <th>range</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">0.249939</th>\n      <th>2125.0</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.577999872</td>\n      <td>0</td>\n      <td>9.269070</td>\n      <td>2124.819592</td>\n      <td>338.193914</td>\n      <td>-117.041702</td>\n      <td>32.938177</td>\n      <td>2125.0</td>\n      <td>0.249939</td>\n      <td>POLYGON ((0.048 1999.906, 17.399 1999.755, 19....</td>\n    </tr>\n    <tr>\n      <th>2375.0</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.577999872</td>\n      <td>0</td>\n      <td>10.359546</td>\n      <td>2374.797765</td>\n      <td>340.369314</td>\n      <td>-117.041691</td>\n      <td>32.940431</td>\n      <td>2375.0</td>\n      <td>0.249939</td>\n      <td>POLYGON ((0.054 2249.894, 19.574 2249.724, 21....</td>\n    </tr>\n    <tr>\n      <th>2625.0</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.577999872</td>\n      <td>0</td>\n      <td>11.450022</td>\n      <td>2624.775811</td>\n      <td>342.552070</td>\n      <td>-117.041679</td>\n      <td>32.942685</td>\n      <td>2625.0</td>\n      <td>0.249939</td>\n      <td>POLYGON ((0.06 2499.881, 21.749 2499.692, 23.9...</td>\n    </tr>\n    <tr>\n      <th>2875.0</th>\n      <td>34.0</td>\n      <td>0.5</td>\n      <td>-0.352597</td>\n      <td>0.681667</td>\n      <td>-12.9375</td>\n      <td>4.944045e+05</td>\n      <td>50.179489</td>\n      <td>50.179489</td>\n      <td>3.267492</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.577999872</td>\n      <td>0</td>\n      <td>12.540497</td>\n      <td>2874.753727</td>\n      <td>344.742182</td>\n      <td>-117.041667</td>\n      <td>32.944939</td>\n      <td>2875.0</td>\n      <td>0.249939</td>\n      <td>POLYGON ((0.066 2749.869, 23.924 2749.661, 26....</td>\n    </tr>\n    <tr>\n      <th>3125.0</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.577999872</td>\n      <td>0</td>\n      <td>13.630971</td>\n      <td>3124.731515</td>\n      <td>346.939649</td>\n      <td>-117.041656</td>\n      <td>32.947193</td>\n      <td>3125.0</td>\n      <td>0.249939</td>\n      <td>POLYGON ((0.072 2999.856, 26.099 2999.629, 28....</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">359.758301</th>\n      <th>148875.0</th>\n      <td>-8.0</td>\n      <td>30.5</td>\n      <td>0.352597</td>\n      <td>1.051667</td>\n      <td>-12.9375</td>\n      <td>1.325715e+09</td>\n      <td>2598.424805</td>\n      <td>2598.424805</td>\n      <td>53.491735</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.552999936</td>\n      <td>0</td>\n      <td>-627.816405</td>\n      <td>148825.540792</td>\n      <td>2879.986614</td>\n      <td>-117.048617</td>\n      <td>34.260815</td>\n      <td>148875.0</td>\n      <td>359.758301</td>\n      <td>POLYGON ((-1297.323 148694.78, 42.744 148706.4...</td>\n    </tr>\n    <tr>\n      <th>149125.0</th>\n      <td>-8.0</td>\n      <td>28.5</td>\n      <td>179.824400</td>\n      <td>1.051667</td>\n      <td>-12.9375</td>\n      <td>1.330171e+09</td>\n      <td>2602.788330</td>\n      <td>2602.788330</td>\n      <td>53.505473</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.552999936</td>\n      <td>0</td>\n      <td>-628.870300</td>\n      <td>149075.369488</td>\n      <td>2886.478208</td>\n      <td>-117.048629</td>\n      <td>34.263068</td>\n      <td>149125.0</td>\n      <td>359.758301</td>\n      <td>POLYGON ((-1299.502 148944.599, 42.816 148956....</td>\n    </tr>\n    <tr>\n      <th>149375.0</th>\n      <td>-8.0</td>\n      <td>29.0</td>\n      <td>-0.705194</td>\n      <td>0.201667</td>\n      <td>-13.0625</td>\n      <td>1.334635e+09</td>\n      <td>2607.151855</td>\n      <td>2607.151855</td>\n      <td>53.520836</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.552999936</td>\n      <td>0</td>\n      <td>-629.924194</td>\n      <td>149325.197802</td>\n      <td>2892.977147</td>\n      <td>-117.048641</td>\n      <td>34.265320</td>\n      <td>149375.0</td>\n      <td>359.758301</td>\n      <td>POLYGON ((-1301.682 149194.418, 42.888 149206....</td>\n    </tr>\n    <tr>\n      <th>149625.0</th>\n      <td>-8.0</td>\n      <td>30.5</td>\n      <td>-0.705194</td>\n      <td>0.201667</td>\n      <td>-13.0625</td>\n      <td>1.339106e+09</td>\n      <td>2611.515137</td>\n      <td>2611.515137</td>\n      <td>53.542444</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.552999936</td>\n      <td>0</td>\n      <td>-630.978086</td>\n      <td>149575.025734</td>\n      <td>2899.483431</td>\n      <td>-117.048652</td>\n      <td>34.267572</td>\n      <td>149625.0</td>\n      <td>359.758301</td>\n      <td>POLYGON ((-1303.862 149444.236, 42.959 149455....</td>\n    </tr>\n    <tr>\n      <th>149875.0</th>\n      <td>-8.0</td>\n      <td>28.0</td>\n      <td>-0.705194</td>\n      <td>0.201667</td>\n      <td>-13.0625</td>\n      <td>1.343585e+09</td>\n      <td>2615.878662</td>\n      <td>2615.878662</td>\n      <td>53.554548</td>\n      <td>not_set</td>\n      <td>...</td>\n      <td>2023-08-20 22:13:50.552999936</td>\n      <td>0</td>\n      <td>-632.031977</td>\n      <td>149824.853283</td>\n      <td>2905.997060</td>\n      <td>-117.048664</td>\n      <td>34.269824</td>\n      <td>149875.0</td>\n      <td>359.758301</td>\n      <td>POLYGON ((-1306.041 149694.054, 43.031 149705....</td>\n    </tr>\n  </tbody>\n</table>\n<p>426240 rows × 28 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"                     CCORH  DBZH       PHIDP     RHOHV      ZDR   gate_volume  \\\nazimuth    range                                                                \n0.249939   2125.0      NaN   NaN         NaN       NaN      NaN           NaN   \n           2375.0      NaN   NaN         NaN       NaN      NaN           NaN   \n           2625.0      NaN   NaN         NaN       NaN      NaN           NaN   \n           2875.0     34.0   0.5   -0.352597  0.681667 -12.9375  4.944045e+05   \n           3125.0      NaN   NaN         NaN       NaN      NaN           NaN   \n...                    ...   ...         ...       ...      ...           ...   \n359.758301 148875.0   -8.0  30.5    0.352597  1.051667 -12.9375  1.325715e+09   \n           149125.0   -8.0  28.5  179.824400  1.051667 -12.9375  1.330171e+09   \n           149375.0   -8.0  29.0   -0.705194  0.201667 -13.0625  1.334635e+09   \n           149625.0   -8.0  30.5   -0.705194  0.201667 -13.0625  1.339106e+09   \n           149875.0   -8.0  28.0   -0.705194  0.201667 -13.0625  1.343585e+09   \n\n                            vres         hres   Z_cumsum follow_mode  ...  \\\nazimuth    range                                                      ...   \n0.249939   2125.0            NaN          NaN        NaN     not_set  ...   \n           2375.0            NaN          NaN        NaN     not_set  ...   \n           2625.0            NaN          NaN        NaN     not_set  ...   \n           2875.0      50.179489    50.179489   3.267492     not_set  ...   \n           3125.0            NaN          NaN        NaN     not_set  ...   \n...                          ...          ...        ...         ...  ...   \n359.758301 148875.0  2598.424805  2598.424805  53.491735     not_set  ...   \n           149125.0  2602.788330  2602.788330  53.505473     not_set  ...   \n           149375.0  2607.151855  2607.151855  53.520836     not_set  ...   \n           149625.0  2611.515137  2611.515137  53.542444     not_set  ...   \n           149875.0  2615.878662  2615.878662  53.554548     not_set  ...   \n\n                                             time  crs_wkt           x  \\\nazimuth    range                                                         \n0.249939   2125.0   2023-08-20 22:13:50.577999872        0    9.269070   \n           2375.0   2023-08-20 22:13:50.577999872        0   10.359546   \n           2625.0   2023-08-20 22:13:50.577999872        0   11.450022   \n           2875.0   2023-08-20 22:13:50.577999872        0   12.540497   \n           3125.0   2023-08-20 22:13:50.577999872        0   13.630971   \n...                                           ...      ...         ...   \n359.758301 148875.0 2023-08-20 22:13:50.552999936        0 -627.816405   \n           149125.0 2023-08-20 22:13:50.552999936        0 -628.870300   \n           149375.0 2023-08-20 22:13:50.552999936        0 -629.924194   \n           149625.0 2023-08-20 22:13:50.552999936        0 -630.978086   \n           149875.0 2023-08-20 22:13:50.552999936        0 -632.031977   \n\n                                 y            z         lon        lat  \\\nazimuth    range                                                         \n0.249939   2125.0      2124.819592   338.193914 -117.041702  32.938177   \n           2375.0      2374.797765   340.369314 -117.041691  32.940431   \n           2625.0      2624.775811   342.552070 -117.041679  32.942685   \n           2875.0      2874.753727   344.742182 -117.041667  32.944939   \n           3125.0      3124.731515   346.939649 -117.041656  32.947193   \n...                            ...          ...         ...        ...   \n359.758301 148875.0  148825.540792  2879.986614 -117.048617  34.260815   \n           149125.0  149075.369488  2886.478208 -117.048629  34.263068   \n           149375.0  149325.197802  2892.977147 -117.048641  34.265320   \n           149625.0  149575.025734  2899.483431 -117.048652  34.267572   \n           149875.0  149824.853283  2905.997060 -117.048664  34.269824   \n\n                        range     azimuth  \\\nazimuth    range                            \n0.249939   2125.0      2125.0    0.249939   \n           2375.0      2375.0    0.249939   \n           2625.0      2625.0    0.249939   \n           2875.0      2875.0    0.249939   \n           3125.0      3125.0    0.249939   \n...                       ...         ...   \n359.758301 148875.0  148875.0  359.758301   \n           149125.0  149125.0  359.758301   \n           149375.0  149375.0  359.758301   \n           149625.0  149625.0  359.758301   \n           149875.0  149875.0  359.758301   \n\n                                                              geometry  \nazimuth    range                                                        \n0.249939   2125.0    POLYGON ((0.048 1999.906, 17.399 1999.755, 19....  \n           2375.0    POLYGON ((0.054 2249.894, 19.574 2249.724, 21....  \n           2625.0    POLYGON ((0.06 2499.881, 21.749 2499.692, 23.9...  \n           2875.0    POLYGON ((0.066 2749.869, 23.924 2749.661, 26....  \n           3125.0    POLYGON ((0.072 2999.856, 26.099 2999.629, 28....  \n...                                                                ...  \n359.758301 148875.0  POLYGON ((-1297.323 148694.78, 42.744 148706.4...  \n           149125.0  POLYGON ((-1299.502 148944.599, 42.816 148956....  \n           149375.0  POLYGON ((-1301.682 149194.418, 42.888 149206....  \n           149625.0  POLYGON ((-1303.862 149444.236, 42.959 149455....  \n           149875.0  POLYGON ((-1306.041 149694.054, 43.031 149705....  \n\n[426240 rows x 28 columns]","content_type":"text/plain"}}}],"key":"fR7ngjBzEP"}],"key":"grAE5SRvhr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:18.883926Z","iopub.status.busy":"2024-09-08T07:01:18.883550Z","iopub.status.idle":"2024-09-08T07:01:18.890453Z","shell.execute_reply":"2024-09-08T07:01:18.889983Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Extract radar gate polygon on the range-azimuth axis\ngr_poly = np.array(gdf_gr.geometry)","key":"ewdfceaSZb"},{"type":"output","id":"ssmevNzbRuJSqm1YfhTHu","data":[],"key":"HizecfIMsZ"}],"key":"DWEz5am3KV"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aggregate GR data on SR footprints","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I5iwo3844D"}],"identifier":"aggregate-gr-data-on-sr-footprints","label":"Aggregate GR data on SR footprints","html_id":"aggregate-gr-data-on-sr-footprints","implicit":true,"key":"CHImBCrgKp"}],"key":"aNGxfxhORS"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To aggregate GR radar gates onto SR beam polygon footprints, we will use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aYlP35HWfi"},{"type":"inlineCode","value":"PolyAggregator","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hPXDv5LUsI"},{"type":"text","value":".\nThe ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LdqTZbarDw"},{"type":"inlineCode","value":"PolyAggregator","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oPoqHxNgTH"},{"type":"text","value":" enable custom aggregation of source (GR) polygons data intesecting the target (SR) polygons.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VygbfL4FDx"}],"key":"lKpI6EWnDU"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"When aggregating the data, you can use a combination of weighting schemes\nBy default, ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"nnAvQtE2Sc"},{"type":"inlineCode","value":"PolyAggregator","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yTkPrDAIJP"},{"type":"text","value":" applies ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"P0OUo89qs2"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"area_weighting","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CKYlg2xV2q"}],"key":"hgKy10N4j4"},{"type":"text","value":", which assigns weights based on the proportion of\nsource polygon area that intersects the target polygon.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"F6Y8zgfJdx"}],"key":"rQCJQJfPnR"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Custom Weighting Schemes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ZqXoQYnyya"}],"key":"FyynDEOslW"}],"key":"cmvRtAPaOA"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Several additional weighting schemes can be utilized, typically derived as a function of the horizontal distance between the centroids of the source and target polygons. Examples include:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"hpJwHrfeaN"}],"key":"EKN8GVjOFZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Inverse Distance Weighting","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KTKktvodV4"}],"key":"lOsSbCxySo"},{"type":"text","value":": ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"gNXPFHmh1u"},{"type":"inlineMath","value":"\\text{weights} = \\frac{1}{\\text{dist}^{\\text{order}}}","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>weights</mtext><mo>=</mo><mfrac><mn>1</mn><msup><mtext>dist</mtext><mtext>order</mtext></msup></mfrac></mrow><annotation encoding=\"application/x-tex\">\\text{weights} = \\frac{1}{\\text{dist}^{\\text{order}}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">weights</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2414em;vertical-align:-0.3963em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.6037em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">dist</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8376em;\"><span style=\"top:-2.8416em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">order</span></span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3963em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"eByaTzF1xt"}],"key":"h6uyFkX9uj"}],"key":"a0XNtzrH7t"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Barnes Gaussian Weighting","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Ac928Fb09S"}],"key":"z2oNcJTHbf"},{"type":"text","value":": ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"VIqdlFjJyP"},{"type":"inlineMath","value":"\\text{weights} = \\exp\\left(-\\frac{\\text{dist}^2}{\\kappa^2}\\right)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>weights</mtext><mo>=</mo><mi>exp</mi><mo>⁡</mo><mrow><mo fence=\"true\">(</mo><mo>−</mo><mfrac><msup><mtext>dist</mtext><mn>2</mn></msup><msup><mi>κ</mi><mn>2</mn></msup></mfrac><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\text{weights} = \\exp\\left(-\\frac{\\text{dist}^2}{\\kappa^2}\\right)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">weights</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.8em;vertical-align:-0.65em;\"></span><span class=\"mop\">exp</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size2\">(</span></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0179em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">κ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463em;\"><span style=\"top:-2.786em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">dist</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.931em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size2\">)</span></span></span></span></span></span>","key":"CDkIyL8g6l"}],"key":"lqHOu9jtrm"}],"key":"SJmWDqW2HE"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Cressman Weighting","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"EmmAQE6El6"}],"key":"ROSKE13XbF"},{"type":"text","value":": ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"sn2mvd1IFM"},{"type":"inlineMath","value":"\\text{weights} = \\frac{\\text{max\\_distance}^2 - \\text{dist}^2}{\\text{max\\_distance}^2 + \\text{dist}^2}","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>weights</mtext><mo>=</mo><mfrac><mrow><msup><mtext>max_distance</mtext><mn>2</mn></msup><mo>−</mo><msup><mtext>dist</mtext><mn>2</mn></msup></mrow><mrow><msup><mtext>max_distance</mtext><mn>2</mn></msup><mo>+</mo><msup><mtext>dist</mtext><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\text{weights} = \\frac{\\text{max\\_distance}^2 - \\text{dist}^2}{\\text{max\\_distance}^2 + \\text{dist}^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">weights</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.7392em;vertical-align:-0.5883em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1509em;\"><span style=\"top:-2.6287em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">max_distance</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-2.8416em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">dist</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-2.8416em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.527em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">max_distance</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.931em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">dist</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.931em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5883em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"ss2RNVEAxL"}],"key":"GLAu8FcITs"}],"key":"NDCYhoWP34"}],"key":"M9g3dywZS9"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"For example, the Barnes Gaussian Distance Weighting Scheme weights values proportionally to the distance measured from the center of the SR footprint to the center of the GR radar gate. This approach can partially account  for the nonuniform distribution of\npower within the SR beam.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"NQwvxb83me"}],"key":"hifCvy7CW5"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Custom weights can however also be passed to ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"w07hP3Nlne"},{"type":"inlineCode","value":"PolyAggregator","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"yxCnRognyd"},{"type":"text","value":", which will automatically handle normalization.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"FKvQYyYHJ9"}],"key":"nioNYCEzVn"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"In the context of SR/GR matching, it may be beneficial to adopt a ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"VEqKExpMBT"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Volume Weighting Scheme","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"w91olHCAjY"}],"key":"CL58OW6p1F"},{"type":"text","value":", using the volumes of GR radar gates as weights so that larger volumes are weighted more heavily.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"yIWemsh2Q8"}],"key":"ZKIN9saAIL"}],"key":"dMtoIfrewM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the code here below, we currently apply only the Area Weighting Scheme:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AOkqHXXUl8"}],"key":"C70vNRPnCB"}],"key":"dYTprytQbk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:18.892525Z","iopub.status.busy":"2024-09-08T07:01:18.892157Z","iopub.status.idle":"2024-09-08T07:01:19.136083Z","shell.execute_reply":"2024-09-08T07:01:19.135500Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define PolyAggregator\naggregator = PolyAggregator(source_polygons=gr_poly, target_polygons=sr_poly)","key":"dGpxNcNydV"},{"type":"output","id":"K5PfrCC7555YwqASgdYrs","data":[],"key":"I2fvfZkiqh"}],"key":"abKef6LYHm"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:19.138898Z","iopub.status.busy":"2024-09-08T07:01:19.138694Z","iopub.status.idle":"2024-09-08T07:01:23.635857Z","shell.execute_reply":"2024-09-08T07:01:23.635333Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Aggregate GR reflecitvities and compute statistics\n# - Timestep of acquisition\ntime_gr = aggregator.first(values=gdf_gr[\"time\"])\n\n# - Total number of gates aggregated\ncounts = aggregator.counts()\ncounts_valid = aggregator.apply(lambda x, weights: np.sum(~np.isnan(x)), values=gdf_gr[\"DBZH\"])  # noqa\n\n# - Total gate volume\nsum_vol = aggregator.sum(values=gdf_gr[\"gate_volume\"])\n\n# - Fraction of SR area covered\nfraction_covered_area = aggregator.fraction_covered_area()\n\n# - Reflectivity statistics\nz_mean = wrl.trafo.decibel(aggregator.average(values=wrl.trafo.idecibel(gdf_gr[\"DBZH\"])))\nz_std = wrl.trafo.decibel(aggregator.std(values=wrl.trafo.idecibel(gdf_gr[\"DBZH\"])))\nz_std[np.isinf(z_std)] = 0  # If only 1 value, std=0, log transform become -inf --> Set to 0\nz_max = aggregator.max(values=gdf_gr[\"DBZH\"])\nz_min = aggregator.min(values=gdf_gr[\"DBZH\"])\nz_range = z_max - z_min\nz_cov = z_std / z_mean  # coefficient of variation","key":"B30ie1cCrB"},{"type":"output","id":"8ynsX6uEyfmUsyPJwddD_","data":[],"key":"u3DVpzPP2N"}],"key":"Mpc0tAl5yl"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we create a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iJsyj7epC0"},{"type":"inlineCode","value":"geopandas.DataFrame","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vSTMj0r6VC"},{"type":"text","value":" with aggregated GR statistics:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TtU7yLYhBX"}],"key":"LhrKTXVqd8"}],"key":"SLu9aHa68f"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:23.638432Z","iopub.status.busy":"2024-09-08T07:01:23.638032Z","iopub.status.idle":"2024-09-08T07:01:26.666138Z","shell.execute_reply":"2024-09-08T07:01:26.665621Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create DataFrame with GR matched statistics\ndf = pd.DataFrame(\n    {\n        \"GR_Z_mean\": z_mean,\n        \"GR_Z_std\": z_std,\n        \"GR_Z_max\": z_max,\n        \"GR_Z_min\": z_min,\n        \"GR_Z_range\": z_range,\n        \"GR_Z_cov\": z_cov,\n        \"GR_time\": time_gr,\n        \"GR_gate_volume_sum\": sum_vol,\n        \"GR_fraction_covered_area\": fraction_covered_area,\n        \"GR_counts\": counts,\n        \"GR_counts_valid\": counts_valid,\n    },\n    index=gdf_sr.index,\n)\ngdf_gr_match = gpd.GeoDataFrame(df, crs=crs_gr, geometry=aggregator.target_polygons)\ngdf_gr_match.head()\n\n# Add GR range statistics\ngdf_gr_match[\"GR_range_max\"] = aggregator.max(values=gdf_gr[\"range\"])\ngdf_gr_match[\"GR_range_mean\"] = aggregator.mean(values=gdf_gr[\"range\"])\ngdf_gr_match[\"GR_range_min\"] = aggregator.min(values=gdf_gr[\"range\"])\n\n# Fraction above sensitivity thresholds\ngr_sensitivity_thresholds = [8, 10, 12, 14, 16, 18]\nfor thr in sr_sensitivity_thresholds:\n    fraction = aggregator.apply(lambda x, weights: np.sum(x > thr), values=gdf_gr[\"DBZH\"]) / counts  # noqa\n    gdf_gr_match[f\"GR_Z_fraction_above_{thr}dBZ\"] = fraction\n\n# Compute further aggregation statistics\nstats_var = [\"vres\", \"hres\", \"x\", \"y\", \"z\", \"Z_cumsum\"]\nfor var in stats_var:\n    gdf_gr_match[f\"GR_{var}_mean\"] = aggregator.average(values=gdf_gr[var])\n    gdf_gr_match[f\"GR_{var}_min\"] = aggregator.min(values=gdf_gr[var])\n    gdf_gr_match[f\"GR_{var}_max\"] = aggregator.max(values=gdf_gr[var])\n    gdf_gr_match[f\"GR_{var}_std\"] = aggregator.std(values=gdf_gr[var])\n    gdf_gr_match[f\"GR_{var}_range\"] = gdf_gr_match[f\"GR_{var}_max\"] - gdf_gr_match[f\"GR_{var}_min\"]\n\n# Compute horizontal distance between centroids\nfunc_dict = {\"min\": np.min, \"mean\": np.mean, \"max\": np.max}\nfor suffix, func in func_dict.items():\n    arr = np.zeros(aggregator.n_target_polygons) * np.nan\n    arr[aggregator.target_intersecting_indices] = np.array(\n        [func(dist) for i, dist in aggregator.dict_distances.items()],\n    )\n    gdf_gr_match[f\"distance_horizontal_{suffix}\"] = arr","key":"i2OVgXiFMP"},{"type":"output","id":"Iev32629bMoePXnQkab2h","data":[],"key":"hGbZshjlxL"}],"key":"vpuSA05wqJ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wZhNcZWckj"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To compute custom statistics, you can use the following approaches. Remember that the function must have the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wk28A61lrx"},{"type":"inlineCode","value":"values","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LrjX8TmzKy"},{"type":"text","value":" and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gnxXgxOsVN"},{"type":"inlineCode","value":"weights","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"htKWGDpixP"},{"type":"text","value":" arguments. Add the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Dnd1izUC4C"},{"type":"inlineCode","value":"weights","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LPcibbOQTg"},{"type":"text","value":" argument also if they are not used in your function !","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RC6ZQVj7jx"}],"key":"cFgtWc079Y"}],"key":"AK1ngdcAjx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:26.668608Z","iopub.status.busy":"2024-09-08T07:01:26.668231Z","iopub.status.idle":"2024-09-08T07:01:26.818792Z","shell.execute_reply":"2024-09-08T07:01:26.818237Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"def weighted_mean(values, weights):\n    return np.average(values, weights=weights)\n\n\naggregated_values = aggregator.apply(weighted_mean, values=gdf_gr[\"DBZH\"], area_weighting=True)\naggregated_values = aggregator.apply(\n    lambda x, weights: np.average(x, weights=weights),\n    values=gdf_gr[\"DBZH\"],\n    area_weighting=True,\n)","key":"aJqW67rXCk"},{"type":"output","id":"YiecPAOZx4hO23dzYFtKg","data":[],"key":"tfJcdMZWlp"}],"key":"rfr9lTN8Kv"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here below we compare the usage of Inverse Distance Weighting, Barnes Gaussian Distance Weighting, Cressman Weighting, and Volume Weighting.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ypLIZMfaW7"}],"key":"AlMEBiuy6f"}],"key":"dleDw3ITgO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:26.821234Z","iopub.status.busy":"2024-09-08T07:01:26.821056Z","iopub.status.idle":"2024-09-08T07:01:27.313270Z","shell.execute_reply":"2024-09-08T07:01:27.312669Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from gpm.utils.zonal_stats import BarnesGaussianWeights, CressmanWeights, InverseDistanceWeights, PolyAggregator\n\ngdf_gr_match1 = gdf_gr_match.copy()\n\n# Weighted by intersection area\ngdf_gr_match1[\"GR_Z_area\"] = aggregator.mean(values=gdf_gr[\"DBZH\"], area_weighting=True)\n\n# Weighted by ntersection area and Inverse Distance Weighting\ngdf_gr_match1[\"GR_Z_idw\"] = aggregator.mean(\n    values=gdf_gr[\"DBZH\"],\n    area_weighting=True,\n    distance_weighting=InverseDistanceWeights(order=1),\n)\n# Weighted by intersection area and Cressman Weighting\ngdf_gr_match1[\"GR_Z_cressman\"] = aggregator.mean(\n    values=gdf_gr[\"DBZH\"],\n    area_weighting=True,\n    distance_weighting=CressmanWeights(max_distance=2000),\n)\n# Weighted by intersection area and Barnes Gaussian Weighting (kappa=SR_hres_mean)\ngdf_gr_match1[\"GR_Z_barnes\"] = aggregator.mean(\n    values=gdf_gr[\"DBZH\"],\n    area_weighting=True,\n    distance_weighting=BarnesGaussianWeights(kappa=gdf_sr[\"SR_hres_mean\"]),\n)\n# Weighted Barnes Gaussian Weighting (kappa=SR_radius_mean)\ngdf_gr_match1[\"GR_Z_barnes_without_area\"] = aggregator.mean(\n    values=gdf_gr[\"DBZH\"],\n    area_weighting=False,\n    distance_weighting=BarnesGaussianWeights(kappa=gdf_sr[\"SR_hres_mean\"]),\n)\n# Weighted by intersection area and by GR volume\ngdf_gr_match1[\"GR_Z_volume\"] = aggregator.mean(\n    values=gdf_gr[\"DBZH\"],\n    weights=gdf_gr[\"gate_volume\"],\n    area_weighting=True,\n)","key":"SNkZCQxG50"},{"type":"output","id":"6Cyvtj5c10CCjw5BZxeFd","data":[],"key":"JOaMl23rlG"}],"key":"wESjd5t847"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:27.315772Z","iopub.status.busy":"2024-09-08T07:01:27.315393Z","iopub.status.idle":"2024-09-08T07:01:28.650967Z","shell.execute_reply":"2024-09-08T07:01:28.650355Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"gdf_gr_match1.plot(column=\"GR_Z_area\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)\ngdf_gr_match1.plot(column=\"GR_Z_idw\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)\ngdf_gr_match1.plot(column=\"GR_Z_cressman\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)\ngdf_gr_match1.plot(column=\"GR_Z_barnes\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)\ngdf_gr_match1.plot(column=\"GR_Z_volume\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)","key":"eXnSWI4I6K"},{"type":"output","id":"Oe4uDkAzvKRO1JnFtFvfd","data":[{"output_type":"execute_result","execution_count":88,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1883f4ede0d060971383474643d71d98","path":"/erad2024/build/1883f4ede0d060971383474643d71d98.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3e9b32d83862aebb6578a43169a00a5e","path":"/erad2024/build/3e9b32d83862aebb6578a43169a00a5e.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7c544faa42541fe30440c5f76273a08d","path":"/erad2024/build/7c544faa42541fe30440c5f76273a08d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d85724d9afe65ad1b4f44716bc7adba3","path":"/erad2024/build/d85724d9afe65ad1b4f44716bc7adba3.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fac5ecd8c38e23441a8f088baf59fabb","path":"/erad2024/build/fac5ecd8c38e23441a8f088baf59fabb.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"zOheHAxM2i"}],"key":"sG2oVJXv5H"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:28.653050Z","iopub.status.busy":"2024-09-08T07:01:28.652870Z","iopub.status.idle":"2024-09-08T07:01:28.910087Z","shell.execute_reply":"2024-09-08T07:01:28.909500Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Impact of Barnes with and without area-weighting\ngdf_gr_match1[\"DIFF_Barnes_Without_Area\"] = gdf_gr_match1[\"GR_Z_barnes\"] - gdf_gr_match1[\"GR_Z_barnes_without_area\"]\ngdf_gr_match1.plot(column=\"DIFF_Barnes_Without_Area\", legend=True, cmap=\"Spectral_r\", vmin=-0.25, vmax=0.25)","key":"P0At1P93Wu"},{"type":"output","id":"jSphYMdBgblsY5A6-ZoEb","data":[{"output_type":"execute_result","execution_count":89,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"175dbd9f3e5a20a35f93368e91530e23","path":"/erad2024/build/175dbd9f3e5a20a35f93368e91530e23.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"cFJOBctbAe"}],"key":"dtWFNZYAU6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:28.912765Z","iopub.status.busy":"2024-09-08T07:01:28.912567Z","iopub.status.idle":"2024-09-08T07:01:29.174183Z","shell.execute_reply":"2024-09-08T07:01:29.173601Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Impact of Barnes with area-weighting and default area weighting\ngdf_gr_match1[\"DIFF_Barnes_Naive\"] = gdf_gr_match1[\"GR_Z_area\"] - gdf_gr_match1[\"GR_Z_barnes\"]\ngdf_gr_match1.plot(column=\"DIFF_Barnes_Naive\", legend=True, cmap=\"Spectral_r\", vmin=-0.25, vmax=0.25)","key":"MNbeOVmMsq"},{"type":"output","id":"n-RHxMhrClU7NrwFJJhvn","data":[{"output_type":"execute_result","execution_count":90,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c8336c86f68570368f8ff4314d7c2602","path":"/erad2024/build/c8336c86f68570368f8ff4314d7c2602.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"Vn3QLjeSCt"}],"key":"jd17btmWwE"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create the SR/GR Database","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HiOneaIsLj"}],"identifier":"create-the-sr-gr-database","label":"Create the SR/GR Database","html_id":"create-the-sr-gr-database","implicit":true,"key":"bsgtikNDrP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s back to our main task and merge SR/GR aggregated variables into an unique database:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OOceHFquwk"}],"key":"rG1ZYSnJsO"}],"key":"lkczfHgjiO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:29.176694Z","iopub.status.busy":"2024-09-08T07:01:29.176294Z","iopub.status.idle":"2024-09-08T07:01:29.203695Z","shell.execute_reply":"2024-09-08T07:01:29.203109Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create DataFrame with matched variables\ngdf_match = gdf_gr_match.merge(gdf_sr, on=\"geometry\")\n\n# Compute ratio SR/GR volume\ngdf_match[\"VolumeRatio\"] = gdf_match[\"SR_gate_volume_sum\"] / gdf_match[\"GR_gate_volume_sum\"]\n\n# Compute difference in SR/GR gate volume\ngdf_match[\"VolumeDiff\"] = gdf_match[\"SR_gate_volume_sum\"] - gdf_match[\"GR_gate_volume_sum\"]\n\n# Compute time difference [in seconds]\ngdf_match[\"time_difference\"] = gdf_match[\"GR_time\"] - gdf_match[\"SR_time\"]\ngdf_match[\"time_difference\"] = gdf_match[\"time_difference\"].dt.total_seconds().astype(int)\n\n# Compute lower bound and upper bound height\ngdf_match[\"GR_z_lower_bound\"] = gdf_match[\"GR_z_min\"] - gdf_match[\"GR_vres_mean\"] / 2\ngdf_match[\"GR_z_upper_bound\"] = gdf_match[\"GR_z_max\"] + gdf_match[\"GR_vres_mean\"] / 2\n\ngdf_match[\"SR_z_lower_bound\"] = gdf_match[\"SR_z_min\"] - gdf_match[\"SR_vres_mean\"] / 2\ngdf_match[\"SR_z_upper_bound\"] = gdf_match[\"SR_z_max\"] + gdf_match[\"SR_vres_mean\"] / 2","key":"hQ1XqD21SV"},{"type":"output","id":"76-N9ymbTHCHa-0hTd_G_","data":[],"key":"lne2BJZpJh"}],"key":"vJmwx3nfG6"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analyse the SR/GR Database","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m2ZWIHdrIZ"}],"identifier":"analyse-the-sr-gr-database","label":"Analyse the SR/GR Database","html_id":"analyse-the-sr-gr-database","implicit":true,"key":"IWSTziWQb9"}],"key":"CV2aQPwRTT"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:29.206207Z","iopub.status.busy":"2024-09-08T07:01:29.205795Z","iopub.status.idle":"2024-09-08T07:01:30.005186Z","shell.execute_reply":"2024-09-08T07:01:30.004509Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show fraction SR footprint horizontal area covered by GR\ngdf_match.plot(column=\"GR_fraction_covered_area\", legend=True, cmap=\"Spectral_r\")\n\n# Show ratio SR/GR volume\ngdf_match.plot(column=\"VolumeRatio\", legend=True, cmap=\"Spectral_r\")\n\n# Show difference in total gate volume\ngdf_match.plot(column=\"VolumeDiff\", legend=True, cmap=\"Spectral_r\")","key":"fu1jn5cnlM"},{"type":"output","id":"1uwnlzvGT6aVevkgZdXCz","data":[{"output_type":"execute_result","execution_count":92,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bb168e7d2a7efebc53d9b853f46f01a6","path":"/erad2024/build/bb168e7d2a7efebc53d9b853f46f01a6.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2ac7ef42d53a9e6e51c9f9d4b1da597c","path":"/erad2024/build/2ac7ef42d53a9e6e51c9f9d4b1da597c.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6ba21816ec767d08cb16be4842c1fd11","path":"/erad2024/build/6ba21816ec767d08cb16be4842c1fd11.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"g4mexIwZ3D"}],"key":"aNUcWbPR87"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:30.007223Z","iopub.status.busy":"2024-09-08T07:01:30.007053Z","iopub.status.idle":"2024-09-08T07:01:30.801592Z","shell.execute_reply":"2024-09-08T07:01:30.801113Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"gdf_gr_match.plot(column=\"distance_horizontal_max\", legend=True, cmap=\"Spectral_r\")\ngdf_gr_match.plot(column=\"distance_horizontal_mean\", legend=True, cmap=\"Spectral_r\")\ngdf_gr_match.plot(column=\"distance_horizontal_min\", legend=True, cmap=\"Spectral_r\")","key":"EPvmPyEcu3"},{"type":"output","id":"Zo8TJOWxhM7B2KlLQe_fG","data":[{"output_type":"execute_result","execution_count":93,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0cd31e3f1436ff9e49e5e88873a39f08","path":"/erad2024/build/0cd31e3f1436ff9e49e5e88873a39f08.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3efce0b832df24c69faa2f1114d8d64c","path":"/erad2024/build/3efce0b832df24c69faa2f1114d8d64c.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ace3c0a92113565c7debca9753c22b54","path":"/erad2024/build/ace3c0a92113565c7debca9753c22b54.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"CNmALmfgYg"}],"key":"RpJLvRgBlS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:30.803622Z","iopub.status.busy":"2024-09-08T07:01:30.803435Z","iopub.status.idle":"2024-09-08T07:01:31.320231Z","shell.execute_reply":"2024-09-08T07:01:31.319634Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Analyse variations in gate resolution\ngdf_match.plot(column=\"GR_vres_mean\", legend=True, cmap=\"Spectral_r\")\ngdf_match.plot(column=\"SR_vres_mean\", legend=True, cmap=\"Spectral_r\")","key":"KAAShffsW8"},{"type":"output","id":"sYYAmnYEly_jz5hud4RgD","data":[{"output_type":"execute_result","execution_count":94,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"327b2a0530263a19910b2aa40f88b860","path":"/erad2024/build/327b2a0530263a19910b2aa40f88b860.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e12bd9a3955ccb92183fcb44b1903ba3","path":"/erad2024/build/e12bd9a3955ccb92183fcb44b1903ba3.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"lA5n2iYwIe"}],"key":"EWA63m9BbY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:31.322636Z","iopub.status.busy":"2024-09-08T07:01:31.322240Z","iopub.status.idle":"2024-09-08T07:01:32.755378Z","shell.execute_reply":"2024-09-08T07:01:32.754740Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Analyse variations in minimum and maximum gate elevation\ngdf_match.plot(column=\"GR_z_upper_bound\", legend=True, cmap=\"Spectral_r\")\ngdf_match.plot(column=\"SR_z_upper_bound\", legend=True, cmap=\"Spectral_r\")\n\ngdf_match.plot(column=\"GR_z_lower_bound\", legend=True, cmap=\"Spectral_r\")\ngdf_match.plot(column=\"SR_z_lower_bound\", legend=True, cmap=\"Spectral_r\")","key":"Z115AAuRU7"},{"type":"output","id":"uTHFE6GJDwfBVUf74kB_v","data":[{"output_type":"execute_result","execution_count":95,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"415c70b7a0b9b2d0a9b34e27daf8b00e","path":"/erad2024/build/415c70b7a0b9b2d0a9b34e27daf8b00e.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a9dea70b131486ed4e9795a5f4c095dc","path":"/erad2024/build/a9dea70b131486ed4e9795a5f4c095dc.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"05f35dd5178b6218aaf52e8de6f78811","path":"/erad2024/build/05f35dd5178b6218aaf52e8de6f78811.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d711440018d61fb4960113467391458a","path":"/erad2024/build/d711440018d61fb4960113467391458a.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"TsPOKQ0mpm"}],"key":"cvxhVSn8sB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:32.757730Z","iopub.status.busy":"2024-09-08T07:01:32.757551Z","iopub.status.idle":"2024-09-08T07:01:33.557059Z","shell.execute_reply":"2024-09-08T07:01:33.556489Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Analyse fraction hydrometeors and sensitivity\ngdf_match.plot(column=\"SR_counts\", legend=True, cmap=\"Spectral_r\", vmin=0)\ngdf_match.plot(column=\"SR_counts_valid\", legend=True, cmap=\"Spectral_r\", vmin=0)\n\ngdf_match.plot(column=\"SR_fraction_clutter\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n\n# gdf_match.plot(column=\"SR_fraction_melting_layer\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_fraction_hail\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_fraction_snow\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_fraction_rain\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_fraction_no_precip\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_fraction_below_isotherm\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_fraction_above_isotherm\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)","key":"ISLvqotgRk"},{"type":"output","id":"K4c2js7fTaoM-vYj4R_0G","data":[{"output_type":"execute_result","execution_count":96,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d545c86b3e1ddefca290299b8f726050","path":"/erad2024/build/d545c86b3e1ddefca290299b8f726050.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f71bd85658f47d39cef21106bec3c5ad","path":"/erad2024/build/f71bd85658f47d39cef21106bec3c5ad.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fb2f033c35e193e7b51cd7a292d55ce8","path":"/erad2024/build/fb2f033c35e193e7b51cd7a292d55ce8.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"dEVDltnaUg"}],"key":"VKRyo0zjXr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:33.559631Z","iopub.status.busy":"2024-09-08T07:01:33.559092Z","iopub.status.idle":"2024-09-08T07:01:34.092017Z","shell.execute_reply":"2024-09-08T07:01:34.091474Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Analyse sensitivity\ngdf_match.plot(column=\"GR_Z_fraction_above_10dBZ\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"GR_Z_fraction_above_12dBZ\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"GR_Z_fraction_above_14dBZ\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n\ngdf_match.plot(column=\"SR_zFactorFinal_Ku_fraction_above_12dBZ\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_zFactorFinal_Ku_fraction_above_14dBZ\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n# gdf_match.plot(column=\"SR_zFactorFinal_Ku_fraction_above_16dBZ\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)","key":"zD6PSgOVAt"},{"type":"output","id":"hHxf4GjCNuPkGh9_KW93s","data":[{"output_type":"execute_result","execution_count":97,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"33c322981df2f6d91bc788039f846918","path":"/erad2024/build/33c322981df2f6d91bc788039f846918.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"44e8074905457106edbb2ed7eaec3405","path":"/erad2024/build/44e8074905457106edbb2ed7eaec3405.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"vVvSgjjUxX"}],"key":"tc9ENN3SYE"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:34.094704Z","iopub.status.busy":"2024-09-08T07:01:34.094495Z","iopub.status.idle":"2024-09-08T07:01:35.106161Z","shell.execute_reply":"2024-09-08T07:01:35.105556Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Analyse SR attenuation statistics\ngdf_match.plot(column=\"SR_reliabFlag\", legend=True, cmap=\"Spectral_r\")\ngdf_match.plot(column=\"SR_pathAtten\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=5)\ngdf_match.plot(column=\"SR_piaFinal\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=5)\ngdf_match.plot(column=\"SR_zFactorCorrection_Ku_max\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=5)","key":"IG3aBr3P9c"},{"type":"output","id":"cjqS8LG8Toebsce_fa_Gd","data":[{"output_type":"execute_result","execution_count":98,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7610bc3037426f231c576bbe41e717e1","path":"/erad2024/build/7610bc3037426f231c576bbe41e717e1.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1d7fa4f4583bb3b7c9b116cb884a3b62","path":"/erad2024/build/1d7fa4f4583bb3b7c9b116cb884a3b62.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c283a38ad54dcdfed132fa97a6a4c69b","path":"/erad2024/build/c283a38ad54dcdfed132fa97a6a4c69b.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b79189c7b56c65defe96c161ed9d38db","path":"/erad2024/build/b79189c7b56c65defe96c161ed9d38db.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"FTkRgVqfpf"}],"key":"mIJFYyBi7m"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:35.108161Z","iopub.status.busy":"2024-09-08T07:01:35.107976Z","iopub.status.idle":"2024-09-08T07:01:35.622765Z","shell.execute_reply":"2024-09-08T07:01:35.622140Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Analyse SR NUBF\ngdf_match.plot(column=\"SR_zFactorFinal_Ku_std\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=8)\ngdf_match.plot(column=\"GR_Z_std\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=8)\n\n# gdf_match.plot(column=\"SR_zFactorFinal_Ku_range\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=8)\n# gdf_match.plot(column=\"GR_Z_range\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=20)\n\n# gdf_match.plot(column=\"SR_zFactorFinal_Ku_cov\", legend=True, cmap=\"Spectral_r\")\n# gdf_match.plot(column=\"GR_Z_cov\", legend=True, cmap=\"Spectral_r\")\n\n# gdf_match[\"SR_zFactorFinal_Ku_range_rel\"] = gdf_match[\"SR_zFactorFinal_Ku_range\"]/gdf_match[\"SR_zFactorFinal_Ku_mean\"]\n# gdf_match.plot(column=\"SR_zFactorFinal_Ku_range_rel\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=1)\n\n# gdf_match[\"GR_Z_range_rel\"] = gdf_match[\"GR_Z_range\"]/gdf_match[\"GR_Z_mean\"]\n# gdf_match.plot(column=\"GR_Z_range_rel\", legend=True, cmap=\"Spectral_r\")","key":"gogU04x774"},{"type":"output","id":"nX4GJwDtBeBzHzDvp5Yz3","data":[{"output_type":"execute_result","execution_count":99,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"50e6b97d411351dffe22b9f14a1dd4f6","path":"/erad2024/build/50e6b97d411351dffe22b9f14a1dd4f6.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b2c56d97bdbede8abecc8a3c46c91c62","path":"/erad2024/build/b2c56d97bdbede8abecc8a3c46c91c62.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"vatneHPwzp"}],"key":"zA3C14LOyL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:35.625085Z","iopub.status.busy":"2024-09-08T07:01:35.624706Z","iopub.status.idle":"2024-09-08T07:01:36.278663Z","shell.execute_reply":"2024-09-08T07:01:36.277981Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compare reflectivities\nextent_xy = gdf_sr.total_bounds[[0, 2, 1, 3]]\np = gdf_match.plot(\n    column=\"SR_zFactorFinal_Ku_mean\",\n    legend=True,\n    legend_kwds={\"label\": \"SR Reflectivity (dBz)\"},\n    cmap=\"Spectral_r\",\n    vmin=10,\n    vmax=40,\n)\np.axes.set_xlim(extent_xy[0:2])\np.axes.set_ylim(extent_xy[2:4])\np.axes.set_title(\"SR\")\nplt.xlabel(\"x (m)\", fontsize=12)\nplt.ylabel(\"y (m)\", fontsize=12)\nplt.grid(lw=0.25, color=\"grey\")\n\np = gdf_match.plot(\n    column=\"GR_Z_mean\",\n    legend=True,\n    legend_kwds={\"label\": \"GR Reflectivity (dBz)\"},\n    cmap=\"Spectral_r\",\n    vmin=10,\n    vmax=40,\n)\np.axes.set_xlim(extent_xy[0:2])\np.axes.set_ylim(extent_xy[2:4])\np.axes.set_title(\"GR\")\nplt.xlabel(\"x (m)\", fontsize=12)\nplt.ylabel(\"y (m)\", fontsize=12)\nplt.grid(lw=0.25, color=\"grey\")","key":"LCvMr7EEdD"},{"type":"output","id":"dkOcegI73PLB_7xMJwbw1","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"85fb8b8eb49a8a3e21d05cc700c86373","path":"/erad2024/build/85fb8b8eb49a8a3e21d05cc700c86373.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ae48bb000571ff8d990e5f880a2dcb96","path":"/erad2024/build/ae48bb000571ff8d990e5f880a2dcb96.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"SnH7CUjyG9"}],"key":"ApCptG8NSW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:36.281411Z","iopub.status.busy":"2024-09-08T07:01:36.280890Z","iopub.status.idle":"2024-09-08T07:01:36.916789Z","shell.execute_reply":"2024-09-08T07:01:36.916253Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute difference (also with bias removed)\ngdf_match[\"DIFF_Z_SR_GR\"] = gdf_match[\"SR_zFactorFinal_Ku_mean\"] - gdf_match[\"GR_Z_mean\"]\ngdf_match[\"DIFF_Z_GR_SR\"] = gdf_match[\"GR_Z_mean\"] - gdf_match[\"SR_zFactorFinal_Ku_mean\"]\nbias_gr_sr = np.nanmedian(gdf_match[\"DIFF_Z_GR_SR\"]).round(2)\nbias_sr_gr = np.nanmedian(gdf_match[\"DIFF_Z_SR_GR\"]).round(2)\np = gdf_match.plot(\n    column=\"DIFF_Z_SR_GR\",\n    legend_kwds={\"label\": \"SR-GR Reflectivity Difference (dBz)\"},\n    cmap=\"RdBu\",\n    legend=True,\n    vmax=10,\n)\np.axes.set_xlim(extent_xy[0:2])\np.axes.set_ylim(extent_xy[2:4])\np.axes.set_title(\"SR - GR\")\nplt.xlabel(\"x (m)\", fontsize=12)\nplt.ylabel(\"y (m)\", fontsize=12)\nplt.grid(lw=0.25, color=\"grey\")\n\ngdf_match[\"DIFF_Z_GR_SR_unbiased\"] = gdf_match[\"DIFF_Z_GR_SR\"] - bias_gr_sr\np = gdf_match.plot(\n    column=\"DIFF_Z_GR_SR_unbiased\",\n    legend_kwds={\"label\": \"SR-GR Reflectivity Difference (wihout bias) (dBz)\"},\n    cmap=\"RdBu\",\n    legend=True,\n    vmin=-4,\n    vmax=4,\n)\np.axes.set_xlim(extent_xy[0:2])\np.axes.set_ylim(extent_xy[2:4])\np.axes.set_title(\"SR - GR\")\nplt.xlabel(\"x (m)\", fontsize=12)\nplt.ylabel(\"y (m)\", fontsize=12)\nplt.grid(lw=0.25, color=\"grey\")","key":"pe3KSsSyHi"},{"type":"output","id":"8kqcR24kuFns-PWkZYqYL","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2995b088ad2b9cadda40c49d7f4de3be","path":"/erad2024/build/2995b088ad2b9cadda40c49d7f4de3be.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"07679d0b382f27a00809cd9e882f22fa","path":"/erad2024/build/07679d0b382f27a00809cd9e882f22fa.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"RgFcf0oPRW"}],"key":"NeaOQppUAr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LY8PACnd93"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here we show how to explore interactively the reflectivity fields using Folium:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qfbj7D5nob"}],"key":"YXBJPwTIbU"}],"key":"pdi1AP9xXJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:36.919158Z","iopub.status.busy":"2024-09-08T07:01:36.918788Z","iopub.status.idle":"2024-09-08T07:01:41.698673Z","shell.execute_reply":"2024-09-08T07:01:41.697928Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"gdf_match1 = gdf_match.copy()\ngdf_match1.explore(column=\"GR_Z_mean\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)","key":"quAR1AFZvg"},{"type":"output","id":"yqAg50na-sW2Dgl1Ie8Wr","data":[{"output_type":"execute_result","execution_count":102,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"fb0abef84e626f0b790e59f2bb3c7505","path":"/erad2024/build/fb0abef84e626f0b790e59f2bb3c7505.html"},"text/plain":{"content":"<folium.folium.Map at 0x7f5f67e22950>","content_type":"text/plain"}}}],"key":"ZRctRmnOWH"}],"key":"TJMa6MM22r"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j9sDlVN4Fi"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here we show how to plot cartopy maps in WGS84 and GR CRS AEQD.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"J9TZ9SdfWG"}],"key":"Z6sN3pVpJj"}],"key":"peqM1vm6yD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:41.805156Z","iopub.status.busy":"2024-09-08T07:01:41.804541Z","iopub.status.idle":"2024-09-08T07:01:41.808973Z","shell.execute_reply":"2024-09-08T07:01:41.808388Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define Cartopy AEQD CRS\nccrs_aeqd = ccrs.AzimuthalEquidistant(\n    central_longitude=ds_gr[\"longitude\"].item(),\n    central_latitude=ds_gr[\"latitude\"].item(),\n)","key":"A2ifKHIj3q"},{"type":"output","id":"0XuXushJcqME_hEnzv3S5","data":[],"key":"ur1mYYiMwu"}],"key":"mnnpOQi8ws"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:41.810918Z","iopub.status.busy":"2024-09-08T07:01:41.810744Z","iopub.status.idle":"2024-09-08T07:01:41.813630Z","shell.execute_reply":"2024-09-08T07:01:41.813149Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define Cartopy WGS84 CRS\nccrs_wgs84 = ccrs.PlateCarree()","key":"Da84zBmobp"},{"type":"output","id":"UCUklR0FPpEI6Y0IMtCE6","data":[],"key":"UgJrl2qQ83"}],"key":"TeOkfUo1Va"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:41.815480Z","iopub.status.busy":"2024-09-08T07:01:41.815318Z","iopub.status.idle":"2024-09-08T07:01:41.853937Z","shell.execute_reply":"2024-09-08T07:01:41.853370Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Print CRS of geopandas geometries\ngdf_match.crs","key":"LroWsZlS5V"},{"type":"output","id":"bVICZmfrl80vrZLuNpGly","data":[{"output_type":"execute_result","execution_count":105,"metadata":{},"data":{"text/plain":{"content":"<Projected CRS: PROJCRS[\"unknown\",BASEGEOGCRS[\"unknown\",DATUM[\"Wor ...>\nName: unknown\nAxis Info [cartesian]:\n- E[east]: Easting (metre)\n- N[north]: Northing (metre)\nArea of Use:\n- undefined\nCoordinate Operation:\n- name: unknown\n- method: Azimuthal Equidistant\nDatum: World Geodetic System 1984\n- Ellipsoid: WGS 84\n- Prime Meridian: Greenwich","content_type":"text/plain"}}}],"key":"wx2RlPOqKn"}],"key":"oCJwUBTwb9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:41.855924Z","iopub.status.busy":"2024-09-08T07:01:41.855754Z","iopub.status.idle":"2024-09-08T07:01:42.080072Z","shell.execute_reply":"2024-09-08T07:01:42.079476Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot in AEQD CRS (same crs of geopandas geometries)\nfig, ax = plt.subplots(subplot_kw={\"projection\": ccrs_aeqd})\ngdf_match.plot(ax=ax, column=\"GR_Z_mean\", cmap=\"turbo\", legend=True)","key":"fS3yz5fv0D"},{"type":"output","id":"58MdJNlBf26Dz7WPhsAy-","data":[{"output_type":"execute_result","execution_count":106,"metadata":{},"data":{"text/plain":{"content":"<GeoAxes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bb2cc022a696556cfeb31b7b7cb220dd","path":"/erad2024/build/bb2cc022a696556cfeb31b7b7cb220dd.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"pKBK1vFdzw"}],"key":"KeLHARPfDv"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:42.082505Z","iopub.status.busy":"2024-09-08T07:01:42.082089Z","iopub.status.idle":"2024-09-08T07:01:42.377106Z","shell.execute_reply":"2024-09-08T07:01:42.376510Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Convert geopandas dataframe to another crs\ngdf_match_wgs84 = gdf_match.to_crs(crs_sr)\n# Plot in WGS84 CRS\nfig, ax = plt.subplots(subplot_kw={\"projection\": ccrs_wgs84})\n# plot_cartopy_background(ax)\ngdf_match_wgs84.plot(ax=ax, column=\"GR_Z_mean\", cmap=\"turbo\", legend=True)\nax.set_extent(ds_gr.xradar_dev.extent(max_distance=max_gr_range))","key":"JoHU99CbTo"},{"type":"output","id":"_XseP4v7B_3o7icdwkzle","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"938cdae6cc54234730626037e3c65b45","path":"/erad2024/build/938cdae6cc54234730626037e3c65b45.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"vGd0FdOqcK"}],"key":"b0roPu6sG4"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filter the SR/GR Database","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FGTlplKz72"}],"identifier":"filter-the-sr-gr-database","label":"Filter the SR/GR Database","html_id":"filter-the-sr-gr-database","implicit":true,"key":"Tg4FSW1gzu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When calibrating or comparing SR and GR data, there is a necessary tradeoff between the strictness of filtering criteria filtering and the number of available samples. Here below we provide some general recommendations for effective filtering:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NqSnvHcNJG"}],"key":"HrlhRjCXHl"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Sensitivity Thresholds","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"D9IR7ar2Mj"}],"key":"Dtbe0kZnhM"},{"type":"text","value":": Retain only those radar beams where the aggregated gate reflectivities exceed the instrument sensitivities.\nThe ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fCTPuCwP8o"},{"type":"inlineCode","value":"GR_Z_fraction_above_<thr>dBZ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tWs9bOZ3kp"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BFuvNCHGZQ"},{"type":"inlineCode","value":"SR_zFactorFinal_Ku_fraction_above_<thr>dBZ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wnOAQc8tzi"},{"type":"text","value":" variables can be used filter the samples.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"maStTwb97t"}],"key":"MHc9PiqdHz"}],"key":"JrkghZ7wIh"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Stratiform Precipitation","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Bs0uk99pwh"}],"key":"xEgrh9PqBk"},{"type":"text","value":":  If the purpose of your analysis is to assess the calibration bias of GR data, it is suggested to focus on stratiform precipitation that ocurrs outside the melting layer (i.e. avoiding the bright band). Only stratiform samples above the melting layer are used in ground validation of the GPM DPR (W. Petersen 2017, personal communication).\nConvective SR footprints are typically excluded to avoid dealing with:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"g03SY0WFJJ"}],"key":"r61ndYGw1L"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"the high spatial variability in the precipitation field and issues with non-uniform beam filling (NUBF),","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"RuVxhococR"}],"key":"vAz7I9KdVJ"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"the potential biases introduced by the SR attenuation correction,","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"OFSSjYqRfz"}],"key":"xS8YLbUa0Z"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"the potential biases in GR reflectivities, especially at C and X band, due to beam attenuation,","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Clc8Uq3EcH"}],"key":"MYRDyWCboM"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"the multiple scattering signature caused by hail particles.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"T3sOTyBjnG"}],"key":"PcuM1eqvXi"}],"key":"sBsCYlXGzK"}],"key":"rGJlZ76QCu"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Reflectivity Range","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"F4iYX7Q0BO"}],"key":"Et2AoGyO65"},{"type":"text","value":": According to Warren et al. (2018), volume-averaged SR and GR reflectivity values should be selected within the range of 24 to 36 dBZ. This range minimizes the impact of low SR sensitivity,  SR beam attenuation and non-rayleigh scattering effects.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"rhkmmLYKqp"}],"key":"ijuH3FdOfa"}],"key":"mv7F6jqTTH"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Clutter Removal","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"xznOQkU3F4"}],"key":"wJ1kgH5xsC"},{"type":"text","value":": Exclude SR/GR samples that are contaminated by ground clutter, anomalous propagation, or beam blockage.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"F82YhXzFtC"}],"key":"OILwExkqDP"}],"key":"eJ6v5xcEqQ"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Volume matching","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"VJ00s4FquM"}],"key":"XN4cR8xLsq"},{"type":"text","value":": Exclude SR/GR samples where there are excessive differences in the total gate volume.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"ZPatUmz0Gk"}],"key":"v8oRHtgiv3"}],"key":"FrO2CFkpyQ"}],"key":"NUxkfIoxzx"}],"key":"XBmbiP60NW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:42.379651Z","iopub.status.busy":"2024-09-08T07:01:42.379277Z","iopub.status.idle":"2024-09-08T07:01:42.385419Z","shell.execute_reply":"2024-09-08T07:01:42.384907Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define mask\nmasks = [\n    # Select SR scan with \"normal\" dataQuality (for entire cross-track scan)\n    gdf_match[\"SR_dataQuality\"] == 0,\n    # Select SR beams with detected precipitation\n    gdf_match[\"SR_flagPrecip\"] > 0,\n    # Select only 'high quality' SR data\n    # - qualityFlag == 1 indicates low quality retrievals\n    # - qualityFlag == 2 indicates bad/missing retrievals\n    gdf_match[\"SR_qualityFlag\"] == 0,\n    # Select SR beams with SR above minimum reflectivity\n    gdf_match[\"SR_zFactorFinal_Ku_fraction_above_12dBZ\"] > 0.95,\n    # Select SR beams with GR above minimum reflectivity\n    gdf_match[\"GR_Z_fraction_above_10dBZ\"] > 0.95,\n    # Select only SR beams with detected bright band\n    gdf_match[\"SR_qualityBB\"] == 1,\n    # Select only beams with confident precipitation type\n    gdf_match[\"SR_qualityTypePrecip\"] == 1,\n    # Select only stratiform precipitation\n    # - SR_flagPrecipitationType == 2 indicates convective\n    gdf_match[\"SR_flagPrecipitationType\"] == 1,\n    # Select only SR beams with reliable attenuation correction\n    gdf_match[\"SR_reliabFlag\"].isin((1, 2)),  # or == 1\n    # Select only beams with reduced path attenuation\n    # gdf_match[\"SR_zFactorCorrection_Ku_max\"]\n    # gdf_match[\"SR_piaFinal\"]\n    # gdf_match[\"SR_pathAtten\"]\n    # Select only SR beams with matching SR gates with no clutter\n    gdf_match[\"SR_fraction_clutter\"] == 0,\n    # Select only SR beams with matching SR gates not in the melting layer\n    gdf_match[\"SR_fraction_melting_layer\"] == 0,\n    # Select only SR beams with matching SR gates with precipitation\n    gdf_match[\"SR_fraction_no_precip\"] == 0,\n    # Select only SR beams with matching SR gates with no hail\n    # gdf_match[\"SR_fraction_hail\"] == 0,\n    # Select only SR beams with matching SR gates with rain\n    # gdf_match[\"SR_fraction_hail\"] == 1,\n    # Select only SR beams with matching SR gates with snow\n    # gdf_match[\"SR_fraction_snow\"] == 1,\n    # Discard SR beams with high NUBF\n    # gdf_match[\"SR_zFactorFinal_Ku_range\"] > 5,\n    # gdf_match[\"SR_zFactorFinal_Ku_cov\"] < 0.5,\n    # gdf_match[\"GR_Z_cov\"] < 0.5,\n    # gdf_match[\"GR_Z_range\"] > 5,\n    # Select only interval of reflectivities\n    # - Warren et al., 2018:  between 24 and 36 dBZ\n    # (gdf_match[\"SR_zFactorFinal_Ku_mean\"] > 24) & (gdf_match[\"SR_zFactorFinal_Ku_mean\"] < 36),\n    # (gdf_match[\"GR_Z_mean\"] > 24) & (gdf_match[\"GR_Z_mean\"] < 36),\n    # Select SR beams only within given GR radius interval\n    # (gdf_match[\"GR_range_min\"] > min_gr_range) & (gdf_match[\"GR_range_max\"] < max_gr_range),\n    # Discard SR beams where scanning time difference (provided in seconds)\n    gdf_match[\"time_difference\"] < 5 * 60,  # 5 min\n    # Discard SR beams where GR gates does not cover 80% of the horizontal area\n    # gdf_match[\"GR_fraction_covered_area\"] > 0.8,\n    # Filter footprints where volume ratio exceeds 60\n    # gdf_match[\"VolumeRatio\"] > 60,\n    # Filter footprints where GR affected by beam blockage\n    # TODO: Filtering by beam blockage\n]","key":"xpkGCXgMT5"},{"type":"output","id":"tpZA1CuwfeumgnBpeheYH","data":[],"key":"iN8dTLwhd7"}],"key":"eKfJ0SlOaM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:42.387725Z","iopub.status.busy":"2024-09-08T07:01:42.387323Z","iopub.status.idle":"2024-09-08T07:01:42.392413Z","shell.execute_reply":"2024-09-08T07:01:42.391621Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define final mask\nmask_final = reduce(np.logical_and, masks)","key":"lMQNsoV43N"},{"type":"output","id":"bl8lN1Mp3qX_stq1eBZLL","data":[],"key":"HjZKJABcKy"}],"key":"gD2EAFjs7k"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:42.394582Z","iopub.status.busy":"2024-09-08T07:01:42.394266Z","iopub.status.idle":"2024-09-08T07:01:42.900896Z","shell.execute_reply":"2024-09-08T07:01:42.900395Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Dsplay final filtering mask\ngdf_match[\"filtering_mask\"] = mask_final\ngdf_match.plot(column=\"filtering_mask\", legend=True, cmap=\"Spectral\")\ngdf_match.plot(column=\"SR_zFactorFinal_Ku_mean\", legend=True, cmap=\"Spectral\")","key":"boj1RZ3NUM"},{"type":"output","id":"-MjASwUFztFjTr-lqSHFC","data":[{"output_type":"execute_result","execution_count":110,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ec9413610a6a6d1b96da79c255b23203","path":"/erad2024/build/ec9413610a6a6d1b96da79c255b23203.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"042c6ba5e9415a0c224a9e578c10b360","path":"/erad2024/build/042c6ba5e9415a0c224a9e578c10b360.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"aa7DA3tyy1"}],"key":"bJXlIFuaSs"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:42.902991Z","iopub.status.busy":"2024-09-08T07:01:42.902647Z","iopub.status.idle":"2024-09-08T07:01:42.906594Z","shell.execute_reply":"2024-09-08T07:01:42.906095Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Filter matching dataset\ngdf_final = gdf_match[mask_final]","key":"JitJAP5IO9"},{"type":"output","id":"ys6QgAvcV4cV2cdj7ShLN","data":[],"key":"UQgrC5xvj4"}],"key":"atFGyTDJds"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:42.908609Z","iopub.status.busy":"2024-09-08T07:01:42.908219Z","iopub.status.idle":"2024-09-08T07:01:43.200819Z","shell.execute_reply":"2024-09-08T07:01:43.200373Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot results\ngdf_final.plot(column=\"SR_zFactorFinal_Ku_mean\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)\ngdf_final.plot(column=\"GR_Z_mean\", legend=True, cmap=\"Spectral_r\", vmin=0, vmax=40)","key":"SBXZINdOjc"},{"type":"output","id":"X85TD2-iC9A-l0z4y5Pun","data":[{"output_type":"execute_result","execution_count":112,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6a3ae1e79e2aaf2ad5a9e5e3440fb898","path":"/erad2024/build/6a3ae1e79e2aaf2ad5a9e5e3440fb898.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3231e6512d7ee90fd04eccce5be4dfc3","path":"/erad2024/build/3231e6512d7ee90fd04eccce5be4dfc3.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"auZI6uQIqG"}],"key":"ohAXr7im0W"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Determine the GR Calibration Bias","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"blOUp9MhUc"}],"identifier":"determine-the-gr-calibration-bias","label":"Determine the GR Calibration Bias","html_id":"determine-the-gr-calibration-bias","implicit":true,"key":"Gb15NYHbGy"}],"key":"JcetJmNM4F"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:43.203258Z","iopub.status.busy":"2024-09-08T07:01:43.203074Z","iopub.status.idle":"2024-09-08T07:01:43.207634Z","shell.execute_reply":"2024-09-08T07:01:43.207126Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute statistics\nbias = np.nanmean(gdf_match[\"DIFF_Z_GR_SR\"]).round(2)\nrobBias = np.nanmedian(gdf_match[\"DIFF_Z_GR_SR\"]).round(2)\n\n# R2 (pearson, spearman rank)\nprint(f\"Th ZH Calibration offset is (mean): {bias} dB\")\nprint(f\"Th ZH Calibration offset is (median): {robBias} dB\")","key":"TJ4i81Oxyl"},{"type":"output","id":"d1fBV2mIxOFJdY9VwOgKt","data":[{"name":"stdout","output_type":"stream","text":"Th ZH Calibration offset is (mean): -5.53 dB\nTh ZH Calibration offset is (median): -4.58 dB\n"}],"key":"i1Fuz4Tkzk"}],"key":"Y0IPIHqkls"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:43.209769Z","iopub.status.busy":"2024-09-08T07:01:43.209603Z","iopub.status.idle":"2024-09-08T07:01:43.213036Z","shell.execute_reply":"2024-09-08T07:01:43.212539Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Comparison of GR vs SR reflectivities\nhue_variable = \"VolumeDiff\"\nhue_title = \"Difference in volume between SR and GR [m³]\"","key":"WSTx24xE0H"},{"type":"output","id":"x2CYVaieqpnPd3iNusLDQ","data":[],"key":"ExqlpfpR9n"}],"key":"Vg9lpvrLSH"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-09-08T07:01:43.215245Z","iopub.status.busy":"2024-09-08T07:01:43.215085Z","iopub.status.idle":"2024-09-08T07:01:43.510037Z","shell.execute_reply":"2024-09-08T07:01:43.509442Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# - Histograms\nfig = plt.figure(figsize=(12, 5))\nax = fig.add_subplot(121, aspect=\"equal\")\nplt.scatter(\n    gdf_match[\"GR_Z_mean\"],\n    gdf_match[\"SR_zFactorFinal_Ku_mean\"],\n    marker=\"+\",\n    c=gdf_match[hue_variable],\n    cmap=\"turbo\",\n)\nplt.colorbar(label=hue_title)\nplt.plot([0, 60], [0, 60], linestyle=\"solid\", color=\"black\")\nplt.xlim(10, 50)\nplt.ylim(10, 50)\nplt.xlabel(\"GR reflectivity (dBZ)\")\nplt.ylabel(\"SR reflectivity (dBZ)\")\nplt.title(f\"Offset GR-SR: {bias} dBZ\")\nax = fig.add_subplot(122)\nplt.hist(\n    gdf_match[\"GR_Z_mean\"][gdf_match[\"GR_Z_mean\"] > z_min_threshold_gr],\n    bins=np.arange(10, 60, 5),\n    edgecolor=\"None\",\n    label=\"GR\",\n)\nplt.hist(\n    gdf_match[\"SR_zFactorFinal_Ku_mean\"][gdf_match[\"SR_zFactorFinal_Ku_mean\"] > z_min_threshold_sr],\n    bins=np.arange(10, 60, 5),\n    edgecolor=\"red\",\n    facecolor=\"None\",\n    label=\"SR\",\n)\nplt.xlabel(\"Reflectivity (dBZ)\")\nplt.legend()\nfig.suptitle(\"GR vs SR\")","key":"AZMJkdhWrT"},{"type":"output","id":"M-8zPcgixf8JaVNrHGQog","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1b625a75f43cafe6c67701a9c8a2475b","path":"/erad2024/build/1b625a75f43cafe6c67701a9c8a2475b.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"FdwtUPuDJP"}],"key":"ygZv5EHFtY"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next Steps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m5g0wx67eE"}],"identifier":"next-steps","label":"Next Steps","html_id":"next-steps","implicit":true,"key":"wVjlbCsKD6"}],"key":"tpBxqO2oEa"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Congratulations on reaching the end of this tutorial!\nIf you have suggestions for improving this tutorial or the SR/GR matching process, please feel free to open\na Pull Request or create a GitHub issue on the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X4IKBxMYNK"},{"type":"link","url":"https://github.com/ghiggi/gpm_api","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPM-API GitHub repository","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OqM3ZOe5pP"}],"urlSource":"https://github.com/ghiggi/gpm_api","error":true,"key":"sr6hyc647M"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bzrn1VNqS4"}],"key":"Z8AggJ0r8D"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The code for the SR/GR matching process is encapsulated in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OWx2BX9CgP"},{"type":"inlineCode","value":"volume_matching","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GoNSKfELOH"},{"type":"text","value":" function contained in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nJoijm1po2"},{"type":"link","url":"https://github.com/ghiggi/gpm_api/blob/main/gpm/gv/routines.py","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"gpm.gv module","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oDyylyNwNG"}],"urlSource":"https://github.com/ghiggi/gpm_api/blob/main/gpm/gv/routines.py","data":{"kind":"file","org":"ghiggi","repo":"gpm_api","reference":"main","file":"gpm/gv/routines.py","raw":"https://raw.githubusercontent.com/ghiggi/gpm_api/main/gpm/gv/routines.py"},"internal":false,"protocol":"github","key":"RiiuaO0ymk"},{"type":"text","value":". User are free to use or adapt such function to accomplish their tasks.\nThe ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BCRai56qDE"},{"type":"link","url":"https://gpm-api.readthedocs.io/en/latest/tutorials/tutorial_03_SR_GR_Calibration.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Spaceborne-Ground Radar Calibration Applied Tutorial","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"AlZfvLqNkj"}],"urlSource":"https://gpm-api.readthedocs.io/en/latest/tutorials/tutorial_03_SR_GR_Calibration.html","key":"Gf5j8KwnOZ"},{"type":"text","value":" shows how to assess the GR calibration bias by abstracting away the complexities discussed in this tutorial.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BJMnjFoNai"}],"key":"JWlL1HyJ5s"}],"key":"MiGBH61g5f"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Me9U4uGrqQ"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"orPBGLcPxV"}],"key":"ZQdzD72voP"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"cite","url":"https://doi.org/10.1002/jgrd.50138","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cao, Q., Y. Hong, Y. Qi, Y. Wen, J. Zhang, J. J. Gourley, and L. Liao, 2013: Empirical conversion of the vertical profile of reflectivity from Ku-band to S-band frequency. J. Geophys. Res. Atmos., 118, 1814–1825, https://doi.org/10.1002/jgrd.50138","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RBqNfhtQKW"}],"kind":"narrative","label":"Cao_2013","identifier":"https://doi.org/10.1002/jgrd.50138","enumerator":"3","key":"r9l2PJgRDU"}],"key":"g7IUuv4oAF"},{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"cite","url":"https://doi.org/10.1175/2010JTECHA1403.1","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Schwaller, MR, and Morris, KR. 2011. A ground validation network for the Global Precipitation Measurement mission. J. Atmos. Oceanic Technol., 28, 301-319.28, https://doi.org/10.1175/2010JTECHA1403.1","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"j1TaopeDzY"}],"kind":"narrative","label":"Schwaller_2011","identifier":"https://doi.org/10.1175/2010JTECHA1403.1","enumerator":"1","key":"NISBaoyIS5"}],"key":"tDz6LIojxo"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"cite","url":"https://doi.org/10.1175/JTECH-D-17-0128.1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Warren, R.A., A. Protat, S.T. Siems, H.A. Ramsay, V. Louf, M.J. Manton, and T.A. Kane, 2018. Calibrating ground-based radars against TRMM and GPM. J. Atmos. Oceanic Technol., 35, 323–346, https://doi.org/10.1175/JTECH-D-17-0128.1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AKM96mUZV1"}],"kind":"narrative","label":"Warren_2018","identifier":"https://doi.org/10.1175/JTECH-D-17-0128.1","enumerator":"2","key":"lmgyt5gnq3"}],"key":"zYGs4lvTgE"}],"key":"NxPfy8dBsl"}],"key":"iza6sbEBTf"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Citation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VIoerJFLRz"}],"identifier":"citation","label":"Citation","html_id":"citation","implicit":true,"key":"B7P2sn7ssV"}],"key":"XtRFZ9jRtC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook is part of the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z82C9RASSy"},{"type":"link","url":"https://gpm-api.readthedocs.io/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPM-API  documentation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UjKCdIUSrN"}],"urlSource":"https://gpm-api.readthedocs.io/","key":"nNXhE1yXGs"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fwmfSchcha"}],"key":"OxdTuQR6Cq"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Large portions of this tutorials were adapted and derived from an old ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZggZTMjMqK"},{"type":"inlineMath","value":"\\omega radlib","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>l</mi><mi>i</mi><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">\\omega radlib</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">ib</span></span></span></span>","key":"p6QeqTQCjJ"},{"type":"text","value":"  tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fKLQH4AsNi"}],"key":"HcLAu4clVz"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Copyright: ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"N0kBgOtLyr"},{"type":"inlineMath","value":"\\omega radlib","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>l</mi><mi>i</mi><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">\\omega radlib</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">ib</span></span></span></span>","key":"l137Qf7oRR"},{"type":"text","value":"  and GPM-API developers.\nDistributed under the MIT License. See ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ktg54m86yw"},{"type":"link","url":"https://github.com/ghiggi/gpm_api/blob/main/LICENSE","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"GPM-API license","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"j103qa4LRc"}],"urlSource":"https://github.com/ghiggi/gpm_api/blob/main/LICENSE","data":{"kind":"file","org":"ghiggi","repo":"gpm_api","reference":"main","file":"LICENSE","raw":"https://raw.githubusercontent.com/ghiggi/gpm_api/main/LICENSE"},"internal":false,"protocol":"github","key":"QnuBujTjOM"},{"type":"text","value":" for more info.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JYBGkwebcZ"}],"key":"OtNGC9lCMR"}],"key":"LqVVuZcMhz"}],"key":"nTD7v7pI0o"},"references":{"cite":{"order":["Schwaller_2011","Warren_2018","Cao_2013"],"data":{"Schwaller_2011":{"label":"Schwaller_2011","enumerator":"1","doi":"10.1175/2010jtecha1403.1","html":"Schwaller, M. R., & Morris, K. R. (2011). A Ground Validation Network for the Global Precipitation Measurement Mission. <i>Journal of Atmospheric and Oceanic Technology</i>, <i>28</i>(3), 301–319. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/2010jtecha1403.1\">10.1175/2010jtecha1403.1</a>","url":"https://doi.org/10.1175/2010jtecha1403.1"},"Warren_2018":{"label":"Warren_2018","enumerator":"2","doi":"10.1175/jtech-d-17-0128.1","html":"Warren, R. A., Protat, A., Siems, S. T., Ramsay, H. A., Louf, V., Manton, M. J., & Kane, T. A. (2018). Calibrating Ground-Based Radars against TRMM and GPM. <i>Journal of Atmospheric and Oceanic Technology</i>, <i>35</i>(2), 323–346. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/jtech-d-17-0128.1\">10.1175/jtech-d-17-0128.1</a>","url":"https://doi.org/10.1175/jtech-d-17-0128.1"},"Cao_2013":{"label":"Cao_2013","enumerator":"3","doi":"10.1002/jgrd.50138","html":"Cao, Q., Hong, Y., Qi, Y., Wen, Y., Zhang, J., Gourley, J. J., & Liao, L. (2013). Empirical conversion of the vertical profile of reflectivity from Ku‐band to S‐band frequency. <i>Journal of Geophysical Research: Atmospheres</i>, <i>118</i>(4), 1814–1825. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1002/jgrd.50138\">10.1002/jgrd.50138</a>","url":"https://doi.org/10.1002/jgrd.50138"}}}},"footer":{"navigation":{"prev":{"title":"Spaceborne-Ground Radar Calibration (Application)","url":"/sr-gr-calibration-applied","group":"Spaceborne - Ground Radar Matching and Calibration"},"next":{"title":"Pyrad QPE Exercise","url":"/description-pyrad-tutorial","group":"Spaceborne - Ground Radar Matching and Calibration"}}},"domain":"http://localhost:3000"}